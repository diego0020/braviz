<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>braviz.visualization.subject_viewer &mdash; Braviz Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.3b',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/fold_classes.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
    <link rel="top" title="Braviz Documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../../../index.html">
            <img class="logo" src="../../../_static/Logo_Bravis_h.png" alt="Logo"/>
          </a></p>
          <!--
        <div class="headertitle"><a
          href="../../../index.html"> Documentation </a></div>
          -->
          <nav class="parents">
              <ol>
        <li><a href="../../../index.html"> Home </a> &raquo;</li>
          <li><a href="../../index.html"  accesskey="U"  >Module code</a> &raquo;</li>
                  </ol>
          </nav>
       </div>
    </div>


    <div class="content-wrapper">
      <div class="content">
        <div class="sidebar" id="agogo-sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/Logo_Bravis_h.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        </div>
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for braviz.visualization.subject_viewer</h1><div class="highlight"><pre>
<span></span><span class="c1">##############################################################################</span>
<span class="c1">#    Braviz, Brain Data interactive visualization                            #</span>
<span class="c1">#    Copyright (C) 2014  Diego Angulo                                        #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    This program is free software: you can redistribute it and/or modify    #</span>
<span class="c1">#    it under the terms of the GNU Lesser General Public License as          #</span>
<span class="c1">#    published by  the Free Software Foundation, either version 3 of the     #</span>
<span class="c1">#    License, or (at your option) any later version.                         #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    This program is distributed in the hope that it will be useful,         #</span>
<span class="c1">#    but WITHOUT ANY WARRANTY; without even the implied warranty of          #</span>
<span class="c1">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           #</span>
<span class="c1">#    GNU Lesser General Public License for more details.                     #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    You should have received a copy of the GNU Lesser General Public License#</span>
<span class="c1">#    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.   #</span>
<span class="c1">##############################################################################</span>


<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">vtk</span>
<span class="kn">from</span> <span class="nn">vtk.qt4.QVTKRenderWindowInteractor</span> <span class="kn">import</span> <span class="n">QVTKRenderWindowInteractor</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">import</span> <span class="n">QFrame</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QApplication</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">pyqtSignal</span>

<span class="kn">from</span> <span class="nn">braviz.visualization.simple_vtk</span> <span class="kn">import</span> <span class="n">OrientationAxes</span><span class="p">,</span> <span class="n">persistentImagePlane</span><span class="p">,</span> <span class="n">cursors</span><span class="p">,</span> <span class="n">estimate_window_level</span>
<span class="kn">from</span> <span class="nn">braviz.visualization.fmri_view</span> <span class="kn">import</span> <span class="n">fMRI_blender</span>

<span class="kn">from</span> <span class="nn">braviz.interaction.structure_metrics</span> <span class="kn">import</span> <span class="n">solve_laterality</span>
<span class="kn">import</span> <span class="nn">braviz.readAndFilter.tabular_data</span>
<span class="kn">import</span> <span class="nn">braviz.readAndFilter.config_file</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sbs</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">izip</span>
<span class="kn">from</span> <span class="nn">braviz.interaction</span> <span class="kn">import</span> <span class="n">structure_metrics</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Diego&#39;</span>


<span class="n">_axis_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;axial&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;sagital&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="s2">&quot;coronal&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="c1"># TODO: Abstract viewer classes</span>


<div class="viewcode-block" id="do_and_render"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.do_and_render">[docs]</a><span class="k">def</span> <span class="nf">do_and_render</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps drawing methods, adding an optional call to *Render* at the end.</span>

<span class="sd">    It adds the *skip_render* kwarg argument, which if True will avoid the call to Render. This is</span>
<span class="sd">    useful to avoid repeated call renders when performing several draw operations.</span>

<span class="sd">    requires the class to have the renderer accessible as self.ren</span>

<span class="sd">    Args:</span>
<span class="sd">        f (function) : Function that changes vtk scene</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;skip_render&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">skip</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;skip_render&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skip</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">rw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetRenderWindow</span><span class="p">()</span>
                <span class="n">rw</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">wrapped</span></div>


<div class="viewcode-block" id="SubjectViewer"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SubjectViewer">[docs]</a><span class="k">class</span> <span class="nc">SubjectViewer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A general viewer to show data on a particular subject</span>

<span class="sd">    It provides access to</span>

<span class="sd">        - Images</span>
<span class="sd">        - fMRI Contours</span>
<span class="sd">        - Segmentation reconstruction models</span>
<span class="sd">        - Surface parcellations</span>
<span class="sd">        - Tractographies</span>
<span class="sd">        - Tracula Bundles</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">render_window_interactor</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the viewer</span>

<span class="sd">        Args:</span>
<span class="sd">            render_window_interactor (vtkRenderWindowInteractor) : The intaractor that will be used with this viewer</span>
<span class="sd">            reader (braviz.visualization.base_reader.BaseReader) : Braviz reader</span>
<span class="sd">            widget (QObject) : Must implement *slice_change_handle* and *window_level_change_handle*</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># render_window_interactor.Initialize()</span>
        <span class="c1"># render_window_interactor.Start()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span> <span class="o">=</span> <span class="n">render_window_interactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span> <span class="o">=</span> <span class="n">render_window_interactor</span><span class="o">.</span><span class="n">GetRenderWindow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkRenderer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">((</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GradientBackgroundOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground2</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">((</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetUseDepthPeeling</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">SetMultiSamples</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">AlphaBitPlanesOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetOcclusionRatio</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">AddRenderer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="o">.</span><span class="n">SetInteractorStyle</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkInteractorStyleTrackballCamera</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">OrientationAxes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">light</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkLight</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddLight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light</span><span class="o">.</span><span class="n">SetLightTypeToHeadlight</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>

        <span class="c1"># state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="s2">&quot;subject&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">picker</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellPicker</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">SetTolerance</span><span class="p">(</span><span class="mf">0.0005</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="o">.</span><span class="n">SetPicker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>

        <span class="c1"># internal data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__model_manager</span> <span class="o">=</span> <span class="n">ModelManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tractography_manager</span> <span class="o">=</span> <span class="n">TractographyManager</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_manager</span> <span class="o">=</span> <span class="n">ImageManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">widget</span><span class="p">,</span> <span class="n">interactor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">,</span>
                                            <span class="n">picker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__surface_manager</span> <span class="o">=</span> <span class="n">SurfaceManager</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">,</span> <span class="n">picker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__contours_manager</span> <span class="o">=</span> <span class="n">FmriContours</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tracula_manager</span> <span class="o">=</span> <span class="n">TraculaManager</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">)</span>
        <span class="n">fmri_lut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fmri&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contours_manager</span><span class="o">.</span><span class="n">set_lut</span><span class="p">(</span><span class="n">fmri_lut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contours_paradigm</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contours_contrast</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_contours_visibility</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contours_img</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># reset camera and render</span>
        <span class="c1"># self.reset_camera(0)</span>
        <span class="c1">#        self.ren.Render()</span>

        <span class="c1"># widget, signal handling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__widget</span> <span class="o">=</span> <span class="n">widget</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to :class:`ModelManager`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__model_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tractography</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to :class:`TractographyManager`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tractography_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to :class:`ImageManager`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">surface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to :class:`SurfaceManager`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__surface_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">contours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to :class:`FmriContours`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__contours_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tracula</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to :class:`TraculaManager`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tracula_manager</span>

<div class="viewcode-block" id="SubjectViewer.show_cone"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SubjectViewer.show_cone">[docs]</a>    <span class="k">def</span> <span class="nf">show_cone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Useful for testing&quot;&quot;&quot;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Showing cone... this should only happen during testing&quot;</span><span class="p">)</span>
        <span class="n">cone</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkConeSource</span><span class="p">()</span>
        <span class="n">cone</span><span class="o">.</span><span class="n">SetResolution</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">cone_mapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
        <span class="n">cone_mapper</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">cone</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
        <span class="n">cone_actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
        <span class="n">cone_actor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">cone_mapper</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">cone_actor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span></div>

<div class="viewcode-block" id="SubjectViewer.change_subject"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SubjectViewer.change_subject">[docs]</a>    <span class="k">def</span> <span class="nf">change_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_subject</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the subject associated to the viewer</span>

<span class="sd">        Args:</span>
<span class="sd">            new_subject : new subject id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">new_subject</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="c1"># update image</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">change_subject</span><span class="p">(</span><span class="n">new_subject</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">)</span>

        <span class="c1"># update models</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">reload_models</span><span class="p">(</span><span class="n">subj</span><span class="o">=</span><span class="n">new_subject</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Models&quot;</span><span class="p">)</span>

        <span class="c1"># update fibers</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tractography</span><span class="o">.</span><span class="n">set_subject</span><span class="p">(</span><span class="n">new_subject</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Fibers&quot;</span><span class="p">)</span>

        <span class="c1"># update surfaces</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">set_subject</span><span class="p">(</span><span class="n">new_subject</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Surfaces&quot;</span><span class="p">)</span>

        <span class="c1"># update fmri</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_fmri_contours_image</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Contours&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracula</span><span class="o">.</span><span class="n">reload_bundles</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Tracula&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t load &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t load &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="SubjectViewer.change_current_space"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SubjectViewer.change_current_space">[docs]</a>    <span class="k">def</span> <span class="nf">change_current_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_space</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the current coordinate system</span>

<span class="sd">        Args:</span>
<span class="sd">            new_space (str) : New coordinate system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">==</span> <span class="n">new_space</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">new_space</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">change_space</span><span class="p">(</span><span class="n">new_space</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">reload_models</span><span class="p">(</span><span class="n">space</span><span class="o">=</span><span class="n">new_space</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tractography</span><span class="o">.</span><span class="n">set_current_space</span><span class="p">(</span><span class="n">new_space</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">set_space</span><span class="p">(</span><span class="n">new_space</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracula</span><span class="o">.</span><span class="n">reload_bundles</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">new_space</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

    <span class="n">__camera_positions_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mi">157</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">130</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="mi">4</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="mi">3</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="mi">5</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
        <span class="mi">6</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">252</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="SubjectViewer.reset_camera"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SubjectViewer.reset_camera">[docs]</a>    <span class="k">def</span> <span class="nf">reset_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        resets the current camera to standard locations.</span>

<span class="sd">        Args:</span>
<span class="sd">            position (int) :</span>

<span class="sd">                - 0: initial 3d view</span>
<span class="sd">                - 1: left</span>
<span class="sd">                - 2: right</span>
<span class="sd">                - 3: front</span>
<span class="sd">                - 4: back</span>
<span class="sd">                - 5: top</span>
<span class="sd">                - 6: bottom</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">focal</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">viewup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__camera_positions_dict</span><span class="p">[</span><span class="n">position</span><span class="p">]</span>

        <span class="n">cam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">focal</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetViewUp</span><span class="p">(</span><span class="n">viewup</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">ResetCameraClippingRange</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span></div>

<div class="viewcode-block" id="SubjectViewer.set_camera"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SubjectViewer.set_camera">[docs]</a>    <span class="k">def</span> <span class="nf">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focal_point</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">view_up</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the camera position</span>

<span class="sd">        Args:</span>
<span class="sd">            focal_point (tuple) : Focal point</span>
<span class="sd">            position (tuple) : Camera position</span>
<span class="sd">            view_up (tuple) : View up vector</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">focal_point</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetViewUp</span><span class="p">(</span><span class="n">view_up</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">ResetCameraClippingRange</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span></div>

<div class="viewcode-block" id="SubjectViewer.print_camera"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SubjectViewer.print_camera">[docs]</a>    <span class="k">def</span> <span class="nf">print_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs information about the current camera position</span>

<span class="sd">        Data is send to the current logger with *info* level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Camera coordinates:&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;focal: &quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">cam1</span><span class="o">.</span><span class="n">GetFocalPoint</span><span class="p">())</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;position: &quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">cam1</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">())</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;viewUp: &quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">cam1</span><span class="o">.</span><span class="n">GetViewUp</span><span class="p">())</span></div>

<div class="viewcode-block" id="SubjectViewer.get_camera_parameters"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SubjectViewer.get_camera_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets current camera parameters</span>

<span class="sd">        Returs:</span>
<span class="sd">            focal_point, position, view_up</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetFocalPoint</span><span class="p">()</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span>
        <span class="n">vu</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetViewUp</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fp</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">vu</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="SubjectViewer.set_fmri_contours_image"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SubjectViewer.set_fmri_contours_image">[docs]</a>    <span class="k">def</span> <span class="nf">set_fmri_contours_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the image to use for calculating fMRI contours</span>

<span class="sd">        Args:</span>
<span class="sd">            paradigm (str) : Name of fMRI paradigm</span>
<span class="sd">            contrast (int): Index (Matlab style) of desired contrast</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">paradigm</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">paradigm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__contours_paradigm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__contours_paradigm</span> <span class="o">=</span> <span class="n">paradigm</span>
        <span class="k">if</span> <span class="n">contrast</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">contrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__contours_contrast</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__contours_contrast</span> <span class="o">=</span> <span class="n">contrast</span>

        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__contours_hidden</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">paradigm</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__contours_img</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fmri_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fmri&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span>
                                           <span class="n">name</span><span class="o">=</span><span class="n">paradigm</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="n">contrast</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">&quot;vtk&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__contours_img</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__contours_img</span> <span class="o">=</span> <span class="n">fmri_img</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__contours_img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contours</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">contours</span><span class="o">.</span><span class="n">set_image</span><span class="p">(</span><span class="n">fmri_img</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__contours_hidden</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">contours</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="SubjectViewer.set_contours_visibility"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SubjectViewer.set_contours_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">set_contours_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle visibility of fMRI contours</span>

<span class="sd">        Args:</span>
<span class="sd">            visible (bool) : If ``True`` contours will show, if ``False`` contours will be hidden,</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contours_hidden</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">visible</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__contours_hidden</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contours</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_fmri_contours_image</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__contours_paradigm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__contours_contrast</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contours</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FilterArrows"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.FilterArrows">[docs]</a><span class="k">class</span> <span class="nc">FilterArrows</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Qt event filter to prevent the main vtk widget from swallowing certain keys. By default this are the arrows,</span>
<span class="sd">    but additional keys can be added in the constructor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key_pressed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QEvent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">other_keys</span><span class="o">=</span><span class="nb">tuple</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct the Qt Event Filter to avoid certain key presses from arriving to the VTK widget</span>

<span class="sd">        Args:</span>
<span class="sd">            parent (QOject) : Parent of the current object</span>
<span class="sd">            other_keys (list) : List of additional keys to filter out</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FilterArrows</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">{</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Left</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Right</span><span class="p">,</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Up</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Down</span><span class="p">}</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other_keys</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__filter_keys</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">eventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">QEvent</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QEvent</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QEvent</span><span class="o">.</span><span class="n">KeyPress</span><span class="p">:</span>
            <span class="n">q_event_key</span> <span class="o">=</span> <span class="n">QEvent</span><span class="o">.</span><span class="n">key</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">q_event_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filter_keys</span><span class="p">:</span>
                <span class="c1"># print &quot;intercepted key&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">key_pressed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">QEvent</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span></div>


<div class="viewcode-block" id="QSubjectViewerWidget"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QSubjectViewerWidget">[docs]</a><span class="k">class</span> <span class="nc">QSubjectViewerWidget</span><span class="p">(</span><span class="n">QFrame</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Qt Widget that wraps :class:`SubjectViewer` and lets it connect naturally to Qt Applications</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">slice_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">image_window_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">image_level_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the subject viewer widget</span>

<span class="sd">        Args:</span>
<span class="sd">            reader (braviz.visualization.base_reader.BaseReader) : Braviz reader</span>
<span class="sd">            parent (QObject) : Parent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QFrame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span> <span class="o">=</span> <span class="n">QVTKRenderWindowInteractor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">filt</span> <span class="o">=</span> <span class="n">FilterArrows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">filt</span><span class="o">.</span><span class="n">key_pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="o">.</span><span class="n">installEventFilter</span><span class="p">(</span><span class="n">filt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__subject_viewer</span> <span class="o">=</span> <span class="n">SubjectViewer</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="p">)</span>

        <span class="c1"># self.subject_viewer.ren_win.Render()</span>

        <span class="c1"># self.__qwindow_interactor.show()</span>

<div class="viewcode-block" id="QSubjectViewerWidget.initialize_widget"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QSubjectViewerWidget.initialize_widget">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this function **after** calling show on the widget or a parent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="o">.</span><span class="n">Start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject_viewer</span><span class="o">.</span><span class="n">reset_camera</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>
        <span class="c1"># self.__subject_viewer.show_cone()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subject_viewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the underlying :class:`SubjectViewer`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__subject_viewer</span>

<div class="viewcode-block" id="QSubjectViewerWidget.slice_change_handle"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QSubjectViewerWidget.slice_change_handle">[docs]</a>    <span class="k">def</span> <span class="nf">slice_change_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_slice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when the current image slice is changed on the vtkWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">new_slice</span><span class="p">)</span></div>
        <span class="c1"># print new_slice</span>

<div class="viewcode-block" id="QSubjectViewerWidget.window_level_change_handle"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QSubjectViewerWidget.window_level_change_handle">[docs]</a>    <span class="k">def</span> <span class="nf">window_level_change_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when window or level are changed by interacting in the vtkWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_window_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_level_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ImageManager"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager">[docs]</a><span class="k">class</span> <span class="nc">ImageManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Controls an ImagePlaneWidget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">ren</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">interactor</span><span class="p">,</span> <span class="n">initial_subj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_space</span><span class="o">=</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="n">picker</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the ImageManager</span>

<span class="sd">        Args:</span>
<span class="sd">            reader (braviz.visualization.base_reader.BaseReader) : Braviz reader</span>
<span class="sd">            ren (vtkRenderer) : Renderer in which to draw the plane</span>
<span class="sd">            widget (QObject) : Must implement *slice_change_handle* and *window_level_change_handle*</span>
<span class="sd">            interactor (vtkRenderWindowInteractor) : The render window interactor of the output window</span>
<span class="sd">            initial_subj : Code of initial subject, if None an arbitrary subject will be selected</span>
<span class="sd">            initial_space (str) : Initial coordinate system</span>
<span class="sd">            picker (vtkPicker) : A vtkPicker may be used to pick on several objects. If None a new picker is created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span> <span class="o">=</span> <span class="n">ren</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="k">if</span> <span class="n">initial_subj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="n">braviz</span><span class="o">.</span><span class="n">readAndFilter</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_apps_config</span><span class="p">()</span>
            <span class="n">initial_subj</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">get_default_subject</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">initial_subj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">initial_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_class</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_orientation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__past_window_levels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__window_level_lut</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkWindowLevelLookupTable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fmri_blender</span> <span class="o">=</span> <span class="n">fMRI_blender</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__widget</span> <span class="o">=</span> <span class="n">widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__outline_filter</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__picker</span> <span class="o">=</span> <span class="n">picker</span>
        <span class="c1"># Should only change when user selects to hide the image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__hidden</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span> <span class="o">=</span> <span class="n">interactor</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">image_plane_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the vtkImagePlaneWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_image_plane_widget</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ImageManager.hide_image"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.hide_image">[docs]</a>    <span class="k">def</span> <span class="nf">hide_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hide the plane widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__hidden</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span></div>
            <span class="c1"># self.image_plane_widget.SetVisibility(0)</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ImageManager.show_image"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.show_image">[docs]</a>    <span class="k">def</span> <span class="nf">show_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show the plane widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__hidden</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_image_modality</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_name</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
    <span class="k">def</span> <span class="nf">_create_image_plane_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the internal plane widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># already created</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="o">=</span> <span class="n">persistentImagePlane</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_orientation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetInteractor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__window_level_lut</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkWindowLevelLookupTable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__window_level_lut</span><span class="o">.</span><span class="n">DeepCopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">())</span>

        <span class="k">def</span> <span class="nf">slice_change_handler</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="n">new_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetSliceIndex</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widget</span><span class="o">.</span><span class="n">slice_change_handle</span><span class="p">(</span><span class="n">new_slice</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">detect_window_level_event</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="n">window</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetWindow</span><span class="p">(</span>
            <span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetLevel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widget</span><span class="o">.</span><span class="n">window_level_change_handle</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">slice_change_event</span><span class="p">,</span> <span class="n">slice_change_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="s2">&quot;WindowLevelEvent&quot;</span><span class="p">,</span> <span class="n">detect_window_level_event</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__picker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetPicker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__picker</span><span class="p">)</span>

        <span class="n">outline</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkOutlineFilter</span><span class="p">()</span>

        <span class="n">outlineMapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
        <span class="n">outlineMapper</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">outline</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>

        <span class="n">outlineActor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
        <span class="n">outlineActor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">outlineMapper</span><span class="p">)</span>
        <span class="n">outlineActor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">outlineActor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__outline_filter</span> <span class="o">=</span> <span class="n">outline</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ImageManager.change_subject"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.change_subject">[docs]</a>    <span class="k">def</span> <span class="nf">change_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_subject</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change subject associated to the plane</span>

<span class="sd">        Args:</span>
<span class="sd">            new_subject : Id of new subject</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">new_subject</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hidden</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_image_modality</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_image_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_name</span><span class="p">,</span> <span class="n">force_reload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                       <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ImageManager.change_space"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.change_space">[docs]</a>    <span class="k">def</span> <span class="nf">change_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_space</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change current coordinate system</span>

<span class="sd">        new_space (str) : new coordinate system, see :meth:`~braviz.readAndFilter.base_reader.BaseReader.get`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">==</span> <span class="n">new_space</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">new_space</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hidden</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_image_modality</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_image_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_name</span><span class="p">,</span> <span class="n">force_reload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                       <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ImageManager.change_image_modality"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.change_image_modality">[docs]</a>    <span class="k">def</span> <span class="nf">change_image_modality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_class</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">force_reload</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes the modality of the current image;</span>

<span class="sd">        In the case of fMRI modality should be fMRI and paradigm the name of the paradigm</span>

<span class="sd">        Args:</span>
<span class="sd">            image_class (str) : New image class, may be one of  ``[&quot;image&quot;,&quot;label&quot;,&quot;dti&quot;,&quot;fmri&quot;]``</span>
<span class="sd">            image_name (str) : New image modality name. Use ``None`` if *image_class* is ``&quot;dti&quot;``,</span>
<span class="sd">                otherwise it should be inside the index of the given class.</span>
<span class="sd">                In case of *FMRI* the paradigm should be entered here</span>
<span class="sd">                See :meth:`~braviz.readAndFilter.base_reader.BaseReader.get`</span>
<span class="sd">            force_reload (bool) : if True, forces the plane to reload the image if it appears to be the same as before</span>
<span class="sd">            contrast (int) : contrast to show in case image_class is ``&quot;fmri&quot;``</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">image_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">image_name</span> <span class="o">=</span> <span class="n">image_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">image_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">image_class</span> <span class="o">=</span> <span class="n">image_class</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_image_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">image_class</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_class</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">contrast</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_image_name</span> <span class="o">==</span> <span class="n">image_name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_reload</span><span class="p">:</span>
            <span class="c1"># nothing to do</span>
            <span class="k">return</span>

        <span class="c1"># save window and level values (only for standard image class)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_class</span> <span class="o">==</span> <span class="s2">&quot;IMAGE&quot;</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetEnabled</span><span class="p">():</span>
            <span class="n">window_level</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetWindowLevel</span><span class="p">(</span><span class="n">window_level</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__past_window_levels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_image_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">window_level</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_name</span> <span class="o">=</span> <span class="n">image_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_class</span> <span class="o">=</span> <span class="n">image_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span> <span class="o">=</span> <span class="n">contrast</span>

        <span class="k">if</span> <span class="n">image_class</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_image_plane_widget</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>

        <span class="c1"># update image labels:</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">image_name</span> <span class="o">==</span> <span class="s2">&quot;WMPARC&quot;</span><span class="p">:</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;WMPARC&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;APARC&quot;</span>
            <span class="n">aparc_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LABEL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span>
                                        <span class="n">format</span><span class="o">=</span><span class="s2">&quot;VTK&quot;</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">)</span>
            <span class="n">aparc_lut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LABEL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">addLabels</span><span class="p">(</span><span class="n">aparc_img</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">setLabelsLut</span><span class="p">(</span><span class="n">aparc_lut</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;APARC image not found&quot;</span><span class="p">)</span>
            <span class="c1"># raise Exception(&quot;Aparc not available&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">addLabels</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">image_class</span> <span class="o">==</span> <span class="s2">&quot;FMRI&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mri_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IMAGE&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">&quot;VTK&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MRI&quot;</span><span class="p">,</span>
                                            <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">)</span>
                <span class="n">fmri_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fMRI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">&quot;VTK&quot;</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span>
                                             <span class="n">name</span><span class="o">=</span><span class="n">image_name</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="n">contrast</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">fmri_image</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">mri_image</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;FMRI IMAGE NOT FOUND pdgm = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">image_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">fmri_image</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">mri_image</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>
                <span class="c1"># raise</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not available for subject </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">))</span>
            <span class="n">fmri_lut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;fMRI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="c1"># we need to load the mri image first to get a valid</span>
            <span class="c1"># window_level</span>
            <span class="n">w_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__past_window_levels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MRI&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">w_l</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">w_l</span> <span class="o">=</span> <span class="n">estimate_window_level</span><span class="p">(</span><span class="n">mri_image</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__window_level_lut</span><span class="o">.</span><span class="n">SetWindow</span><span class="p">(</span><span class="n">w_l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__window_level_lut</span><span class="o">.</span><span class="n">SetLevel</span><span class="p">(</span><span class="n">w_l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__fmri_blender</span><span class="o">.</span><span class="n">set_luts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__window_level_lut</span><span class="p">,</span> <span class="n">fmri_lut</span><span class="p">)</span>
            <span class="n">new_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fmri_blender</span><span class="o">.</span><span class="n">set_images</span><span class="p">(</span><span class="n">mri_image</span><span class="p">,</span> <span class="n">fmri_image</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">new_image</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__outline_filter</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">new_image</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetColorMap</span><span class="p">()</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetResliceInterpolateToCubic</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_class</span> <span class="o">=</span> <span class="n">image_class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_name</span> <span class="o">=</span> <span class="n">image_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">text1_value_from_img</span><span class="p">(</span><span class="n">fmri_image</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hidden</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">elif</span> <span class="n">image_class</span> <span class="o">==</span> <span class="s2">&quot;DTI&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dti_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;DTI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">&quot;VTK&quot;</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">)</span>
                <span class="n">fa_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IMAGE&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">&quot;VTK&quot;</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span>
                                           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;FA&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;DTI, not available&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;DTI, not available&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">dti_image</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__outline_filter</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">dti_image</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetResliceInterpolateToCubic</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">text1_value_from_img</span><span class="p">(</span><span class="n">fa_image</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetColorMap</span><span class="p">()</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hidden</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># Other images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">text1_to_std</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">image_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span>
                                        <span class="n">name</span><span class="o">=</span><span class="n">image_name</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">&quot;VTK&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>
            <span class="k">raise</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">new_image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__outline_filter</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">new_image</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">image_class</span> <span class="o">==</span> <span class="s2">&quot;IMAGE&quot;</span><span class="p">:</span>
            <span class="n">lut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__window_level_lut</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="n">lut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetResliceInterpolateToCubic</span><span class="p">()</span>
            <span class="n">w_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__past_window_levels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">image_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">w_l</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reset_window_level</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetWindowLevel</span><span class="p">(</span>
                    <span class="o">*</span><span class="n">w_l</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">image_class</span> <span class="o">==</span> <span class="s2">&quot;LABEL&quot;</span><span class="p">:</span>
            <span class="n">lut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LABEL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">image_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="n">lut</span><span class="p">)</span>

            <span class="c1"># Important:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetResliceInterpolateToNearestNeighbour</span><span class="p">()</span>

        <span class="c1"># self.__current_image = modality</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hidden</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ImageManager.change_image_orientation"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.change_image_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">change_image_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orientation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the orientation of the current image</span>

<span class="sd">        Args:</span>
<span class="sd">            orientation (int) : 0 for X, 1 for Y and 2 for Z</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_orientation</span> <span class="o">=</span> <span class="n">orientation</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Set an image first&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">set_orientation</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_orientation</span> <span class="o">=</span> <span class="n">orientation</span></div>

<div class="viewcode-block" id="ImageManager.get_number_of_image_slices"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.get_number_of_image_slices">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_image_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the number of slices in the current orientation</span>

<span class="sd">        Returns:</span>
<span class="sd">            The number of available slicer for the current image and orientation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetInput</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">GetDimensions</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">dimensions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_image_orientation</span><span class="p">]</span></div>

<div class="viewcode-block" id="ImageManager.get_current_image_slice"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.get_current_image_slice">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_image_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the index of the actual slice</span>

<span class="sd">        Returns:</span>
<span class="sd">            The index of the current slice</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetSliceIndex</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ImageManager.set_image_slice"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.set_image_slice">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_slice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the image slice</span>

<span class="sd">        Args:</span>
<span class="sd">            new_slice (int) : Number of the desired slice</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetSliceIndex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">new_slice</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">slice_change_event</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImageManager.get_current_image_window"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.get_current_image_window">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_image_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Current window</span>

<span class="sd">        Returns:</span>
<span class="sd">            Current window value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetWindow</span><span class="p">()</span></div>

<div class="viewcode-block" id="ImageManager.get_current_image_level"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.get_current_image_level">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_image_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Current level</span>

<span class="sd">        Returns:</span>
<span class="sd">            Current level value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetLevel</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ImageManager.set_image_window"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.set_image_window">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_window</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes window value</span>

<span class="sd">        Args:</span>
<span class="sd">            new_window (float) : New window value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetWindowLevel</span><span class="p">(</span>
            <span class="n">new_window</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_image_level</span><span class="p">())</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ImageManager.set_image_level"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.set_image_level">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes level value</span>

<span class="sd">        Args:</span>
<span class="sd">            new_level (float) : New level value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetWindowLevel</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_current_image_window</span><span class="p">(),</span> <span class="n">new_level</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ImageManager.reset_window_level"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ImageManager.reset_window_level">[docs]</a>    <span class="k">def</span> <span class="nf">reset_window_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets window and level to standard values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_image_class</span> <span class="o">==</span> <span class="s2">&quot;IMAGE&quot;</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">GetInput</span><span class="p">()</span>
            <span class="n">window</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">estimate_window_level</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">SetWindowLevel</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_plane_widget</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="s2">&quot;WindowLevelEvent&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ModelManager"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ModelManager">[docs]</a><span class="k">class</span> <span class="nc">ModelManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A manager for segmented structure models</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">ren</span><span class="p">,</span> <span class="n">initial_subj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_space</span><span class="o">=</span><span class="s2">&quot;subject&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a model manager</span>

<span class="sd">        Args:</span>
<span class="sd">            reader (braviz.visualization.base_reader.BaseReader) : Braviz reader</span>
<span class="sd">            ren (vtkRenderer) : Renderer in which to draw the models</span>
<span class="sd">            initial_subj : Code of initial subject, if None an arbitrary subject will be selected</span>
<span class="sd">            initial_space (str) : Initial coordinate system</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">conf</span> <span class="o">=</span> <span class="n">braviz</span><span class="o">.</span><span class="n">readAndFilter</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_apps_config</span><span class="p">()</span>
        <span class="n">lat_var</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">get_laterality</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat_idx</span> <span class="o">=</span> <span class="n">braviz</span><span class="o">.</span><span class="n">readAndFilter</span><span class="o">.</span><span class="n">tabular_data</span><span class="o">.</span><span class="n">get_var_idx</span><span class="p">(</span>
            <span class="n">lat_var</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_handed</span> <span class="o">=</span> <span class="n">lat_var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span> <span class="o">=</span> <span class="n">ren</span>
        <span class="k">if</span> <span class="n">initial_subj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="n">braviz</span><span class="o">.</span><span class="n">readAndFilter</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_apps_config</span><span class="p">()</span>
            <span class="n">initial_subj</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">get_default_subject</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__active_models_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__available_models</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">initial_subj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">initial_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__actor_to_model</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># for picking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__laterality</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># visual attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reload_models</span><span class="p">(</span>
            <span class="n">subj</span><span class="o">=</span><span class="n">initial_subj</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="n">initial_space</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_laterality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">braviz</span><span class="o">.</span><span class="n">readAndFilter</span><span class="o">.</span><span class="n">tabular_data</span><span class="o">.</span><span class="n">get_var_value</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lat_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Laterality no found for subject </span><span class="si">%s</span><span class="s2">, assuming right handed&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_handed</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;l&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;r&quot;</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ModelManager.reload_models"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ModelManager.reload_models">[docs]</a>    <span class="k">def</span> <span class="nf">reload_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reloads all models</span>

<span class="sd">        Args:</span>
<span class="sd">            subj : Code for new subject, if ``None`` the subject is not changed</span>
<span class="sd">            space (str) : new coordinate system, if ``None`` the coordinates are not changed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">subj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">subj</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__available_models</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MODEL&quot;</span><span class="p">,</span> <span class="n">subj</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__available_models</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__laterality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_laterality</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">space</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">subj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__refresh_models</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__refresh_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">mod_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_models_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__addModel</span><span class="p">(</span><span class="n">mod_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__available_models</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No models found&quot;</span><span class="p">)</span>
            <span class="c1"># raise Exception(&quot;No models found&quot;)</span>

    <span class="k">def</span> <span class="nf">__addModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">):</span>
        <span class="c1"># if already exists make visible</span>
        <span class="n">trio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">model</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span> <span class="o">=</span> <span class="n">trio</span>
            <span class="n">rl_name</span> <span class="o">=</span> <span class="n">solve_laterality</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__laterality</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rl_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__available_models</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s1">&#39;MODEL&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">rl_name</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">)</span>
                <span class="n">mapper</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Hide</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># New model</span>
            <span class="n">rl_name</span> <span class="o">=</span> <span class="n">solve_laterality</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__laterality</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rl_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__available_models</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s1">&#39;MODEL&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">rl_name</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">)</span>
                <span class="n">model_mapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
                <span class="n">model_actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
                <span class="n">model_properties</span> <span class="o">=</span> <span class="n">model_actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">model_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;MODEL&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">rl_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
                    <span class="n">model_properties</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">model_color</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">model_properties</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span><span class="p">)</span>
                <span class="n">model_properties</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span><span class="p">)</span>
                <span class="n">model_properties</span><span class="o">.</span><span class="n">LightingOn</span><span class="p">()</span>
                <span class="n">model_mapper</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="n">model_actor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">model_mapper</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">model_actor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">model</span><span class="p">,</span> <span class="n">model_mapper</span><span class="p">,</span> <span class="n">model_actor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__actor_to_model</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">model_actor</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model_name</span>

                <span class="c1"># actor=self.__pd_map_act[model_name][2]</span>
                <span class="c1"># model_volume=self.__reader.get(&#39;model&#39;,self.currSubj,name=model_name,volume=1)</span>
                <span class="c1"># add_solid_balloon(balloon_widget, actor, model_name,model_volume)</span>

    <span class="k">def</span> <span class="nf">__removeModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes internal data structures</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check that it actually exists</span>
        <span class="n">trio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trio</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span> <span class="o">=</span> <span class="n">trio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">RemoveActor</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__actor_to_model</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">actor</span><span class="p">)]</span>
        <span class="c1"># balloon_widget.RemoveBalloon(actor)</span>
        <span class="k">del</span> <span class="n">actor</span>
        <span class="k">del</span> <span class="n">mapper</span>
        <span class="k">del</span> <span class="n">model</span>

    <span class="k">def</span> <span class="nf">__hide_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">):</span>
        <span class="n">trio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trio</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">actor</span> <span class="o">=</span> <span class="n">trio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ModelManager.set_models"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ModelManager.set_models">[docs]</a>    <span class="k">def</span> <span class="nf">set_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_model_set</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the currently shown models</span>

<span class="sd">        Args:</span>
<span class="sd">            new_model_set (set) : An iterable of strings with names of valid models.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_model_set</span><span class="p">)</span>
        <span class="n">current_models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_models_set</span>

        <span class="n">to_add</span> <span class="o">=</span> <span class="n">new_set</span> <span class="o">-</span> <span class="n">current_models</span>
        <span class="n">to_hide</span> <span class="o">=</span> <span class="n">current_models</span> <span class="o">-</span> <span class="n">new_set</span>

        <span class="c1"># print &quot;act:&quot;, self.__active_models_set</span>
        <span class="c1"># print &quot;new&quot; , new_set</span>
        <span class="c1"># print &quot;hide&quot;, to_hide</span>

        <span class="k">for</span> <span class="n">mod_name</span> <span class="ow">in</span> <span class="n">to_add</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__addModel</span><span class="p">(</span><span class="n">mod_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mod_name</span> <span class="ow">in</span> <span class="n">to_hide</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__hide_model</span><span class="p">(</span><span class="n">mod_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__active_models_set</span> <span class="o">=</span> <span class="n">new_set</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ModelManager.set_opacity"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ModelManager.set_opacity">[docs]</a>    <span class="k">def</span> <span class="nf">set_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_opacity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opacity for displaying the models</span>

<span class="sd">        Args:</span>
<span class="sd">            int_opacity (int) : A number from 0 to 100; where 0 is invisible and 100 is opaque</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">float_opacity</span> <span class="o">=</span> <span class="n">int_opacity</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span> <span class="o">=</span> <span class="n">float_opacity</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ac</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span>
            <span class="n">prop</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="n">float_opacity</span><span class="p">)</span></div>

<div class="viewcode-block" id="ModelManager.get_opacity"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ModelManager.get_opacity">[docs]</a>    <span class="k">def</span> <span class="nf">get_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets actual opacity</span>

<span class="sd">        Returns:</span>
<span class="sd">            An integer from 0 to 100 indicating the current opacity percentage</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span> <span class="o">*</span> <span class="mi">100</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="ModelManager.set_color"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ModelManager.set_color">[docs]</a>    <span class="k">def</span> <span class="nf">set_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">float_rgb_color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the color for displaying the models</span>

<span class="sd">        Args:</span>
<span class="sd">            float_rgb_color (tuple) : An rgb value, if ``None`` the freesurfer lookuptable is used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span> <span class="o">=</span> <span class="n">float_rgb_color</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">rl_name</span> <span class="o">=</span> <span class="n">solve_laterality</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__laterality</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="n">model_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s1">&#39;MODEL&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">rl_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="n">prop</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">model_color</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prop</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span><span class="p">)</span></div>

<div class="viewcode-block" id="ModelManager.get_scalar_metrics"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.ModelManager.get_scalar_metrics">[docs]</a>    <span class="k">def</span> <span class="nf">get_scalar_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an scalar metric from the current models</span>

<span class="sd">        Args:</span>
<span class="sd">            metric_name (str): May be</span>

<span class="sd">                - ``volume`` : Total volume occupied by all models</span>
<span class="sd">                - ``area`` : Sum of superficial areas of all models</span>
<span class="sd">                - ``fa_inside`` : Mean value of FA inside the current models</span>
<span class="sd">                - ``md_inside`` : Mean value of MD inside the current models</span>
<span class="sd">                - ``nfibers`` : Number of fibers that cross any of the current models</span>
<span class="sd">                - ``lfibers`` : Mean length of fibers that cross any of the current models</span>
<span class="sd">                - ``fa-fibers`` : Mean FA of fibers that cross any of the current models</span>
<span class="sd">        Returns:</span>
<span class="sd">            Scalar value or ``nan`` if there was an error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_models_set</span>
        <span class="n">rl_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">solve_laterality</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__laterality</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">structure_metrics</span><span class="o">.</span><span class="n">get_mult_struct_metric</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="p">,</span> <span class="n">rl_models</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">metric_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="TractographyManager"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager">[docs]</a><span class="k">class</span> <span class="nc">TractographyManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A manager for tractography data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">ren</span><span class="p">,</span> <span class="n">initial_subj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_space</span><span class="o">=</span><span class="s2">&quot;subject&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the tractography manager</span>

<span class="sd">        Args:</span>
<span class="sd">            reader (braviz.visualization.base_reader.BaseReader) : Braviz reader</span>
<span class="sd">            ren (vtkRenderer) : Renderer in which to draw the planeow</span>
<span class="sd">            initial_subj : Code of initial subject, if None an arbitrary subject will be selected</span>
<span class="sd">            initial_space (str) : Initial coordinate system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span> <span class="o">=</span> <span class="n">ren</span>
        <span class="k">if</span> <span class="n">initial_subj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">initial_subj</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ids&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">initial_subj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">initial_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span> <span class="o">=</span> <span class="s2">&quot;orient&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_color_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;orient&quot;</span><span class="p">,</span> <span class="s2">&quot;scalars&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lut</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__show_color_bar</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_pd_mp_ac</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_fiber_checks</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_throug_all</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_visibility</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__db_tracts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__active_db_tracts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bundle_colors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bundle_labels</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TractographyManager.set_subject"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.set_subject">[docs]</a>    <span class="k">def</span> <span class="nf">set_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the subject associated to the manager</span>

<span class="sd">        Args:</span>
<span class="sd">            subj : New subject</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">subj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reload_fibers</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TractographyManager.set_current_space"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.set_current_space">[docs]</a>    <span class="k">def</span> <span class="nf">set_current_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">space</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set current coordinate system</span>

<span class="sd">        new_space (str) : new coordinate system, see :meth:`~braviz.readAndFilter.base_reader.BaseReader.get`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reload_fibers</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TractographyManager.set_bundle_from_checkpoints"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.set_bundle_from_checkpoints">[docs]</a>    <span class="k">def</span> <span class="nf">set_bundle_from_checkpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoints</span><span class="p">,</span> <span class="n">through_all</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a fiber bundle based on a list of structures</span>

<span class="sd">        Args:</span>
<span class="sd">            checkpoints (list) : Structure model names list</span>
<span class="sd">            through_all (bool): If ``True`` the bundle will contain lines that pass though all checkpoints,</span>
<span class="sd">                otherwise it will contain lines that pass through any checkpoint</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">checkpoints</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">checkpoints</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_fiber_checks</span> <span class="o">=</span> <span class="n">checkpoints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_throug_all</span> <span class="o">=</span> <span class="n">through_all</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_visibility</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hock_checkpoints</span> <span class="o">=</span> <span class="n">checkpoints</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_pd_mp_ac</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
            <span class="n">actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_pd_mp_ac</span>
        <span class="k">if</span> <span class="n">through_all</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">operation</span> <span class="o">=</span> <span class="s2">&quot;and&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">operation</span> <span class="o">=</span> <span class="s2">&quot;or&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">poly_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Fibers&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">waypoint</span><span class="o">=</span><span class="n">checkpoints</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
                                        <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_color_parameters</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">poly_data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_pd_mp_ac</span> <span class="o">=</span> <span class="p">(</span><span class="n">poly_data</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Fibers not found&quot;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span><span class="p">)</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">poly_data</span><span class="p">)</span>

            <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span> <span class="o">==</span> <span class="s2">&quot;bundle&quot;</span><span class="p">:</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bundle_colors</span><span class="p">()</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__set_lut_in_maper</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_pd_mp_ac</span> <span class="o">=</span> <span class="p">(</span><span class="n">poly_data</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
        <span class="k">return</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TractographyManager.hide_checkpoints_bundle"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.hide_checkpoints_bundle">[docs]</a>    <span class="k">def</span> <span class="nf">hide_checkpoints_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hide the checkpoints bundle created with :meth:`set_bundle_from_checkpoints`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_pd_mp_ac</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">act</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_pd_mp_ac</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">act</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_visibility</span> <span class="o">=</span> <span class="bp">False</span></div>

    <span class="k">def</span> <span class="nf">__set_lut_in_maper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapper</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span> <span class="o">==</span> <span class="s2">&quot;bundle&quot;</span><span class="p">:</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">SetScalarVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">mapper</span><span class="o">.</span><span class="n">SetScalarVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># print &quot;setting lut&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lut</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">SetColorModeToDefault</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">SetScalarVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">UseLookupTableScalarRangeOn</span><span class="p">()</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">SetColorModeToMapScalars</span><span class="p">()</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lut</span><span class="p">)</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TractographyManager.add_from_database"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.add_from_database">[docs]</a>    <span class="k">def</span> <span class="nf">add_from_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a bundle from the database</span>

<span class="sd">        See :mod:`braviz.readAndFilter.bundles_db`</span>

<span class="sd">        Args:</span>
<span class="sd">            b_id (int) : Bundle id in the database</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__active_db_tracts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__db_tracts</span><span class="p">:</span>
            <span class="n">mapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
            <span class="n">actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__db_tracts</span><span class="p">[</span><span class="n">b_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__db_tracts</span><span class="p">[</span><span class="n">b_id</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">poly_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_polydata</span><span class="p">(</span><span class="n">b_id</span><span class="p">)</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">poly_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t load fibers from db&quot;</span><span class="p">)</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__db_tracts</span><span class="p">[</span><span class="n">b_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">poly_data</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
        <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span> <span class="o">==</span> <span class="s2">&quot;bundle&quot;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bundle_colors</span><span class="p">()</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__bundle_labels</span><span class="p">[</span><span class="n">b_id</span><span class="p">]]</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_lut_in_maper</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span></div>

<div class="viewcode-block" id="TractographyManager.get_bundle_colors"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.get_bundle_colors">[docs]</a>    <span class="k">def</span> <span class="nf">get_bundle_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a set of colors for coloring each active bundle in a different color</span>

<span class="sd">        Returns:</span>
<span class="sd">            A color palette with length equal to the number of active bundles</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># reserve one color for ad_hoc bundles</span>
        <span class="n">number_of_bundles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__active_db_tracts</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bundle_colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bundle_colors</span><span class="p">)</span> <span class="o">==</span> <span class="n">number_of_bundles</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bundle_colors</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="n">sbs</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Set2&quot;</span><span class="p">,</span> <span class="n">number_of_bundles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bundle_colors</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="c1"># print colors</span>
        <span class="k">return</span> <span class="n">colors</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TractographyManager.set_show_color_bar"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.set_show_color_bar">[docs]</a>    <span class="k">def</span> <span class="nf">set_show_color_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Activates a vtk color bar</span>

<span class="sd">        Args:</span>
<span class="sd">            value (bool) : If ``True`` the bar is activated, if ``False`` it is hidden</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__show_color_bar</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_color_bar</span><span class="p">()</span></div>

<div class="viewcode-block" id="TractographyManager.get_show_color_bar"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.get_show_color_bar">[docs]</a>    <span class="k">def</span> <span class="nf">get_show_color_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Status of the color bar</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``True`` if the color bar is active, ``False`` otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__show_color_bar</span></div>

<div class="viewcode-block" id="TractographyManager.get_polydata"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.get_polydata">[docs]</a>    <span class="k">def</span> <span class="nf">get_polydata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the polydata object associated to a database bundle.</span>

<span class="sd">        The current subject, coordinate system and scalars are maintained</span>

<span class="sd">        Args:</span>
<span class="sd">            b_id (int) :  Bundle database id</span>

<span class="sd">        Returns:</span>
<span class="sd">            vtkPolyData from the requested bundle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FIBERS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span>
                               <span class="n">db_id</span><span class="o">=</span><span class="n">b_id</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_color_parameters</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">poly</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TractographyManager.hide_database_tract"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.hide_database_tract">[docs]</a>    <span class="k">def</span> <span class="nf">hide_database_tract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides a bundle previously added from the database</span>

<span class="sd">        Args:</span>
<span class="sd">            bid (int) : Bundle database id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__db_tracts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trio</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">actor</span> <span class="o">=</span> <span class="n">trio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__active_db_tracts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bid</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TractographyManager.change_color"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.change_color">[docs]</a>    <span class="k">def</span> <span class="nf">change_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the coloring scheme for the rendered data.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_color (str) : New coloring scheme, the following values are accepted</span>

<span class="sd">                - ``bundle`` : A different color for each bundle</span>
<span class="sd">                - ``orient`` : Color tractography based on local orientation</span>
<span class="sd">                - ``rand`` : A different color for each line</span>
<span class="sd">                - ``fa_p`` : Use FA values at each point and a lookuptable</span>
<span class="sd">                - ``fa_l`` : Use mean fa of each line and a lookuptable</span>
<span class="sd">                - ``md_p`` : Use MD values at each point and a lookuptable</span>
<span class="sd">                - ``md_l`` : Use mean MD of each line and a lookuptable</span>
<span class="sd">                - ``length``: Use length of each line and a lookuptable</span>
<span class="sd">                - ``aparc``: Use the *aparc* label at each point and the freesurfer lookuptable</span>
<span class="sd">                - ``wmparc``: Use the *wmparc* label at each point and the freesurfer lookuptable</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span> <span class="o">==</span> <span class="n">new_color</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span> <span class="o">=</span> <span class="n">new_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lut</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">new_color</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;bundle&quot;</span><span class="p">,</span> <span class="s2">&quot;orient&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_color_parameters</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;orient&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_color_parameters</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="n">new_color</span> <span class="o">==</span> <span class="s2">&quot;rand&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_color_parameters</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;rand&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_color_parameters</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_color_parameters</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_color_parameters</span><span class="p">[</span><span class="s2">&quot;scalars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_color</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;Fibers&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="n">new_color</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># print self.__current_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_color_bar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reload_fibers</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__set_color_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_color_parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scalars&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__show_color_bar</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">scalars</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkScalarBarActor</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="o">.</span><span class="n">SetNumberOfLabels</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkScalarBarWidget</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span><span class="o">.</span><span class="n">SetScalarBarActor</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span><span class="o">.</span><span class="n">RepositionableOn</span><span class="p">()</span>
                <span class="n">iren</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetRenderWindow</span><span class="p">()</span><span class="o">.</span><span class="n">GetInteractor</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span><span class="o">.</span><span class="n">SetInteractor</span><span class="p">(</span><span class="n">iren</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>

                <span class="n">rep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span>
                <span class="n">coord1</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">GetPositionCoordinate</span><span class="p">()</span>
                <span class="n">coord2</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">GetPosition2Coordinate</span><span class="p">()</span>
                <span class="n">coord1</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
                <span class="n">coord2</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lut</span><span class="p">)</span>
            <span class="c1"># self.__color_bar_actor.SetTitle(scalars[:2].upper())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__reload_fibers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># reload ad_hoc</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_visibility</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_bundle_from_checkpoints</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_fiber_checks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_throug_all</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># reload db</span>
        <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_db_tracts</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_from_database</span><span class="p">(</span><span class="n">bid</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TractographyManager.set_active_db_tracts"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.set_active_db_tracts">[docs]</a>    <span class="k">def</span> <span class="nf">set_active_db_tracts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_set</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects active database tracts</span>

<span class="sd">        Args:</span>
<span class="sd">            new_set (list) : List of database ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_set</span><span class="p">)</span>
        <span class="n">to_hide</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_db_tracts</span> <span class="o">-</span> <span class="n">new_set</span>
        <span class="n">to_add</span> <span class="o">=</span> <span class="n">new_set</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_db_tracts</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bundle_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="p">:</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_set</span><span class="p">)}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">to_hide</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hide_database_tract</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__active_db_tracts</span> <span class="o">=</span> <span class="n">new_set</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">to_add</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_from_database</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">errors</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">errors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t load all tracts&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_color</span> <span class="o">==</span> <span class="s2">&quot;bundle&quot;</span><span class="p">:</span>
            <span class="c1"># we need to refresh all active bundles to get colors right</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__reload_fibers</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TractographyManager.set_opacity"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.set_opacity">[docs]</a>    <span class="k">def</span> <span class="nf">set_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">float_opacity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets opacity for the displayed bundles</span>

<span class="sd">        Args:</span>
<span class="sd">            float_opacity (float) : From 0 to 1; where 0 is transparent and 1 is opaque</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span> <span class="o">=</span> <span class="n">float_opacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reload_fibers</span><span class="p">()</span></div>

<div class="viewcode-block" id="TractographyManager.get_scalar_from_db"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.get_scalar_from_db">[docs]</a>    <span class="k">def</span> <span class="nf">get_scalar_from_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">,</span> <span class="n">bid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets an scalar metric from an active database bundle</span>

<span class="sd">        Args:</span>
<span class="sd">            scalar (str) : Scalar metric, available options are:</span>

<span class="sd">                - ``number`` : Number of lines</span>
<span class="sd">                - ``mean_length`` : Mean length of lines</span>
<span class="sd">                - ``mean_fa`` : Mean FA of the bundle</span>
<span class="sd">                - ``mean_md`` : Mean MD of the bundle</span>

<span class="sd">            bid (int) :  Database id</span>

<span class="sd">        Returns:</span>
<span class="sd">            Scalar value or ``nan`` if there was an error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">bid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_db_tracts</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_length&quot;</span><span class="p">):</span>
                    <span class="n">pd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__db_tracts</span><span class="p">[</span><span class="n">bid</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">structure_metrics</span><span class="o">.</span><span class="n">get_scalar_from_fiber_ploydata</span><span class="p">(</span><span class="n">pd</span><span class="p">,</span> <span class="n">scalar</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">scalar</span> <span class="o">==</span> <span class="s2">&quot;mean_fa&quot;</span><span class="p">:</span>
                    <span class="n">fiber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FIBERS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span>
                                            <span class="n">db_id</span><span class="o">=</span><span class="n">bid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;fa_p&quot;</span><span class="p">)</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">structure_metrics</span><span class="o">.</span><span class="n">get_scalar_from_fiber_ploydata</span><span class="p">(</span>
                        <span class="n">fiber</span><span class="p">,</span> <span class="s2">&quot;mean_color&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">n</span>
                <span class="k">elif</span> <span class="n">scalar</span> <span class="o">==</span> <span class="s2">&quot;mean_md&quot;</span><span class="p">:</span>
                    <span class="n">fiber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FIBERS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span>
                                            <span class="n">db_id</span><span class="o">=</span><span class="n">bid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;md_p&quot;</span><span class="p">)</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">structure_metrics</span><span class="o">.</span><span class="n">get_scalar_from_fiber_ploydata</span><span class="p">(</span>
                        <span class="n">fiber</span><span class="p">,</span> <span class="s2">&quot;mean_color&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">n</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TractographyManager.get_scalar_from_structs"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TractographyManager.get_scalar_from_structs">[docs]</a>    <span class="k">def</span> <span class="nf">get_scalar_from_structs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets an scalar metric from the active checkpoints bundle</span>

<span class="sd">        see :meth:`set_bundle_from_checkpoints`</span>

<span class="sd">        Args:</span>
<span class="sd">            scalar (str) : Scalar metric, available options are:</span>

<span class="sd">                - ``number`` : Number of lines</span>
<span class="sd">                - ``mean_length`` : Mean length of lines</span>
<span class="sd">                - ``mean_fa`` : Mean FA of the bundle</span>
<span class="sd">                - ``mean_md`` : Mean MD of the bundle</span>

<span class="sd">        Returns:</span>
<span class="sd">            Scalar value or ``nan`` if there was an error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_visibility</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_length&quot;</span><span class="p">):</span>
                <span class="n">fiber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_pd_mp_ac</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">structure_metrics</span><span class="o">.</span><span class="n">get_scalar_from_fiber_ploydata</span><span class="p">(</span>
                    <span class="n">fiber</span><span class="p">,</span> <span class="n">scalar</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">n</span>
            <span class="k">elif</span> <span class="n">scalar</span> <span class="o">==</span> <span class="s2">&quot;mean_fa&quot;</span><span class="p">:</span>
                <span class="n">operation</span> <span class="o">=</span> <span class="s2">&quot;and&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_throug_all</span> <span class="k">else</span> <span class="s2">&quot;or&quot;</span>
                <span class="n">fiber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Fibers&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">waypoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__ad_hock_checkpoints</span><span class="p">,</span>
                                        <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;fa_p&quot;</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">structure_metrics</span><span class="o">.</span><span class="n">get_scalar_from_fiber_ploydata</span><span class="p">(</span>
                    <span class="n">fiber</span><span class="p">,</span> <span class="s2">&quot;mean_color&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">n</span>
            <span class="k">elif</span> <span class="n">scalar</span> <span class="o">==</span> <span class="s2">&quot;mean_md&quot;</span><span class="p">:</span>
                <span class="n">operation</span> <span class="o">=</span> <span class="s2">&quot;and&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ad_hoc_throug_all</span> <span class="k">else</span> <span class="s2">&quot;or&quot;</span>
                <span class="n">fiber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Fibers&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">waypoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__ad_hock_checkpoints</span><span class="p">,</span>
                                        <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;md_p&quot;</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">structure_metrics</span><span class="o">.</span><span class="n">get_scalar_from_fiber_ploydata</span><span class="p">(</span>
                    <span class="n">fiber</span><span class="p">,</span> <span class="s2">&quot;mean_color&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">n</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TraculaManager"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TraculaManager">[docs]</a><span class="k">class</span> <span class="nc">TraculaManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A data manager for Tracula bundles</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">ren</span><span class="p">,</span> <span class="n">initial_subj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_space</span><span class="o">=</span><span class="s2">&quot;subject&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the manager</span>

<span class="sd">        Args:</span>
<span class="sd">            reader (braviz.visualization.base_reader.BaseReader) : Braviz reader</span>
<span class="sd">            ren (vtkRenderer) : Renderer in which to draw the models</span>
<span class="sd">            initial_subj : Code of initial subject, if None an arbitrary subject will be selected</span>
<span class="sd">            initial_space (str) : Initial coordinate system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span> <span class="o">=</span> <span class="n">ren</span>
        <span class="k">if</span> <span class="n">initial_subj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">initial_subj</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ids&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__active_bundles_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">initial_subj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">initial_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__actor_to_model</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># for picking</span>

        <span class="c1"># visual attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reload_bundles</span><span class="p">(</span>
            <span class="n">subj</span><span class="o">=</span><span class="n">initial_subj</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="n">initial_space</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TraculaManager.reload_bundles"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TraculaManager.reload_bundles">[docs]</a>    <span class="k">def</span> <span class="nf">reload_bundles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subj</span><span class="p">,</span> <span class="n">space</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reloads all bundles</span>

<span class="sd">        Args:</span>
<span class="sd">            subj : Code for new subject, if ``None`` the subject is not changed</span>
<span class="sd">            space (str) : new coordinate system, if ``None`` the coordinates are not changed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">subj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">space</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_bundles_set</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__load_bundle</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__hide_bundle</span><span class="p">(</span><span class="n">b</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TraculaManager.set_bundles"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TraculaManager.set_bundles">[docs]</a>    <span class="k">def</span> <span class="nf">set_bundles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the currently shown bundles</span>

<span class="sd">        Args:</span>
<span class="sd">            bundle_names (set) : An iterable of strings with names of tracula bundles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wanted_bundles</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">bundle_names</span><span class="p">)</span>
        <span class="n">to_add</span> <span class="o">=</span> <span class="n">wanted_bundles</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_bundles_set</span>
        <span class="n">to_hide</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_bundles_set</span> <span class="o">-</span> <span class="n">wanted_bundles</span>

        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">to_add</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__load_bundle</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">to_hide</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__hide_bundle</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__active_bundles_set</span> <span class="o">=</span> <span class="n">wanted_bundles</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="TraculaManager.set_opacity"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.TraculaManager.set_opacity">[docs]</a>    <span class="k">def</span> <span class="nf">set_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_opacity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opacity for displaying the models</span>

<span class="sd">        Args:</span>
<span class="sd">            int_opacity (int) : A number from 0 to 100; where 0 is invisible and 100 is opaque</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_bundles_set</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">ac</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="n">int_opacity</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__load_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_name</span><span class="p">):</span>
        <span class="n">trio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bundle_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trio</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;TRACULA&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">bundle_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">mapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">ScalarVisibilityOff</span><span class="p">()</span>
            <span class="n">actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pd</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span> <span class="o">=</span> <span class="n">trio</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;TRACULA&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">bundle_name</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">pd</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">pd</span><span class="p">)</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="p">[</span><span class="n">bundle_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hide_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_name</span><span class="p">):</span>
        <span class="n">trio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pd_map_act</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bundle_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trio</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">ac</span> <span class="o">=</span> <span class="n">trio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ac</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">active_bundles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the set of active bundles</span>

<span class="sd">        Returns:</span>
<span class="sd">            A frozenSet of currently active bundles</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_bundles_set</span></div>


<div class="viewcode-block" id="SurfaceManager"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SurfaceManager">[docs]</a><span class="k">class</span> <span class="nc">SurfaceManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A data manager for freesurfer sufaces parcelations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">ren</span><span class="p">,</span> <span class="n">iren</span><span class="p">,</span> <span class="n">initial_subj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_space</span><span class="o">=</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="n">picker</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">persistent_cone</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the manager</span>

<span class="sd">        Args:</span>
<span class="sd">            reader (braviz.visualization.base_reader.BaseReader) : Braviz reader</span>
<span class="sd">            ren (vtkRenderer) : Renderer in which to draw the plane</span>
<span class="sd">            iren (vtkRenderWindowInteractor) : The render window interactor of the output window</span>
<span class="sd">            initial_subj : Code of initial subject, if None an arbitrary subject will be selected</span>
<span class="sd">            initial_space (str) : Initial coordinate system</span>
<span class="sd">            picker (vtkPicker) : A vtkPicker may be used to pick on several objects. If None a new picker is created</span>
<span class="sd">            persistent_cone (bool) : If ``True`` the cone used for picking will not disappear at the end of</span>
<span class="sd">                the operation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span> <span class="o">=</span> <span class="n">ren</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picker</span> <span class="o">=</span> <span class="n">picker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span> <span class="o">=</span> <span class="n">iren</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picking_event</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">UserEvent</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__persistent_cone</span> <span class="o">=</span> <span class="n">persistent_cone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__last_picked_pos</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__left_active</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__right_active</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_surface</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_scalars</span> <span class="o">=</span> <span class="s2">&quot;curv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lut</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__surf_trios</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">initial_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__subject</span> <span class="o">=</span> <span class="n">initial_subj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span> <span class="o">=</span> <span class="mi">100</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__active_color_bar</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># for interaction</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">picker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__picking_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cone_trio</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__locators</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__active_picking</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__picking_events</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__picking_text</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__create_pick_cone</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__create_pick_text</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setup_picking</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__update_lut</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__create_pick_cone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coneSource</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkConeSource</span><span class="p">()</span>
        <span class="n">coneSource</span><span class="o">.</span><span class="n">CappingOn</span><span class="p">()</span>
        <span class="n">coneSource</span><span class="o">.</span><span class="n">SetHeight</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">coneSource</span><span class="o">.</span><span class="n">SetRadius</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">coneSource</span><span class="o">.</span><span class="n">SetResolution</span><span class="p">(</span><span class="mi">31</span><span class="p">)</span>
        <span class="n">coneSource</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">coneSource</span><span class="o">.</span><span class="n">SetDirection</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">coneMapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkDataSetMapper</span><span class="p">()</span>
        <span class="n">coneMapper</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="n">coneSource</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>

        <span class="n">redCone</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
        <span class="n">redCone</span><span class="o">.</span><span class="n">PickableOff</span><span class="p">()</span>
        <span class="n">redCone</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">coneMapper</span><span class="p">)</span>
        <span class="n">redCone</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">redCone</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">redCone</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cone_trio</span> <span class="o">=</span> <span class="n">coneSource</span><span class="p">,</span> <span class="n">coneMapper</span><span class="p">,</span> <span class="n">redCone</span>

    <span class="k">def</span> <span class="nf">__create_pick_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text2</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTextActor</span><span class="p">()</span>
        <span class="n">cor</span> <span class="o">=</span> <span class="n">text2</span><span class="o">.</span><span class="n">GetPositionCoordinate</span><span class="p">()</span>
        <span class="n">cor</span><span class="o">.</span><span class="n">SetCoordinateSystemToNormalizedDisplay</span><span class="p">()</span>
        <span class="n">text2</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">([</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>
        <span class="n">text2</span><span class="o">.</span><span class="n">SetInput</span><span class="p">(</span><span class="s1">&#39;probando&#39;</span><span class="p">)</span>
        <span class="n">tprop</span> <span class="o">=</span> <span class="n">text2</span><span class="o">.</span><span class="n">GetTextProperty</span><span class="p">()</span>
        <span class="n">tprop</span><span class="o">.</span><span class="n">SetJustificationToRight</span><span class="p">()</span>
        <span class="n">tprop</span><span class="o">.</span><span class="n">SetFontSize</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
        <span class="n">text2</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__picking_text</span> <span class="o">=</span> <span class="n">text2</span>

    <span class="k">def</span> <span class="nf">__point_cone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span><span class="p">):</span>
        <span class="n">actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cone_trio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">actor</span><span class="o">.</span><span class="n">SetOrientation</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ny</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">nz</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nx</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">RotateWXYZ</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span>
        <span class="n">actor</span><span class="o">.</span><span class="n">RotateWXYZ</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="p">(</span><span class="n">nx</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ny</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">nz</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setup_picking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_message</span><span class="p">(</span><span class="n">picker</span><span class="p">):</span>
            <span class="n">hemi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__picking_dict</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">())]</span>
            <span class="n">pd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__surf_trios</span><span class="p">[</span><span class="n">hemi</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ptId</span> <span class="o">=</span> <span class="n">picker</span><span class="o">.</span><span class="n">GetPointId</span><span class="p">()</span>
            <span class="n">point_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span>
            <span class="n">scalars</span> <span class="o">=</span> <span class="n">point_data</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">()</span>
            <span class="n">scalar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_scalars</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">scalars</span><span class="o">.</span><span class="n">GetTuple</span><span class="p">(</span><span class="n">ptId</span><span class="p">)</span>
            <span class="n">annotations</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;aparc&#39;</span><span class="p">,</span> <span class="s1">&#39;aparc.a2009s&#39;</span><span class="p">,</span> <span class="s1">&#39;BA&#39;</span><span class="p">,</span> <span class="s2">&quot;aparc.DKTatlas40&quot;</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">scalar</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lut</span><span class="o">.</span><span class="n">GetAnnotation</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-Label: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">picking</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="n">active_picking</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_picking</span>
            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;MouseMoveEvent&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">active_picking</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;LeftButtonReleaseEvent&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__active_picking</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__persistent_cone</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__cone_trio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__picking_text</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;done picking&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">GetEventPosition</span><span class="p">()</span>
            <span class="n">picked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">GetPickPosition</span><span class="p">()</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">GetPickNormal</span><span class="p">()</span>
            <span class="n">picked_prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">GetProp3D</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">picked</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">picked_prop</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__picking_dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__active_picking</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">redCone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cone_trio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">redCone</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">picking_event</span><span class="p">)</span>
                <span class="n">redCone</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__last_picked_pos</span> <span class="o">=</span> <span class="n">p</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__point_cone</span><span class="p">(</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__picking_text</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">redCone</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">get_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__picking_text</span><span class="o">.</span><span class="n">SetInput</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="n">event_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__picking_events</span><span class="p">[</span><span class="n">event</span><span class="p">]</span>
                <span class="n">command</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">GetCommand</span><span class="p">(</span><span class="n">event_id</span><span class="p">)</span>
                <span class="n">command</span><span class="o">.</span><span class="n">SetAbortFlag</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__active_picking</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__persistent_cone</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__cone_trio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__picking_text</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">iren</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iren</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__picking_events</span><span class="p">[</span><span class="s2">&quot;LeftButtonPressEvent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iren</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">LeftButtonPressEvent</span><span class="p">,</span> <span class="n">picking</span><span class="p">,</span>
                                                                         <span class="mi">10</span><span class="p">)</span>
        <span class="n">iren</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">LeftButtonReleaseEvent</span><span class="p">,</span> <span class="n">picking</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__picking_events</span><span class="p">[</span><span class="s2">&quot;MouseMoveEvent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iren</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">MouseMoveEvent</span><span class="p">,</span> <span class="n">picking</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__update_hemisphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="c1"># print &quot;updating hemisphere &quot;,h</span>
        <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
            <span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__left_active</span>
        <span class="k">elif</span> <span class="n">h</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
            <span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__right_active</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown hemisphere </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">h</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown hemisphere </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">h</span><span class="p">)</span>

        <span class="n">trio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__surf_trios</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">active</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trio</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">ac</span> <span class="o">=</span> <span class="n">trio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">ac</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">trio</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lut</span><span class="p">)</span>
            <span class="n">actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__picking_dict</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">actor</span><span class="p">)]</span> <span class="o">=</span> <span class="n">h</span>
            <span class="n">locator</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellTreeLocator</span><span class="p">()</span>
            <span class="n">locator</span><span class="o">.</span><span class="n">LazyEvaluationOn</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__locators</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">locator</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">picker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">AddLocator</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">AddPickList</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">surf</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span> <span class="o">=</span> <span class="n">trio</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;surf&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__subject</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_surface</span><span class="p">,</span> <span class="n">hemi</span><span class="o">=</span><span class="n">h</span><span class="p">,</span>
                                   <span class="n">scalars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_scalars</span><span class="p">,</span>
                                   <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">surf</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__locators</span><span class="p">[</span><span class="n">h</span><span class="p">]</span><span class="o">.</span><span class="n">SetDataSet</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>

        <span class="n">trio</span> <span class="o">=</span> <span class="n">surf</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">actor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__surf_trios</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">trio</span>

    <span class="k">def</span> <span class="nf">__update_lut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__subject</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;SURF_SCALAR&quot;</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_scalars</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">hemi</span><span class="o">=</span><span class="s2">&quot;l&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">trio</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__surf_trios</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">mapper</span> <span class="o">=</span> <span class="n">trio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="n">lut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lut</span> <span class="o">=</span> <span class="n">lut</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_color_bar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="n">lut</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__update_both</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_hemisphere</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_hemisphere</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">)</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="SurfaceManager.set_hemispheres"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SurfaceManager.set_hemispheres">[docs]</a>    <span class="k">def</span> <span class="nf">set_hemispheres</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the active hemisphers</span>

<span class="sd">        Args:</span>
<span class="sd">            left (bool) : If ``True`` the left hemisphere is activated, if ``False`` it is deactivated,</span>
<span class="sd">                if ``None`` it is unchanged</span>
<span class="sd">            right (bool) : If ``True`` the right hemisphere is activated, if ``False`` it is deactivated,</span>
<span class="sd">                if ``None`` it is unchanged</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">left</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__left_active</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__left_active</span> <span class="o">=</span> <span class="n">left</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__update_hemisphere</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">right</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">right</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__right_active</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__right_active</span> <span class="o">=</span> <span class="n">right</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__update_hemisphere</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="SurfaceManager.set_scalars"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SurfaceManager.set_scalars">[docs]</a>    <span class="k">def</span> <span class="nf">set_scalars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalars</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the current scalars to use for the surfaces</span>

<span class="sd">        Args:</span>
<span class="sd">            scalars (str) : See :meth:`braviz.readAndFilter.base_reader.BaseReader.get` for options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">scalars</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_scalars</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_scalars</span> <span class="o">=</span> <span class="n">scalars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_both</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_lut</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="SurfaceManager.set_surface"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SurfaceManager.set_surface">[docs]</a>    <span class="k">def</span> <span class="nf">set_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the current surface to display at both hemispheres</span>

<span class="sd">        Args:</span>
<span class="sd">            surface (str) : See :meth:`braviz.readAndFilter.base_reader.BaseReader.get` for options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">surface</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">surface</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_surface</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_surface</span> <span class="o">=</span> <span class="n">surface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_both</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="SurfaceManager.show_color_bar"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SurfaceManager.show_color_bar">[docs]</a>    <span class="k">def</span> <span class="nf">show_color_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Activates a vtk color bar</span>

<span class="sd">        Args:</span>
<span class="sd">            value (bool) : If ``True`` the bar is activated, if ``False`` it is hidden</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">show</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_color_bar</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__active_color_bar</span> <span class="o">=</span> <span class="n">show</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">show</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkScalarBarActor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="o">.</span><span class="n">SetNumberOfLabels</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkScalarBarWidget</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span><span class="o">.</span><span class="n">SetScalarBarActor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span><span class="o">.</span><span class="n">RepositionableOn</span><span class="p">()</span>
            <span class="n">iren</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iren</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span><span class="o">.</span><span class="n">SetInteractor</span><span class="p">(</span><span class="n">iren</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>
            <span class="n">rep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_widget</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span>
            <span class="n">coord1</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">GetPositionCoordinate</span><span class="p">()</span>
            <span class="n">coord2</span> <span class="o">=</span> <span class="n">rep</span><span class="o">.</span><span class="n">GetPosition2Coordinate</span><span class="p">()</span>
            <span class="n">coord1</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
            <span class="n">coord2</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__color_bar_actor</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="SurfaceManager.set_subject"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SurfaceManager.set_subject">[docs]</a>    <span class="k">def</span> <span class="nf">set_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_subject</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change subject associated to the manager</span>

<span class="sd">        Args:</span>
<span class="sd">            new_subject : Id of new subject</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__subject</span> <span class="o">=</span> <span class="n">new_subject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_both</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="SurfaceManager.set_space"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SurfaceManager.set_space">[docs]</a>    <span class="k">def</span> <span class="nf">set_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_space</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change current coordinate system</span>

<span class="sd">        new_space (str) : new coordinate system, see :meth:`~braviz.readAndFilter.base_reader.BaseReader.get`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">new_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_both</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="SurfaceManager.set_opacity"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SurfaceManager.set_opacity">[docs]</a>    <span class="k">def</span> <span class="nf">set_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_opacity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opacity for displaying the surfaces</span>

<span class="sd">        Args:</span>
<span class="sd">            int_opacity (int) : A number from 0 to 100; where 0 is invisible and 100 is opaque</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">int_opacity</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span> <span class="o">=</span> <span class="n">int_opacity</span>
        <span class="k">for</span> <span class="n">trio</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__surf_trios</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">ac</span> <span class="o">=</span> <span class="n">trio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">opac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__opacity</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="n">ac</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="n">opac</span><span class="p">)</span></div>

<div class="viewcode-block" id="SurfaceManager.hide_cone"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SurfaceManager.hide_cone">[docs]</a>    <span class="k">def</span> <span class="nf">hide_cone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides the picking cone</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cone_trio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__picking_text</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="SurfaceManager.get_last_picked_pos"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SurfaceManager.get_last_picked_pos">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_picked_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Coordinates of the last picked position</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple with the coordinates of the last pickedposition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_picked_pos</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pick_cone_actor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the pick cone actor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cone_trio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></div>


<div class="viewcode-block" id="OrthogonalPlanesViewer"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer">[docs]</a><span class="k">class</span> <span class="nc">OrthogonalPlanesViewer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A viewer with three orthogonal planes</span>

<span class="sd">    It provides access to</span>

<span class="sd">        - Images</span>
<span class="sd">        - Surfaces</span>
<span class="sd">        - A sphere</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">render_window_interactor</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the viewer</span>

<span class="sd">        Args:</span>
<span class="sd">            render_window_interactor (vtkRenderWindowInteractor) : The intaractor that will be used with this viewer</span>
<span class="sd">            widget (QObject) : Must implement *slice_change_handle* and *window_level_change_handle*</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># render_window_interactor.Initialize()</span>
        <span class="c1"># render_window_interactor.Start()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span> <span class="o">=</span> <span class="n">render_window_interactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span> <span class="o">=</span> <span class="n">render_window_interactor</span><span class="o">.</span><span class="n">GetRenderWindow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkRenderer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">((</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GradientBackgroundOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground2</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">((</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetUseDepthPeeling</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">SetMultiSamples</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">AlphaBitPlanesOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetOcclusionRatio</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">AddRenderer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="o">.</span><span class="n">SetInteractorStyle</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkInteractorStyleTrackballCamera</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">OrientationAxes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">light</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkLight</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddLight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light</span><span class="o">.</span><span class="n">SetLightTypeToHeadlight</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__widget</span> <span class="o">=</span> <span class="n">widget</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">picker</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellPicker</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">SetTolerance</span><span class="p">(</span><span class="mf">0.0005</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="o">.</span><span class="n">SetPicker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>

        <span class="c1"># state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="s2">&quot;subject&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_class</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_name</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># internal data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span> <span class="o">=</span> <span class="n">AdditionalCursors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__x_image_manager</span> <span class="o">=</span> <span class="n">ImageManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">widget</span><span class="p">,</span> <span class="n">interactor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">,</span>
                                              <span class="n">picker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__y_image_manager</span> <span class="o">=</span> <span class="n">ImageManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">widget</span><span class="p">,</span> <span class="n">interactor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">,</span>
                                              <span class="n">picker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__z_image_manager</span> <span class="o">=</span> <span class="n">ImageManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">widget</span><span class="p">,</span> <span class="n">interactor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">,</span>
                                              <span class="n">picker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__x_image_manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__y_image_manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__z_image_manager</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">change_image_orientation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">change_image_orientation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">change_image_orientation</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_image</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__sphere</span> <span class="o">=</span> <span class="n">SphereProp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cortex</span> <span class="o">=</span> <span class="n">SurfaceManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span><span class="p">,</span>
                                       <span class="n">picker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">,</span> <span class="n">persistent_cone</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__active_cursor_plane</span> <span class="o">=</span> <span class="bp">True</span>

<div class="viewcode-block" id="OrthogonalPlanesViewer.finish_initializing"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer.finish_initializing">[docs]</a>    <span class="k">def</span> <span class="nf">finish_initializing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finish viewer initialization, only call this after calling &quot;show&quot; on the widget or its parents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_link_window_level</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connect_cursors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">ResetCameraClippingRange</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">ResetCamera</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_link_window_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Link window and level of all planes</span>

<span class="sd">        call after initializing the planes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_class</span> <span class="o">==</span> <span class="s2">&quot;IMAGE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_connect_cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects the additional cursors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">draw_cursor2</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cortex</span><span class="o">.</span><span class="n">hide_cone</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__active_cursor_plane</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">caller</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">caller</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">pw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_planes</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">image_plane_widget</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">GetCurrentCursorPosition</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">coords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">set_axis_coords</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">slice_movement</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cortex</span><span class="o">.</span><span class="n">hide_cone</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__active_cursor_plane</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">last_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">get_coords</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">last_pos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">last_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">last_pos</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">caller</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">caller</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_planes</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">get_current_image_slice</span><span class="p">()</span>
            <span class="n">last_pos</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">sl</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">set_axis_coords</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">last_pos</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">cursor_change_event</span><span class="p">,</span> <span class="n">draw_cursor2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">cursor_change_event</span><span class="p">,</span> <span class="n">draw_cursor2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">cursor_change_event</span><span class="p">,</span> <span class="n">draw_cursor2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">slice_change_event</span><span class="p">,</span> <span class="n">slice_movement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">slice_change_event</span><span class="p">,</span> <span class="n">slice_movement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">slice_change_event</span><span class="p">,</span> <span class="n">slice_movement</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">change_cursor_to_cone</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__active_cursor_plane</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cortex</span><span class="o">.</span><span class="n">pick_cone_actor</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cortex</span><span class="o">.</span><span class="n">picking_event</span><span class="p">,</span> <span class="n">change_cursor_to_cone</span><span class="p">)</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="OrthogonalPlanesViewer.show_image"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer.show_image">[docs]</a>    <span class="k">def</span> <span class="nf">show_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows all planes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span><span class="p">:</span>
            <span class="n">im</span><span class="o">.</span><span class="n">show_image</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="OrthogonalPlanesViewer.hide_image"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer.hide_image">[docs]</a>    <span class="k">def</span> <span class="nf">hide_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hide all planes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span><span class="p">:</span>
            <span class="n">im</span><span class="o">.</span><span class="n">hide_image</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="OrthogonalPlanesViewer.change_subject"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer.change_subject">[docs]</a>    <span class="k">def</span> <span class="nf">change_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the subject associated to the viewer</span>

<span class="sd">        Args:</span>
<span class="sd">            new_subject : new subject id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">im</span><span class="o">.</span><span class="n">change_subject</span><span class="p">(</span><span class="n">subj</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">ex</span> <span class="o">=</span> <span class="n">e</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cortex</span><span class="o">.</span><span class="n">set_subject</span><span class="p">(</span><span class="n">subj</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cortex not found for subject </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">subj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ex</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">set_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetInput</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_link_window_level</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="OrthogonalPlanesViewer.change_image_modality"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer.change_image_modality">[docs]</a>    <span class="k">def</span> <span class="nf">change_image_modality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_class</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change image modality in all planes</span>

<span class="sd">        See :meth:`ImageManager.change_image_modality`</span>


<span class="sd">        Args:</span>
<span class="sd">            image_class (str): New image class (IMAGE, LABELS or FMRI)</span>
<span class="sd">            image_name (str): New image name, for fMRI enter the paradigm here</span>
<span class="sd">            contrast (int): If modality is fMRI the index of the contrast</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">image_class</span> <span class="o">=</span> <span class="n">image_class</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">image_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">image_name</span> <span class="o">=</span> <span class="n">image_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">im</span><span class="o">.</span><span class="n">change_image_modality</span><span class="p">(</span>
                    <span class="n">image_class</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="n">contrast</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_class</span> <span class="o">=</span> <span class="n">image_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_name</span> <span class="o">=</span> <span class="n">image_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">set_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetInput</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_link_window_level</span><span class="p">()</span></div>

<div class="viewcode-block" id="OrthogonalPlanesViewer.get_number_of_slices"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer.get_number_of_slices">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get number of slices in each plane</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple with the image dimension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetInput</span><span class="p">()</span><span class="o">.</span><span class="n">GetDimensions</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">n_slices</span></div>

<div class="viewcode-block" id="OrthogonalPlanesViewer.get_current_slice"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer.get_current_slice">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get current slices of all planes</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple with the current slice of each plane (x,y,z)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">get_current_image_slice</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">get_current_image_slice</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">get_current_image_slice</span><span class="p">(),)</span></div>

<div class="viewcode-block" id="OrthogonalPlanesViewer.get_camera_parameters"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer.get_camera_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets current camera parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            focal_point, position, view_up</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetFocalPoint</span><span class="p">()</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span>
        <span class="n">vu</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetViewUp</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fp</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">vu</span></div>

<div class="viewcode-block" id="OrthogonalPlanesViewer.set_camera"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer.set_camera">[docs]</a>    <span class="k">def</span> <span class="nf">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focal_point</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">view_up</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the camera position</span>

<span class="sd">        Args:</span>
<span class="sd">            focal_point (tuple) : Focal point</span>
<span class="sd">            position (tuple) : Camera position</span>
<span class="sd">            view_up (tuple) : View up vector</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">focal_point</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetViewUp</span><span class="p">(</span><span class="n">view_up</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">ResetCameraClippingRange</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">image_planes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the image planes array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the image manager perpendicular to x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__x_image_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the image manager perpendicular to y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__y_image_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">z_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the image manager perpendicular to z</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__z_image_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the sphere</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sphere</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cortex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the surface manager</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cortex</span>

<div class="viewcode-block" id="OrthogonalPlanesViewer.current_position"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer.current_position">[docs]</a>    <span class="k">def</span> <span class="nf">current_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Last picked position, either on the planes or on the surface</span>

<span class="sd">        Returns:</span>
<span class="sd">            Coordinates of the last picked position</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__active_cursor_plane</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cortex</span><span class="o">.</span><span class="n">get_last_picked_pos</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="OrthogonalPlanesViewer.change_space"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.OrthogonalPlanesViewer.change_space">[docs]</a>    <span class="k">def</span> <span class="nf">change_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_space</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the current coordinate system</span>

<span class="sd">        Args:</span>
<span class="sd">            new_space (str) : New coordinate system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_planes</span><span class="p">:</span>
            <span class="n">im</span><span class="o">.</span><span class="n">change_space</span><span class="p">(</span><span class="n">new_space</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cortex</span><span class="o">.</span><span class="n">set_space</span><span class="p">(</span><span class="n">new_space</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">new_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">set_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetInput</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="MeasurerViewer"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer">[docs]</a><span class="k">class</span> <span class="nc">MeasurerViewer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A viewer that allows the user to measure the distance between two points on images using a vtkMeasureWidget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">camera_positions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">5.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">535</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>  <span class="c1"># SAGITAL</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">5.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">5.5</span><span class="p">,</span> <span class="mi">530</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>  <span class="c1"># CORONAL</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">550</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>  <span class="c1"># AXIAL</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">render_window_interactor</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the viewer</span>

<span class="sd">        Args:</span>
<span class="sd">            render_window_interactor (vtkRenderWindowInteractor) : The intaractor that will be used with this viewer</span>
<span class="sd">            widget (QObject) : Must implement *slice_change_handle*, *window_level_change_handle*</span>
<span class="sd">                and *distance_changed_handle*</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span> <span class="o">=</span> <span class="n">render_window_interactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span> <span class="o">=</span> <span class="n">render_window_interactor</span><span class="o">.</span><span class="n">GetRenderWindow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkRenderer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">((</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GradientBackgroundOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground2</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">((</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetUseDepthPeeling</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">SetMultiSamples</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">AlphaBitPlanesOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetOcclusionRatio</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">AddRenderer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="o">.</span><span class="n">SetInteractorStyle</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkInteractorStyleTrackballCamera</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">OrientationAxes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">light</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkLight</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddLight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light</span><span class="o">.</span><span class="n">SetLightTypeToHeadlight</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__widget</span> <span class="o">=</span> <span class="n">widget</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">picker</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellPicker</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">SetTolerance</span><span class="p">(</span><span class="mf">0.0005</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="o">.</span><span class="n">SetPicker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__measure_axis</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pax1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pax2</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>  <span class="c1"># perpendicular to measure axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_measure_axis</span><span class="p">(</span><span class="s2">&quot;axial&quot;</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c1"># state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="s2">&quot;talairach&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_modality</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_class</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># internal data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__x_image_manager</span> <span class="o">=</span> <span class="n">ImageManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">widget</span><span class="p">,</span> <span class="n">interactor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">,</span>
                                              <span class="n">picker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__y_image_manager</span> <span class="o">=</span> <span class="n">ImageManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">widget</span><span class="p">,</span> <span class="n">interactor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">,</span>
                                              <span class="n">picker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__z_image_manager</span> <span class="o">=</span> <span class="n">ImageManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">widget</span><span class="p">,</span> <span class="n">interactor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">,</span>
                                              <span class="n">picker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__x_image_manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__y_image_manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__z_image_manager</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">change_image_orientation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">change_image_orientation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">change_image_orientation</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c1"># for pw in self.__image_planes:</span>
        <span class="c1">#    pw.image_plane_widget.InteractionOff()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_image</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__placed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkDistanceWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">KeyPressActivationOff</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkDistanceRepresentation3D</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">GetLineProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetLineWidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">SetLabelFormat</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">RulerModeOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">SetRulerDistance</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">SetRepresentation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">SetInteractor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">obs_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_id2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_id3</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_restrict_points_to_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restrict the measure widget points to the plane surfaces</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modifiers</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">keyboardModifiers</span><span class="p">()</span>
        <span class="n">straight</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span> <span class="o">&amp;</span> <span class="n">modifiers</span><span class="p">:</span>
            <span class="n">straight</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__measure_axis</span>
        <span class="n">slice_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_planes</span><span class="p">[</span>
            <span class="n">ax</span><span class="p">]</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetSlicePosition</span><span class="p">()</span>
        <span class="n">plane_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plane_point</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">slice_coords</span>
        <span class="n">pa1</span><span class="p">,</span> <span class="n">pa2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pax1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pax2</span>

        <span class="n">representation</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">GetRepresentation</span><span class="p">()</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">representation</span><span class="o">.</span><span class="n">GetPoint1Representation</span><span class="p">()</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">representation</span><span class="o">.</span><span class="n">GetPoint2Representation</span><span class="p">()</span>
        <span class="n">r1i</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">GetInteractionState</span><span class="p">()</span>
        <span class="n">r2i</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">GetInteractionState</span><span class="p">()</span>
        <span class="n">camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">view_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">GetDirectionOfProjection</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">r1i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__placed</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">representation</span><span class="o">.</span><span class="n">GetPoint1WorldPosition</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">view_vec</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">slice_coords</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="n">ax</span><span class="p">])</span> <span class="o">/</span> <span class="n">view_vec</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">view_vec</span> <span class="o">*</span> <span class="n">t</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p1</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">slice_coords</span>

            <span class="k">if</span> <span class="n">straight</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__placed</span><span class="p">:</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">representation</span><span class="o">.</span><span class="n">GetPoint2WorldPosition</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
                <span class="n">dif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">ref</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dif</span><span class="p">[</span><span class="n">pa1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dif</span><span class="p">[</span><span class="n">pa2</span><span class="p">]:</span>
                    <span class="n">p1</span><span class="p">[</span><span class="n">pa2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="n">pa2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p1</span><span class="p">[</span><span class="n">pa1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="n">pa1</span><span class="p">]</span>
            <span class="n">representation</span><span class="o">.</span><span class="n">SetPoint1WorldPosition</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__placed</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">representation</span><span class="o">.</span><span class="n">GetPoint2WorldPosition</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">view_vec</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">slice_coords</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="n">ax</span><span class="p">])</span> <span class="o">/</span> <span class="n">view_vec</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">+</span> <span class="n">view_vec</span> <span class="o">*</span> <span class="n">t</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p2</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">slice_coords</span>
            <span class="k">if</span> <span class="n">straight</span><span class="p">:</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">representation</span><span class="o">.</span><span class="n">GetPoint1WorldPosition</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
                <span class="n">dif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p2</span> <span class="o">-</span> <span class="n">ref</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dif</span><span class="p">[</span><span class="n">pa1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dif</span><span class="p">[</span><span class="n">pa2</span><span class="p">]:</span>
                    <span class="n">p2</span><span class="p">[</span><span class="n">pa2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="n">pa2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p2</span><span class="p">[</span><span class="n">pa1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="n">pa1</span><span class="p">]</span>
            <span class="n">representation</span><span class="o">.</span><span class="n">SetPoint2WorldPosition</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

<div class="viewcode-block" id="MeasurerViewer.finish_initializing"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.finish_initializing">[docs]</a>    <span class="k">def</span> <span class="nf">finish_initializing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finish viewer initialization, only call this after calling &quot;show&quot; on the widget or its parents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">SetPriority</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetPriority</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">PlacePointEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restrict_points_to_plane</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_id2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">InteractionEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restrict_points_to_plane</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_id3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkCommand</span><span class="o">.</span><span class="n">InteractionEvent</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">emit_distance_changed_signal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_link_window_level</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">ResetCameraClippingRange</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">ResetCamera</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_link_window_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Link window and level of all planes</span>

<span class="sd">        call after initializing the planes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_class</span> <span class="o">==</span> <span class="s2">&quot;IMAGE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">())</span>

        <span class="k">def</span> <span class="nf">slice_movement</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">caller</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">caller</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_planes</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">get_current_image_slice</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__measure_axis</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__placed</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_planes</span><span class="p">[</span>
                    <span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetSlicePosition</span><span class="p">()</span>
                <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">GetPoint1WorldPosition</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">GetPoint2WorldPosition</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
                <span class="n">p1</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
                <span class="n">p2</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">SetPoint1WorldPosition</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">SetPoint2WorldPosition</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
                <span class="c1"># self.ren_win.Render()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">slice_change_event</span><span class="p">,</span> <span class="n">slice_movement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">slice_change_event</span><span class="p">,</span> <span class="n">slice_movement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">slice_change_event</span><span class="p">,</span> <span class="n">slice_movement</span><span class="p">)</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.set_measure_axis"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.set_measure_axis">[docs]</a>    <span class="k">def</span> <span class="nf">set_measure_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the measure plane to be perpendicular to the axis</span>

<span class="sd">        Args:</span>
<span class="sd">            axis_str (str) : &quot;axial&quot;, &quot;sagital&quot; or &quot;coronal&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">_axis_dict</span><span class="p">[</span><span class="n">axis_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__measure_axis</span> <span class="o">=</span> <span class="n">axis</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pax1</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pax2</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pax1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pax2</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pax1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pax2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_camera</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.set_slice_coords"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.set_slice_coords">[docs]</a>    <span class="k">def</span> <span class="nf">set_slice_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the measure plane perpendicularly</span>

<span class="sd">        Args:</span>
<span class="sd">            coords (float) : New position across the axis perpendicular to the measure plane</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_planes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__measure_axis</span><span class="p">]</span><span class="o">.</span><span class="n">image_plane_widget</span>
        <span class="n">pw</span><span class="o">.</span><span class="n">SetSlicePosition</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">pw</span><span class="o">.</span><span class="n">InvokeEvent</span><span class="p">(</span><span class="n">pw</span><span class="o">.</span><span class="n">slice_change_event</span><span class="p">)</span></div>

<div class="viewcode-block" id="MeasurerViewer.emit_distance_changed_signal"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.emit_distance_changed_signal">[docs]</a>    <span class="k">def</span> <span class="nf">emit_distance_changed_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emit a Qt Signal through the associated widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__widget</span><span class="o">.</span><span class="n">distance_changed_handle</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.show_image"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.show_image">[docs]</a>    <span class="k">def</span> <span class="nf">show_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows all planes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span><span class="p">:</span>
            <span class="n">im</span><span class="o">.</span><span class="n">show_image</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.hide_image"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.hide_image">[docs]</a>    <span class="k">def</span> <span class="nf">hide_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hide all planes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span><span class="p">:</span>
            <span class="n">im</span><span class="o">.</span><span class="n">hide_image</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.change_subject"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.change_subject">[docs]</a>    <span class="k">def</span> <span class="nf">change_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the subject associated to the viewer</span>

<span class="sd">        Args:</span>
<span class="sd">            new_subject : new subject id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">im</span><span class="o">.</span><span class="n">change_subject</span><span class="p">(</span><span class="n">subj</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_link_window_level</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.change_image_modality"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.change_image_modality">[docs]</a>    <span class="k">def</span> <span class="nf">change_image_modality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_class</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change image modality in all planes</span>

<span class="sd">        See :meth:`ImageManager.change_image_modality`</span>


<span class="sd">        Args:</span>
<span class="sd">            image_class (str): New image class, must be FMRI, IMAGE, LABEL or DTI</span>
<span class="sd">            mod (str): New modality name, for fMRI enter the paradigm here</span>
<span class="sd">            contrast (int): If modality is fMRI the index of the contrast</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">image_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">image_class</span> <span class="o">=</span> <span class="n">image_class</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span><span class="p">:</span>
            <span class="n">im</span><span class="o">.</span><span class="n">change_image_modality</span><span class="p">(</span><span class="n">image_class</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="n">contrast</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_modality</span> <span class="o">=</span> <span class="n">mod</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_class</span> <span class="o">=</span> <span class="n">image_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_link_window_level</span><span class="p">()</span></div>

<div class="viewcode-block" id="MeasurerViewer.get_number_of_slices"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.get_number_of_slices">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get number of slices in each plane</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple with the image dimension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetInput</span><span class="p">()</span><span class="o">.</span><span class="n">GetDimensions</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">n_slices</span></div>

<div class="viewcode-block" id="MeasurerViewer.get_current_slice"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.get_current_slice">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get current slices of all planes</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple with the current slice of each plane (x,y,z)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_image</span><span class="o">.</span><span class="n">get_current_image_slice</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_image</span><span class="o">.</span><span class="n">get_current_image_slice</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">get_current_image_slice</span><span class="p">(),)</span></div>

<div class="viewcode-block" id="MeasurerViewer.get_camera_parameters"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.get_camera_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets current camera parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            focal_point, position, view_up</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetFocalPoint</span><span class="p">()</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span>
        <span class="n">vu</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetViewUp</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fp</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">vu</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.reset_camera"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.reset_camera">[docs]</a>    <span class="k">def</span> <span class="nf">reset_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets camera to the initial position</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fp</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">vu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_positions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__measure_axis</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">vu</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.set_camera"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.set_camera">[docs]</a>    <span class="k">def</span> <span class="nf">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focal_point</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">view_up</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the camera position</span>

<span class="sd">        Args:</span>
<span class="sd">            focal_point (tuple) : Focal point</span>
<span class="sd">            position (tuple) : Camera position</span>
<span class="sd">            view_up (tuple) : View up vector</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">focal_point</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetViewUp</span><span class="p">(</span><span class="n">view_up</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">ResetCameraClippingRange</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">image_planes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the image planes array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_planes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the image manager perpendicular to x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__x_image_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the image manager perpendicular to y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__y_image_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">z_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the image manager perpendicular to z</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__z_image_manager</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.change_space"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.change_space">[docs]</a>    <span class="k">def</span> <span class="nf">change_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_space</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the current coordinate system</span>

<span class="sd">        Args:</span>
<span class="sd">            new_space (str) : New coordinate system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_planes</span><span class="p">:</span>
            <span class="n">im</span><span class="o">.</span><span class="n">change_space</span><span class="p">(</span><span class="n">new_space</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="n">new_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.reset_measure"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.reset_measure">[docs]</a>    <span class="k">def</span> <span class="nf">reset_measure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the measure widget, remove both points from the scene</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">Off</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">SetWidgetStateToStart</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">On</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__placed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__widget</span><span class="o">.</span><span class="n">distance_changed_handle</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Current distance measured by the measure widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__placed</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">GetDistance</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">point1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get coordinates of first measure point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__placed</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">GetPoint1WorldPosition</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">p1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">point2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get coordinates of second measure point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__placed</span><span class="p">:</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">GetPoint2WorldPosition</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">p2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.set_points"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.set_points">[docs]</a>    <span class="k">def</span> <span class="nf">set_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set coordinates for both points</span>

<span class="sd">        Args:</span>
<span class="sd">            p1 (tuple) : First point coordinates</span>
<span class="sd">            p2 (tuple) : Second point coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">SetPoint1WorldPosition</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">SetPoint2WorldPosition</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__placed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_widget</span><span class="o">.</span><span class="n">SetWidgetStateToManipulate</span><span class="p">()</span>
            <span class="n">acs</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPropCollection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">GetActors</span><span class="p">(</span><span class="n">acs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">VisibilityOn</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__placed</span> <span class="o">=</span> <span class="bp">True</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="MeasurerViewer.set_measure_color"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.MeasurerViewer.set_measure_color">[docs]</a>    <span class="k">def</span> <span class="nf">set_measure_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color of the measure widget</span>

<span class="sd">        Args:</span>
<span class="sd">            r (int) : red</span>
<span class="sd">            g (int) : green</span>
<span class="sd">            b (int) : blue</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">r</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="n">g</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">255</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">GetLineProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_repr</span><span class="o">.</span><span class="n">GetGlyphActor</span><span class="p">()</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AdditionalCursors"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.AdditionalCursors">[docs]</a><span class="k">class</span> <span class="nc">AdditionalCursors</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An additional set of cursors to use when those included in vtkImageWidget are not flexible enough</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ren</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the cursors</span>

<span class="sd">        Args:</span>
<span class="sd">            ren (vtkRenderer) : Renderer into which the cursors will be drawn</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span> <span class="o">=</span> <span class="n">cursors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__coords</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__axis</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="p">)</span>

<div class="viewcode-block" id="AdditionalCursors.set_image"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.AdditionalCursors.set_image">[docs]</a>    <span class="k">def</span> <span class="nf">set_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Image to use as reference for the cursors</span>

<span class="sd">        Args:</span>
<span class="sd">            img (vtkImageData) : The cursors will stick to this image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image</span> <span class="o">=</span> <span class="n">img</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">GetDimensions</span><span class="p">()</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">GetSpacing</span><span class="p">()</span>
        <span class="n">org</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">GetOrigin</span><span class="p">()</span>
        <span class="n">max_sp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="o">.</span><span class="n">set_dimensions</span><span class="p">(</span><span class="o">*</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="o">.</span><span class="n">set_spacing</span><span class="p">(</span><span class="o">*</span><span class="n">sp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="o">.</span><span class="n">set_origin</span><span class="p">(</span><span class="o">*</span><span class="n">org</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="o">.</span><span class="n">set_delta</span><span class="p">(</span><span class="n">max_sp</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdditionalCursors.get_position"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.AdditionalCursors.get_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Current position of the cursors</span>

<span class="sd">        Returns:</span>
<span class="sd">            Coordinates of the last picked position (in mm)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__coords</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__coords</span><span class="p">)</span>
        <span class="n">org</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__image</span><span class="o">.</span><span class="n">GetOrigin</span><span class="p">())</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__image</span><span class="o">.</span><span class="n">GetSpacing</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">pos</span> <span class="o">*</span> <span class="n">sp</span> <span class="o">+</span> <span class="n">org</span></div>

<div class="viewcode-block" id="AdditionalCursors.get_coords"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.AdditionalCursors.get_coords">[docs]</a>    <span class="k">def</span> <span class="nf">get_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Voxel coordinates of last picked position</span>

<span class="sd">        Returns:</span>
<span class="sd">            Coordinates of last picked position in voxels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__coords</span></div>

<div class="viewcode-block" id="AdditionalCursors.set_axis_coords"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.AdditionalCursors.set_axis_coords">[docs]</a>    <span class="k">def</span> <span class="nf">set_axis_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set position of the cursors</span>

<span class="sd">        Args:</span>
<span class="sd">            axis (int) : Axis perpendicular to the cursor, 0 for x, 1 for y and 2 for z</span>
<span class="sd">            coords (tuple) : Position of the cursor in voxels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">coords</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__coords</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__axis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="o">.</span><span class="n">change_axis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__axis</span> <span class="o">=</span> <span class="n">axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__coords</span> <span class="o">=</span> <span class="n">coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="AdditionalCursors.hide"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.AdditionalCursors.hide">[docs]</a>    <span class="k">def</span> <span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hide cursor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursors</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SphereProp"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SphereProp">[docs]</a><span class="k">class</span> <span class="nc">SphereProp</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An sphere that can be added to any viewer to represent regions of interest</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ren</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the sphere prop</span>

<span class="sd">        Args:</span>
<span class="sd">            ren (vtkRenderer) : Renderer that will draw the sphere</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__source</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkSphereSource</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__center</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radius</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__RESOLUTION</span> <span class="o">=</span> <span class="mi">20</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mapper</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mapper</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__source</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__source</span><span class="o">.</span><span class="n">SetThetaResolution</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__RESOLUTION</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__source</span><span class="o">.</span><span class="n">SetPhiResolution</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__RESOLUTION</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__source</span><span class="o">.</span><span class="n">LatLongTessellationOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ren</span> <span class="o">=</span> <span class="n">ren</span>
        <span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="p">)</span>

<div class="viewcode-block" id="SphereProp.set_center"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SphereProp.set_center">[docs]</a>    <span class="k">def</span> <span class="nf">set_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the center of the sphere</span>

<span class="sd">        Args:</span>
<span class="sd">            ctr (tuple) : center</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__source</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="o">*</span><span class="n">ctr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__center</span> <span class="o">=</span> <span class="n">ctr</span></div>

<div class="viewcode-block" id="SphereProp.set_radius"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SphereProp.set_radius">[docs]</a>    <span class="k">def</span> <span class="nf">set_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the radius of the sphere</span>

<span class="sd">        Args:</span>
<span class="sd">            r (float) : Sphere radius</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__source</span><span class="o">.</span><span class="n">SetRadius</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radius</span> <span class="o">=</span> <span class="n">r</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radius</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__center</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">visible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="o">.</span><span class="n">GetVisibility</span><span class="p">()</span>

<div class="viewcode-block" id="SphereProp.set_repr"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SphereProp.set_repr">[docs]</a>    <span class="k">def</span> <span class="nf">set_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rep</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set representation of the sphere</span>

<span class="sd">        Args:</span>
<span class="sd">            rep (str): Options are ``&quot;wireframe&quot;`` or ``&quot;surface&quot;``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rep</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetRepresentationToWireframe</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetRepresentationToSurface</span><span class="p">()</span></div>

<div class="viewcode-block" id="SphereProp.hide"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SphereProp.hide">[docs]</a>    <span class="k">def</span> <span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hide the sphere</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="SphereProp.show"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SphereProp.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show the sphere</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="SphereProp.set_opacity"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SphereProp.set_opacity">[docs]</a>    <span class="k">def</span> <span class="nf">set_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opac_int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opacity of the sphere</span>

<span class="sd">        Args:</span>
<span class="sd">            opac_int (int) : A number from 0 to 100; where 0 is invisible and 100 is opaque</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opac</span> <span class="o">=</span> <span class="n">opac_int</span> <span class="o">/</span> <span class="mf">100.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="n">opac</span><span class="p">)</span></div>

<div class="viewcode-block" id="SphereProp.set_color"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SphereProp.set_color">[docs]</a>    <span class="k">def</span> <span class="nf">set_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set color of the measure widget</span>

<span class="sd">        Args:</span>
<span class="sd">            r (int) : red</span>
<span class="sd">            g (int) : green</span>
<span class="sd">            b (int) : blue</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetColor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></div>

<div class="viewcode-block" id="SphereProp.remove_from_renderer"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.SphereProp.remove_from_renderer">[docs]</a>    <span class="k">def</span> <span class="nf">remove_from_renderer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the sphere from the renderer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ren</span><span class="o">.</span><span class="n">RemoveActor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="QMeasurerWidget"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QMeasurerWidget">[docs]</a><span class="k">class</span> <span class="nc">QMeasurerWidget</span><span class="p">(</span><span class="n">QFrame</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Qt Widget that wraps :class:`MeasurerViewer` and lets it connect naturally to Qt Applications</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">slice_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">image_window_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">image_level_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">distance_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the measurer widget</span>

<span class="sd">        Args:</span>
<span class="sd">            reader (braviz.visualization.base_reader.BaseReader) : Braviz reader</span>
<span class="sd">            parent (QObject) : Parent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QFrame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span> <span class="o">=</span> <span class="n">QVTKRenderWindowInteractor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">filt</span> <span class="o">=</span> <span class="n">FilterArrows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_C</span><span class="p">,))</span>
        <span class="n">filt</span><span class="o">.</span><span class="n">key_pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="o">.</span><span class="n">installEventFilter</span><span class="p">(</span><span class="n">filt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__vtk_viewer</span> <span class="o">=</span> <span class="n">MeasurerViewer</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="p">)</span>

        <span class="c1"># self.subject_viewer.ren_win.Render()</span>

        <span class="c1"># self.__qwindow_interactor.show()</span>

<div class="viewcode-block" id="QMeasurerWidget.initialize_widget"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QMeasurerWidget.initialize_widget">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this function **after** calling show on the widget or a parent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="o">.</span><span class="n">Start</span><span class="p">()</span></div>
        <span class="c1"># self.__subject_viewer.show_cone()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">orthogonal_viewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the underlying class:`MeasurerViewer`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vtk_viewer</span>

<div class="viewcode-block" id="QMeasurerWidget.slice_change_handle"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QMeasurerWidget.slice_change_handle">[docs]</a>    <span class="k">def</span> <span class="nf">slice_change_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_slice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when the current image slice is changed on the vtkWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">new_slice</span><span class="p">)</span></div>
        <span class="c1"># print new_slice</span>

<div class="viewcode-block" id="QMeasurerWidget.window_level_change_handle"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QMeasurerWidget.window_level_change_handle">[docs]</a>    <span class="k">def</span> <span class="nf">window_level_change_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when window or level are changed by interacting in the vtkWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_window_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_level_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></div>

<div class="viewcode-block" id="QMeasurerWidget.distance_changed_handle"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QMeasurerWidget.distance_changed_handle">[docs]</a>    <span class="k">def</span> <span class="nf">distance_changed_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal the measured distance is changed in the vtkWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="QOrthogonalPlanesWidget"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QOrthogonalPlanesWidget">[docs]</a><span class="k">class</span> <span class="nc">QOrthogonalPlanesWidget</span><span class="p">(</span><span class="n">QFrame</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Qt Widget that wraps :class:`OrthogonalPlanesViewer` and lets it connect naturally to Qt Applications</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">slice_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">image_window_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">image_level_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the orthogonal planes widget</span>

<span class="sd">        Args:</span>
<span class="sd">            reader (braviz.visualization.base_reader.BaseReader) : Braviz reader</span>
<span class="sd">            parent (QObject) : Parent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QFrame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span> <span class="o">=</span> <span class="n">QVTKRenderWindowInteractor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">filt</span> <span class="o">=</span> <span class="n">FilterArrows</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_C</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_O</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_S</span><span class="p">))</span>
        <span class="n">filt</span><span class="o">.</span><span class="n">key_pressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="o">.</span><span class="n">installEventFilter</span><span class="p">(</span><span class="n">filt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__vtk_viewer</span> <span class="o">=</span> <span class="n">OrthogonalPlanesViewer</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="p">)</span>

        <span class="c1"># self.subject_viewer.ren_win.Render()</span>

        <span class="c1"># self.__qwindow_interactor.show()</span>

<div class="viewcode-block" id="QOrthogonalPlanesWidget.initialize_widget"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QOrthogonalPlanesWidget.initialize_widget">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this function **after** calling show on the widget or a parent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="o">.</span><span class="n">Start</span><span class="p">()</span></div>
        <span class="c1"># self.__subject_viewer.show_cone()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">orthogonal_viewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the underlying class:`OrthogonalPlanesViewer`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vtk_viewer</span>

<div class="viewcode-block" id="QOrthogonalPlanesWidget.slice_change_handle"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QOrthogonalPlanesWidget.slice_change_handle">[docs]</a>    <span class="k">def</span> <span class="nf">slice_change_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_slice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when the current image slice is changed on the vtkWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">new_slice</span><span class="p">)</span></div>
        <span class="c1"># print new_slice</span>

<div class="viewcode-block" id="QOrthogonalPlanesWidget.window_level_change_handle"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QOrthogonalPlanesWidget.window_level_change_handle">[docs]</a>    <span class="k">def</span> <span class="nf">window_level_change_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when window or level are changed by interacting in the vtkWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_window_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_level_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="fMRI_viewer"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer">[docs]</a><span class="k">class</span> <span class="nc">fMRI_viewer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A viewer for visualizaing fMRI data. It displays</span>

<span class="sd">        - Images</span>
<span class="sd">        - fMRI contours</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">render_window_interactor</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the fMRI viewer</span>

<span class="sd">        Args:</span>
<span class="sd">            render_window_interactor (vtkRenderWindowInteractor) : The intaractor that will be used with this viewer</span>
<span class="sd">            reader (braviz.visualization.base_reader.BaseReader) : Braviz reader</span>
<span class="sd">            widget (QObject) : Must implement *slice_change_handle*, *window_level_change_handle*</span>
<span class="sd">                and *cursor_move_handler*</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span> <span class="o">=</span> <span class="n">render_window_interactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span> <span class="o">=</span> <span class="n">render_window_interactor</span><span class="o">.</span><span class="n">GetRenderWindow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkRenderer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">((</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GradientBackgroundOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground2</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">((</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetUseDepthPeeling</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">SetMultiSamples</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">AlphaBitPlanesOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">SetOcclusionRatio</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">AddRenderer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="o">.</span><span class="n">SetInteractorStyle</span><span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkInteractorStyleTrackballCamera</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">OrientationAxes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">light</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkLight</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">AddLight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light</span><span class="o">.</span><span class="n">SetLightTypeToHeadlight</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>

        <span class="c1"># state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_space</span> <span class="o">=</span> <span class="s2">&quot;func&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_paradigm</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">picker</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCellPicker</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="o">.</span><span class="n">SetTolerance</span><span class="p">(</span><span class="mf">0.0005</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="o">.</span><span class="n">SetPicker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>

        <span class="c1"># internal data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_manager</span> <span class="o">=</span> <span class="n">ImageManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">widget</span><span class="p">,</span> <span class="n">interactor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iren</span><span class="p">,</span>
                                            <span class="n">picker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">picker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span> <span class="o">=</span> <span class="n">AdditionalCursors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contours</span> <span class="o">=</span> <span class="n">FmriContours</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="p">)</span>
        <span class="n">fmri_lut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fMRI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contours</span><span class="o">.</span><span class="n">set_lut</span><span class="p">(</span><span class="n">fmri_lut</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__image_loaded</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># reset camera and render</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_camera</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c1"># widget, signal handling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__widget</span> <span class="o">=</span> <span class="n">widget</span>

<div class="viewcode-block" id="fMRI_viewer.change_orientation"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.change_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">change_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orientation_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the orientation of the Image Plane Widget</span>

<span class="sd">        Args:</span>
<span class="sd">            orientation_index (int) : 0 for x, 1 for y and 2 for z</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># find cursor position</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">get_coords</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">change_image_orientation</span><span class="p">(</span><span class="n">orientation_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">new_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_number_of_image_slices</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_slice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">orientation_index</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">set_axis_coords</span><span class="p">(</span><span class="n">orientation_index</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">set_image_slice</span><span class="p">(</span><span class="n">new_slice</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_connect_cursors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">draw_cursor2</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__active_cursor_plane</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetPlaneOrientation</span><span class="p">()</span>
            <span class="n">pw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_plane_widget</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">pw</span><span class="o">.</span><span class="n">GetCurrentCursorPosition</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">coords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">set_axis_coords</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widget</span><span class="o">.</span><span class="n">cursor_move_handler</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">slice_movement</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__active_cursor_plane</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">last_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">get_coords</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">last_pos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">last_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">last_pos</span><span class="p">)</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetPlaneOrientation</span><span class="p">()</span>
            <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get_current_image_slice</span><span class="p">()</span>
            <span class="n">last_pos</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">sl</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">set_axis_coords</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">last_pos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widget</span><span class="o">.</span><span class="n">cursor_move_handler</span><span class="p">(</span><span class="n">last_pos</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">cursor_change_event</span><span class="p">,</span> <span class="n">draw_cursor2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">AddObserver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">slice_change_event</span><span class="p">,</span> <span class="n">slice_movement</span><span class="p">)</span>

<div class="viewcode-block" id="fMRI_viewer.current_coords"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.current_coords">[docs]</a>    <span class="k">def</span> <span class="nf">current_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get cursor coordinates</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple of coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">get_coords</span><span class="p">()</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="fMRI_viewer.set_cursor_coords"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.set_cursor_coords">[docs]</a>    <span class="k">def</span> <span class="nf">set_cursor_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set coordinates for the cursor</span>

<span class="sd">        Args:</span>
<span class="sd">            Coords (tuple) : New position for the cursor (in voxels)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetPlaneOrientation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">set_axis_coords</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="n">img_slice</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">set_image_slice</span><span class="p">(</span><span class="n">img_slice</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to ImageManager</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">contours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to FmriContours</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__contours</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="fMRI_viewer.change_subject"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.change_subject">[docs]</a>    <span class="k">def</span> <span class="nf">change_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_subj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change subject associated to the plane</span>

<span class="sd">        Args:</span>
<span class="sd">            new_subj : Id of new subject</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">!=</span> <span class="n">new_subj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">new_subj</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_view</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="fMRI_viewer.change_paradigm"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.change_paradigm">[docs]</a>    <span class="k">def</span> <span class="nf">change_paradigm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_pdgm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change fMRI paradigm</span>

<span class="sd">        Args:</span>
<span class="sd">            new_pdgm (str) : Must be one of the available fMRI paradigms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_paradigm</span> <span class="o">!=</span> <span class="n">new_pdgm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_paradigm</span> <span class="o">=</span> <span class="n">new_pdgm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_view</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="fMRI_viewer.change_contrast"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.change_contrast">[docs]</a>    <span class="k">def</span> <span class="nf">change_contrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_contrast</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change contrast</span>

<span class="sd">        Args:</span>
<span class="sd">            new_contrast (int) : Index of new contrast (starting at 1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span> <span class="o">!=</span> <span class="n">new_contrast</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span> <span class="o">=</span> <span class="n">new_contrast</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_view</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="fMRI_viewer.set_all"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.set_all">[docs]</a>    <span class="k">def</span> <span class="nf">set_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_subject</span><span class="p">,</span> <span class="n">new_pdgm</span><span class="p">,</span> <span class="n">new_contrast</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set subject, paradigm and contrast</span>

<span class="sd">        Args:</span>
<span class="sd">            new_subject : Id of new subject</span>
<span class="sd">            new_pdgm (str) : New paradigm, must be one of the available fMRI paradigms</span>
<span class="sd">            new_contrast (int) : Index of new contrast (starting at 1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">!=</span> <span class="n">new_subject</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">new_subject</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_paradigm</span> <span class="o">!=</span> <span class="n">new_pdgm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_paradigm</span> <span class="o">=</span> <span class="n">new_pdgm</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span> <span class="o">!=</span> <span class="n">new_contrast</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span> <span class="o">=</span> <span class="n">new_contrast</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_view</span><span class="p">(</span><span class="n">skip_render</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="fMRI_viewer.set_contour_value"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.set_contour_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_contour_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set value for the fMRI contours</span>

<span class="sd">        Args:</span>
<span class="sd">            value (float) : The iso-contours will be calculated at this value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contours</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="fMRI_viewer.set_contour_opacity"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.set_contour_opacity">[docs]</a>    <span class="k">def</span> <span class="nf">set_contour_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opacity for displaying the contours</span>

<span class="sd">        Args:</span>
<span class="sd">            value (int) : A number from 0 to 100; where 0 is invisible and 100 is opaque</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opac</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contours</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">()</span><span class="o">.</span><span class="n">SetOpacity</span><span class="p">(</span><span class="n">opac</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="fMRI_viewer.set_contour_visibility"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.set_contour_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">set_contour_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set visibility of contours</span>

<span class="sd">        Args:</span>
<span class="sd">            value (bool) : If ``True`` show the contours, otherwise hide them</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contours</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="fMRI_viewer.update_view"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.update_view">[docs]</a>    <span class="k">def</span> <span class="nf">update_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets all elements in the view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_paradigm</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">change_subject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">change_space</span><span class="p">(</span><span class="s2">&quot;func-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_paradigm</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">change_image_modality</span><span class="p">(</span>
            <span class="s2">&quot;fMRI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_paradigm</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__current_contrast</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connect_cursors</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_loaded</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cursor</span><span class="o">.</span><span class="n">set_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetInput</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">GetEnabled</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__contours</span><span class="o">.</span><span class="n">set_image</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_plane_widget</span><span class="o">.</span><span class="n">alternative_img</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__contours</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__contours</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">SetVisibility</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

    <span class="n">__camera_positions_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mi">157</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">130</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="mi">4</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="mi">3</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="mi">5</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
        <span class="mi">6</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">252</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="p">}</span>

    <span class="nd">@do_and_render</span>
<div class="viewcode-block" id="fMRI_viewer.reset_camera"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.reset_camera">[docs]</a>    <span class="k">def</span> <span class="nf">reset_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        resets the current camera to standard locations.</span>

<span class="sd">        Args:</span>
<span class="sd">            position (int) :</span>

<span class="sd">                - 0: initial 3d view</span>
<span class="sd">                - 1: left</span>
<span class="sd">                - 2: right</span>
<span class="sd">                - 3: front</span>
<span class="sd">                - 4: back</span>
<span class="sd">                - 5: top</span>
<span class="sd">                - 6: bottom</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">focal</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">viewup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__camera_positions_dict</span><span class="p">[</span><span class="n">position</span><span class="p">]</span>

        <span class="n">cam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">focal</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetViewUp</span><span class="p">(</span><span class="n">viewup</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">ResetCameraClippingRange</span><span class="p">()</span></div>

<div class="viewcode-block" id="fMRI_viewer.get_camera_parameters"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.get_camera_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_camera_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets current camera parameters</span>

<span class="sd">        Returs:</span>
<span class="sd">            focal_point, position, view_up</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetFocalPoint</span><span class="p">()</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span>
        <span class="n">vu</span> <span class="o">=</span> <span class="n">cam1</span><span class="o">.</span><span class="n">GetViewUp</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fp</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">vu</span></div>

<div class="viewcode-block" id="fMRI_viewer.set_camera"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.fMRI_viewer.set_camera">[docs]</a>    <span class="k">def</span> <span class="nf">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focal_point</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">view_up</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the camera position</span>

<span class="sd">        Args:</span>
<span class="sd">            focal_point (tuple) : Focal point</span>
<span class="sd">            position (tuple) : Camera position</span>
<span class="sd">            view_up (tuple) : View up vector</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cam1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetFocalPoint</span><span class="p">(</span><span class="n">focal_point</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">cam1</span><span class="o">.</span><span class="n">SetViewUp</span><span class="p">(</span><span class="n">view_up</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ren</span><span class="o">.</span><span class="n">ResetCameraClippingRange</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ren_win</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="FmriContours"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.FmriContours">[docs]</a><span class="k">class</span> <span class="nc">FmriContours</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display contours calculated over an fMRI statistic map.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ren</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the contours manager</span>

<span class="sd">        Args:</span>
<span class="sd">            ren (vtkRenderer) : Renderer that will draw the contours</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contour_filter</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkContourFilter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contour_filter</span><span class="o">.</span><span class="n">UseScalarTreeOn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contour_filter</span><span class="o">.</span><span class="n">ComputeNormalsOff</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__mapper</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyDataMapper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mapper</span><span class="o">.</span><span class="n">SetInputConnection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__contour_filter</span><span class="o">.</span><span class="n">GetOutputPort</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="o">.</span><span class="n">SetMapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mapper</span><span class="p">)</span>
        <span class="n">ren</span><span class="o">.</span><span class="n">AddActor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__actor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contour_filter</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contour_filter</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__img</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lut</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="FmriContours.set_value"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.FmriContours.set_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value at which contours are generated</span>

<span class="sd">        Args:</span>
<span class="sd">            value (float) : Statistical value for creating contours</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contour_filter</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contour_filter</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="FmriContours.set_image"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.FmriContours.set_image">[docs]</a>    <span class="k">def</span> <span class="nf">set_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the statistical map</span>

<span class="sd">        Args:</span>
<span class="sd">            img (vtkImageData) : Data used for contours generation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__img</span> <span class="o">=</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contour_filter</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__contour_filter</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span></div>

<div class="viewcode-block" id="FmriContours.set_lut"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.FmriContours.set_lut">[docs]</a>    <span class="k">def</span> <span class="nf">set_lut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lut</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a lookup table for showing the contours</span>

<span class="sd">        Notice the contour will always have the same vale, and therefore the same color.</span>
<span class="sd">        However the lut will reflect the changes in the contour value.</span>

<span class="sd">        Args:</span>
<span class="sd">            lut (vtkScalarsToColors) : Table to generate contour color based on its value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mapper</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="n">lut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mapper</span><span class="o">.</span><span class="n">UseLookupTableScalarRangeOn</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">actor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the contours actor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__actor</span></div>


<div class="viewcode-block" id="QFmriWidget"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QFmriWidget">[docs]</a><span class="k">class</span> <span class="nc">QFmriWidget</span><span class="p">(</span><span class="n">QFrame</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Qt Widget that wraps :class:`fMRI_viewer` and lets it connect naturally to Qt Applications</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">slice_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">image_window_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">image_level_changed</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">cursor_moved</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the fMRI viewer widget</span>

<span class="sd">        Args:</span>
<span class="sd">            reader (braviz.visualization.base_reader.BaseReader) : Braviz reader</span>
<span class="sd">            parent (QObject) : Parent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QFrame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span> <span class="o">=</span> <span class="n">QVTKRenderWindowInteractor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__vtk_viewer</span> <span class="o">=</span> <span class="n">fMRI_viewer</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__layout</span><span class="p">)</span>

        <span class="c1"># self.subject_viewer.ren_win.Render()</span>

        <span class="c1"># self.__qwindow_interactor.show()</span>

<div class="viewcode-block" id="QFmriWidget.initialize_widget"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QFmriWidget.initialize_widget">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this function **after** calling show on the widget or a parent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qwindow_interactor</span><span class="o">.</span><span class="n">Start</span><span class="p">()</span></div>
        <span class="c1"># self.__subject_viewer.show_cone()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">viewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to the internal fMRI_viewer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vtk_viewer</span>

<div class="viewcode-block" id="QFmriWidget.slice_change_handle"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QFmriWidget.slice_change_handle">[docs]</a>    <span class="k">def</span> <span class="nf">slice_change_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_slice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when the current image slice is changed on the vtkWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">new_slice</span><span class="p">)</span></div>
        <span class="c1"># print new_slice</span>

<div class="viewcode-block" id="QFmriWidget.window_level_change_handle"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QFmriWidget.window_level_change_handle">[docs]</a>    <span class="k">def</span> <span class="nf">window_level_change_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when window or level are changed by interacting in the vtkWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_window_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_level_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></div>

<div class="viewcode-block" id="QFmriWidget.cursor_move_handler"><a class="viewcode-back" href="../../../library/subject_viewer.html#braviz.visualization.subject_viewer.QFmriWidget.cursor_move_handler">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_move_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when the cursor is moved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_moved</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coordinates</span><span class="p">))</span></div></div>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">as</span> <span class="nn">QtGui</span>
    <span class="kn">import</span> <span class="nn">braviz</span>

    <span class="n">reader</span> <span class="o">=</span> <span class="n">braviz</span><span class="o">.</span><span class="n">readAndFilter</span><span class="o">.</span><span class="n">BravizAutoReader</span><span class="p">()</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">main_window</span> <span class="o">=</span> <span class="n">QSubjectViewerWidget</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">main_window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">main_window</span><span class="o">.</span><span class="n">initialize_widget</span><span class="p">()</span>

    <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;es todo&quot;</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
        </div>

        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          
                

                

                

          
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Diego Angulo.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>







        
  </body>
</html>