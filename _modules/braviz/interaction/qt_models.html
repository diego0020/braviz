<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>braviz.interaction.qt_models &mdash; Braviz Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.3b',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/fold_classes.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
    <link rel="top" title="Braviz Documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../../../index.html">
            <img class="logo" src="../../../_static/Logo_Bravis_h.png" alt="Logo"/>
          </a></p>
          <!--
        <div class="headertitle"><a
          href="../../../index.html"> Documentation </a></div>
          -->
          <nav class="parents">
              <ol>
        <li><a href="../../../index.html"> Home </a> &raquo;</li>
          <li><a href="../../index.html"  accesskey="U"  >Module code</a> &raquo;</li>
                  </ol>
          </nav>
       </div>
    </div>


    <div class="content-wrapper">
      <div class="content">
        <div class="sidebar" id="agogo-sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/Logo_Bravis_h.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        </div>
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for braviz.interaction.qt_models</h1><div class="highlight"><pre>
<span class="c">##############################################################################</span>
<span class="c">#    Braviz, Brain Data interactive visualization                            #</span>
<span class="c">#    Copyright (C) 2014  Diego Angulo                                        #</span>
<span class="c">#                                                                            #</span>
<span class="c">#    This program is free software: you can redistribute it and/or modify    #</span>
<span class="c">#    it under the terms of the GNU Lesser General Public License as          #</span>
<span class="c">#    published by  the Free Software Foundation, either version 3 of the     #</span>
<span class="c">#    License, or (at your option) any later version.                         #</span>
<span class="c">#                                                                            #</span>
<span class="c">#    This program is distributed in the hope that it will be useful,         #</span>
<span class="c">#    but WITHOUT ANY WARRANTY; without even the implied warranty of          #</span>
<span class="c">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           #</span>
<span class="c">#    GNU Lesser General Public License for more details.                     #</span>
<span class="c">#                                                                            #</span>
<span class="c">#    You should have received a copy of the GNU Lesser General Public License#</span>
<span class="c">#    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.   #</span>
<span class="c">##############################################################################</span>


<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;Diego&#39;</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">QAbstractListModel</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">QAbstractTableModel</span><span class="p">,</span> <span class="n">QAbstractItemModel</span>

<span class="kn">import</span> <span class="nn">braviz.readAndFilter.tabular_data</span> <span class="kn">as</span> <span class="nn">braviz_tab_data</span>
<span class="kn">import</span> <span class="nn">braviz.readAndFilter.user_data</span> <span class="kn">as</span> <span class="nn">braviz_user_data</span>
<span class="kn">from</span> <span class="nn">braviz.readAndFilter</span> <span class="kn">import</span> <span class="n">config_file</span>
<span class="kn">from</span> <span class="nn">braviz.readAndFilter</span> <span class="kn">import</span> <span class="n">bundles_db</span>

<span class="kn">from</span> <span class="nn">braviz.interaction.qt_structures_model</span> <span class="kn">import</span> <span class="n">StructureTreeModel</span>


<div class="viewcode-block" id="VarListModel"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.VarListModel">[docs]</a><span class="k">class</span> <span class="nc">VarListModel</span><span class="p">(</span><span class="n">QAbstractListModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List of available variables, optionally with checkboxes</span>

<span class="sd">    The list can be filtered to include only variables whose name include a certain pattern</span>

<span class="sd">    Args:</span>
<span class="sd">        parent (QObject) : Qt parent</span>
<span class="sd">        checkeable (bool) : If ``True`` the list will be displayed with checkboxes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CheckedChanged</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">checkeable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">QAbstractListModel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="s">&quot;Variable&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkeable</span> <span class="o">=</span> <span class="n">checkeable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checked_set</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlighted_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">checkeable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checked_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<div class="viewcode-block" id="VarListModel.update_list"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.VarListModel.update_list">[docs]</a>    <span class="k">def</span> <span class="nf">update_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the variable list to show variables whose name match a mask</span>

<span class="sd">        Args:</span>
<span class="sd">            mask (str) : Mask in sql format, the database is configured to be case insensitive. To</span>
<span class="sd">                search for variables that include the word ``&quot;age&quot;`` use ``&quot;%age%&quot;``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">panda_data</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_variables</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">panda_data</span><span class="p">[</span><span class="s">&quot;var_name&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkeable</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">checked_set</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
            <span class="k">elif</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_var_description_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">desc</span>
            <span class="k">elif</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">FontRole</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">font</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlighted_name</span><span class="p">:</span>
                    <span class="n">font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">Bold</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">font</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span> <span class="ow">and</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_SortOrder_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">Qt_SortOrder_order</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">)):</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkeable</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">flag</span> <span class="o">|=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span>
            <span class="k">return</span> <span class="n">flag</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>

    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">QVariant</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checked_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checked_set</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_data</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CheckedChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checked_set</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="VarListModel.select_items_by_name"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.VarListModel.select_items_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">select_items_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add variables to the set of checked items</span>

<span class="sd">        This will cause checks to appear in the respective boxes when the view is updated</span>

<span class="sd">        Args:</span>
<span class="sd">            items_list (list) : List of variable to check</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checked_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VarListModel.select_items"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.VarListModel.select_items">[docs]</a>    <span class="k">def</span> <span class="nf">select_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add checks to variables by id</span>

<span class="sd">        This will cause checks to appear in the respective boxes when the view is updated</span>

<span class="sd">        Args:</span>
<span class="sd">            items_list (list) : List of variable ids to check</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items_list</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_var_name</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checked_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VarListModel.set_highlighted"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.VarListModel.set_highlighted">[docs]</a>    <span class="k">def</span> <span class="nf">set_highlighted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">highlighted_name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The highlighted item will appear in bold</span>

<span class="sd">        Args:</span>
<span class="sd">            highlighted_name (str) : Name of a variable to show in bold, use None</span>
<span class="sd">                to don&#39;t highlight any variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlighted_name</span> <span class="o">=</span> <span class="n">highlighted_name</span>
</div>
<div class="viewcode-block" id="VarListModel.clear_selection"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.VarListModel.clear_selection">[docs]</a>    <span class="k">def</span> <span class="nf">clear_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes checks from all variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checked_set</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckedChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checked_set</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="VarAndGiniModel"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.VarAndGiniModel">[docs]</a><span class="k">class</span> <span class="nc">VarAndGiniModel</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table of variables which can include the gini index.</span>

<span class="sd">    The</span>
<span class="sd">    `gini index &lt;http://en.wikipedia.org/wiki/Decision_tree_learning#Gini_impurity&gt;`_</span>
<span class="sd">    is associated to each variable when predicting an outcome variable</span>

<span class="sd">    Args:</span>
<span class="sd">        outcome_var (str) : Name of variable to treat as outcome</span>
<span class="sd">        parent (QObject) : Qt parent for this object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome_var</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">QAbstractTableModel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span>
        <span class="c"># self.data_frame[&quot;var_idx&quot;]=self.data_frame.index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;Ginni&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;?&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ginni_calculated</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="o">=</span> <span class="n">outcome_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filtered_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filtered_index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filtered_index</span><span class="p">]</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">line</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">df2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_var_description</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">line</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Variable&quot;</span>
            <span class="k">elif</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Importance&quot;</span>
        <span class="k">elif</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Variable name&quot;</span>
            <span class="k">elif</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;This measure is calculated as how effective each variable is at predicting the outcome&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_SortOrder_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">Qt_SortOrder_order</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;var_name&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ginni_calculated</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculate_gini_indexes</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ginni_calculated</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;Ginni&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">index2</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtered_index</span><span class="p">]</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index2</span><span class="p">]</span>
            <span class="n">df2</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;Ginni&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filtered_index</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

<div class="viewcode-block" id="VarAndGiniModel.calculate_gini_indexes"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.VarAndGiniModel.calculate_gini_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_gini_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the gini indices of the variables via a random forest</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">braviz.interaction.r_functions</span> <span class="kn">import</span> <span class="n">calculate_ginni_index</span>
        <span class="c"># get outcome var:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcome</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;An outcome var is required for this&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">calculate_ginni_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VarAndGiniModel.update_list"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.VarAndGiniModel.update_list">[docs]</a>    <span class="k">def</span> <span class="nf">update_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the list to include only variables whose names match a mask</span>

<span class="sd">        Args:</span>
<span class="sd">            mask (str) : mask in sql syntax</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_variables</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filtered_index</span> <span class="o">=</span> <span class="n">pdf</span><span class="o">.</span><span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="AnovaRegressorsModel"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaRegressorsModel">[docs]</a><span class="k">class</span> <span class="nc">AnovaRegressorsModel</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Holds the regressors and interaction terms for a linear model</span>

<span class="sd">    The model exposes two columns, regressor name and degrees of freedom. Internally it keeps track if each</span>
<span class="sd">    regressor is a single term or an interaction of multiple variables</span>

<span class="sd">    It is possible to show only interactions, or only single term regressors</span>

<span class="sd">    Args:</span>
<span class="sd">        regressors_list (list) : List of variable names to be used as regressors</span>
<span class="sd">        parent (QObject) : Qt parent</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regressors_list</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(),</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">QAbstractTableModel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">regressors_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">initial_data</span> <span class="o">=</span> <span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_degrees_of_freedom</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">regressors_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initial_data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">initial_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">,</span> <span class="s">&quot;DF&quot;</span><span class="p">,</span> <span class="s">&quot;Interaction&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__show_interactions</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__show_regressors</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__interactors_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__next_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">regressors_list</span><span class="p">)</span>

<div class="viewcode-block" id="AnovaRegressorsModel.reset_data"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaRegressorsModel.reset_data">[docs]</a>    <span class="k">def</span> <span class="nf">reset_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regressors_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a new list of regressors</span>

<span class="sd">        Args:</span>
<span class="sd">            regressors_list (list) : List of variable names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">regressors_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">initial_data</span> <span class="o">=</span> <span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_degrees_of_freedom</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">regressors_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initial_data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">initial_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">,</span> <span class="s">&quot;DF&quot;</span><span class="p">,</span> <span class="s">&quot;Interaction&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__show_interactions</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__show_regressors</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__interactors_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__next_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">regressors_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_update_display_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the display</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__show_interactions</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__show_regressors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__show_interactions</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;Interaction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;Interaction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="AnovaRegressorsModel.show_interactions"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaRegressorsModel.show_interactions">[docs]</a>    <span class="k">def</span> <span class="nf">show_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set if interaction terms should be shown</span>

<span class="sd">        Args:</span>
<span class="sd">            value (bool) : if ``False`` interaction terms will be hidden</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__show_interactions</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_display_view</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AnovaRegressorsModel.show_regressors"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaRegressorsModel.show_regressors">[docs]</a>    <span class="k">def</span> <span class="nf">show_regressors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set if single variable terms should be shown</span>

<span class="sd">        Args:</span>
<span class="sd">            value (bool) : if ``False`` single variable terms will be hidden</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__show_regressors</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_display_view</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_view</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Variable&quot;</span>
            <span class="k">elif</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;DF&quot;</span>
        <span class="k">elif</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span> <span class="ow">and</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;Degrees of freedom&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>

        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">line</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_view</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_view</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_var_description_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_view</span><span class="p">[</span><span class="s">&quot;DF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_SortOrder_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># We will be using type2 or type3 Sums of Squares, and therefore order</span>
        <span class="c"># is not important</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">Qt_SortOrder_order</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;variable&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;DF&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_display_view</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

<div class="viewcode-block" id="AnovaRegressorsModel.add_regressor"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaRegressorsModel.add_regressor">[docs]</a>    <span class="k">def</span> <span class="nf">add_regressor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a regressor to the list</span>

<span class="sd">        Args:</span>
<span class="sd">            var_name (str) : Name of a variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="c"># ignore duplicates</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">beginInsertRows</span><span class="p">(</span>
            <span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">var_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_degrees_of_freedom</span><span class="p">(</span><span class="n">var_name</span><span class="p">),</span> <span class="mi">0</span><span class="p">)],</span>
                                                              <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                                                                  <span class="s">&quot;variable&quot;</span><span class="p">,</span> <span class="s">&quot;DF&quot;</span><span class="p">,</span> <span class="s">&quot;Interaction&quot;</span><span class="p">],</span>
                                                              <span class="n">index</span><span class="o">=</span><span class="p">(</span>
                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">__next_index</span><span class="p">,)</span>
                                                              <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__next_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endInsertRows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_display_view</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">removeRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># self.layoutAboutToBeChanged.emit()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginRemoveRows</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">(),</span> <span class="n">row</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="c"># print r</span>
            <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__interactors_dict</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__interactors_dict</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">,</span> <span class="s">&quot;DF&quot;</span><span class="p">,</span> <span class="s">&quot;Interaction&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_invalid_interactions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_display_view</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endRemoveRows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_degrees_of_freedom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">):</span>
        <span class="n">is_real</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">is_variable_name_real</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_real</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">is_real</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_labels_dict_by_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<div class="viewcode-block" id="AnovaRegressorsModel.get_regressors"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaRegressorsModel.get_regressors">[docs]</a>    <span class="k">def</span> <span class="nf">get_regressors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of single term regressors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">regs_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;Interaction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">regs_col</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AnovaRegressorsModel.get_interactions"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaRegressorsModel.get_interactions">[docs]</a>    <span class="k">def</span> <span class="nf">get_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of interaction terms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">regs_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">][</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;Interaction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">regs_col</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="AnovaRegressorsModel.add_interactor"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaRegressorsModel.add_interactor">[docs]</a>    <span class="k">def</span> <span class="nf">add_interactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor_rw_indexes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an interaction term to the model</span>

<span class="sd">        Args:</span>
<span class="sd">            factor_rw_indexes (list) : Positions of single term regressors that compose the interaction.</span>
<span class="sd">                This positions are the row number of the variable in this model, without counting</span>
<span class="sd">                interaction terms (or the row number when interaction terms are hidden)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">factors_data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;Interaction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">factor_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">factors_data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">factor_rw_indexes</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">factor_indexes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># can&#39;t add interaction with just one factor</span>
            <span class="k">return</span>

        <span class="c"># check if already added:</span>
        <span class="k">if</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">factor_indexes</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__interactors_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Trying to add duplicated interaction&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># get var_names</span>
        <span class="n">factor_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">factor_indexes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interactor_by_names</span><span class="p">(</span><span class="n">factor_names</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AnovaRegressorsModel.add_interactor_by_names"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaRegressorsModel.add_interactor_by_names">[docs]</a>    <span class="k">def</span> <span class="nf">add_interactor_by_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an interaction term by giving the name of its terms</span>

<span class="sd">        Args:</span>
<span class="sd">            factor_names (list) : List of variable names, already in the model, which make up the interaction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span>
        <span class="n">factor_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">fn</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                          <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">factor_names</span><span class="p">]</span>
        <span class="c"># create name</span>
        <span class="n">interactor_name</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">factor_names</span><span class="p">)</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">interactor_name</span><span class="p">)</span>
        <span class="c"># get degrees of freedom</span>
        <span class="n">interactor_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;DF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">factor_indexes</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">interactor_df</span><span class="p">)</span>
        <span class="c"># add to dictionary</span>
        <span class="n">interactor_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__next_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__next_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__interactors_dict</span><span class="p">[</span><span class="n">interactor_idx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">factor_indexes</span><span class="p">)</span>
        <span class="c"># add to data frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginInsertRows</span><span class="p">(</span>
            <span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">))</span>

        <span class="n">temp_data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">interactor_name</span><span class="p">,</span> <span class="n">interactor_df</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">,</span> <span class="s">&quot;DF&quot;</span><span class="p">,</span> <span class="s">&quot;Interaction&quot;</span><span class="p">],</span>
                                       <span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="n">interactor_idx</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_data_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endInsertRows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_display_view</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_remove_invalid_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__interactors_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                    <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__interactors_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__interactors_dict</span><span class="p">)</span>

<div class="viewcode-block" id="AnovaRegressorsModel.get_data_frame"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaRegressorsModel.get_data_frame">[docs]</a>    <span class="k">def</span> <span class="nf">get_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the internal data frame</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`pandas.DataFrame` with three columns: regressor name, degrees of freedom, and interaction.</span>
<span class="sd">            The last column has zeros for single variable regressors and 1 for interaction terms.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span>
</div>
<div class="viewcode-block" id="AnovaRegressorsModel.get_interactors_dict"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaRegressorsModel.get_interactors_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_interactors_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the interactions dictionary</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary that maps dataframe indices of interactions terms to the dataframe indices of</span>
<span class="sd">            its factors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__interactors_dict</span>

</div></div>
<div class="viewcode-block" id="NominalVariablesMeta"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.NominalVariablesMeta">[docs]</a><span class="k">class</span> <span class="nc">NominalVariablesMeta</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table with numerical labels in the first column and corresponding text labels in the second column</span>

<span class="sd">    These labels correspond to the possible values a nominal variable can take</span>
<span class="sd">    Textual labels can be edited</span>

<span class="sd">    Args:</span>
<span class="sd">        var_name (str) : Name of a nominal variable</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">QAbstractTableModel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;label&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_model</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkeable</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unchecked</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">line</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkeable</span> <span class="ow">and</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">):</span>
                    <span class="n">checked</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unchecked</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">if</span> <span class="n">checked</span> <span class="k">else</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
            <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span><span class="p">[</span><span class="n">line</span><span class="p">],</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Label&quot;</span>
            <span class="k">elif</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Name&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_SortOrder_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">Qt_SortOrder_order</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span><span class="p">[</span><span class="n">row</span><span class="p">]]</span> <span class="o">=</span> <span class="n">QVariant</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">QVariant</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unchecked</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unchecked</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;DataChanged(QModelIndex,QModelIndex)&quot;</span><span class="p">),</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCount</span><span class="p">():</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEditable</span>
            <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkeable</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">):</span>
                <span class="n">flags</span> <span class="o">|=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span>
        <span class="k">return</span> <span class="n">flags</span>

<div class="viewcode-block" id="NominalVariablesMeta.update_model"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.NominalVariablesMeta.update_model">[docs]</a>    <span class="k">def</span> <span class="nf">update_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the table with data from the database</span>

<span class="sd">        Args:</span>
<span class="sd">            var_name (str) : Read labels for this variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelAboutToBeReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># generic labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_labels_dict_by_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="NominalVariablesMeta.save_into_db"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.NominalVariablesMeta.save_into_db">[docs]</a>    <span class="k">def</span> <span class="nf">save_into_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_idx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the textual labels into the database</span>

<span class="sd">        Args:</span>
<span class="sd">            var_idx (int) : Index of the variable to which the labels will be saved, only required if *var_name*</span>
<span class="sd">                is not set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tuples</span> <span class="o">=</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">save_nominal_labels_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="n">tuples</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">var_idx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Var_idx is required&quot;</span><span class="p">)</span>
            <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">save_nominal_labels</span><span class="p">(</span><span class="n">var_idx</span><span class="p">,</span> <span class="n">tuples</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NominalVariablesMeta.add_label"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.NominalVariablesMeta.add_label">[docs]</a>    <span class="k">def</span> <span class="nf">add_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add another row with the next numerical label to the table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="NominalVariablesMeta.set_labels_dict"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.NominalVariablesMeta.set_labels_dict">[docs]</a>    <span class="k">def</span> <span class="nf">set_labels_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets textual labels</span>

<span class="sd">        Args:</span>
<span class="sd">            labels_dict (dict) : Dictionary that maps numerical labels to textual labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span> <span class="o">=</span> <span class="n">labels_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span> <span class="o">=</span> <span class="n">labels_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="NominalVariablesMeta.set_checkeable"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.NominalVariablesMeta.set_checkeable">[docs]</a>    <span class="k">def</span> <span class="nf">set_checkeable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkeable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose if check boxes should be displayed next to numerical labels</span>

<span class="sd">        Args:</span>
<span class="sd">            checkeable (bool) : If ``True`` checkboxes will appear</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkeable</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">checkeable</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NominalVariablesMeta.get_unchecked"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.NominalVariablesMeta.get_unchecked">[docs]</a>    <span class="k">def</span> <span class="nf">get_unchecked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a set of labels whose checkbox is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unchecked</span>
</div>
<div class="viewcode-block" id="NominalVariablesMeta.get_checked"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.NominalVariablesMeta.get_checked">[docs]</a>    <span class="k">def</span> <span class="nf">get_checked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a set of labels whose checkbox is checked</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_list</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">unchecked</span>

</div></div>
<div class="viewcode-block" id="AnovaResultsModel"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.AnovaResultsModel">[docs]</a><span class="k">class</span> <span class="nc">AnovaResultsModel</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A model to represent the results of an anova regression</span>

<span class="sd">    It has columns for factor names, sum of squares, degrees of freedom, F statistic, and p value.</span>
<span class="sd">    Internally it also holds residuals, fitted values and intercept.</span>

<span class="sd">    Args:</span>
<span class="sd">        results_df (pandas.DataFrame) : A Data Frame containing the columns indicated above</span>
<span class="sd">        residuals (list) : A vector of the regression residuals</span>
<span class="sd">        intercept (float) : Value of the intercept term of the regression</span>
<span class="sd">        fitted (list) : Vector of fitted values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_df</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">residuals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fitted</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">results_df</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="bp">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Factor&quot;</span><span class="p">,</span> <span class="s">&quot;Sum Sq&quot;</span><span class="p">,</span> <span class="s">&quot;Df&quot;</span><span class="p">,</span> <span class="s">&quot;F value&quot;</span><span class="p">,</span> <span class="s">&quot;Pr(&gt;F)&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="n">results_df</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span> <span class="o">=</span> <span class="n">residuals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intercept</span> <span class="o">=</span> <span class="n">intercept</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitted</span> <span class="o">=</span> <span class="n">fitted</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AnovaResultsModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># names</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># df</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">data</span>
        <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c"># p</span>
            <span class="k">return</span> <span class="s">&quot;{:.1e}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;{:.3g}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">p_int</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_SortOrder_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">Qt_SortOrder_order</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">p_int</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">line</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">line</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">():</span>
            <span class="n">result</span> <span class="o">|=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span>
            <span class="n">result</span> <span class="o">|=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span>
        <span class="k">return</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="DataFrameModel"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.DataFrameModel">[docs]</a><span class="k">class</span> <span class="nc">DataFrameModel</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This model is used for displaying data frames in a QT table view</span>

<span class="sd">    Args:</span>
<span class="sd">        data_frame (pandas.DataFrame) : Data Frame</span>
<span class="sd">        columns (list) : Optional, names for columns of the data frame</span>
<span class="sd">        string_columns (list) : List of column names that should be displayed as strings</span>
<span class="sd">        index_as_column (bool) : Display the data frame index as the first column</span>
<span class="sd">        checks (bool) : Display checkboxes next to the first column</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">string_columns</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(),</span> <span class="n">index_as_column</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">checks</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;A pandas data frame is required&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="n">data_frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cols</span> <span class="o">=</span> <span class="n">columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__string_cols</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">string_columns</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__checks</span> <span class="o">=</span> <span class="n">checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__checked</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__disabled</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_as_column</span> <span class="o">=</span> <span class="n">index_as_column</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DataFrameModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_as_column</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__cols</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__cols</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checks</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checked</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_as_column</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_data</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">line</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cols</span><span class="p">[</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_data</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cols</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_data</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checks</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">QVariant</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__checked</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__checked</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
            <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;DataChanged(QModelIndex,QModelIndex)&quot;</span><span class="p">),</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">get_item_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">format_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_i</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">col_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__string_cols</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%.4g</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">data</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_as_column</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cols</span><span class="p">[</span><span class="n">p_int</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cols</span><span class="p">[</span><span class="n">p_int</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">Qt_Orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">p_int</span><span class="p">])</span>

        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_SortOrder_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">Qt_SortOrder_order</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_as_column</span><span class="p">:</span>
            <span class="n">i_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
            <span class="n">i_l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">i_l</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_l</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">i_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_as_column</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">p_int</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">p_int</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">line</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">line</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">():</span>
            <span class="n">result</span> <span class="o">|=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__disabled</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">|=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checks</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">|=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">set_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_df</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">checked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__checked</span><span class="p">)</span>

    <span class="nd">@checked.setter</span>
    <span class="k">def</span> <span class="nf">checked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked_names</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelAboutToBeReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__checked</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">checked_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">disabled_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__disabled</span><span class="p">)</span>

    <span class="nd">@disabled_items.setter</span>
    <span class="k">def</span> <span class="nf">disabled_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disabled_set</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelAboutToBeReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__disabled</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">disabled_set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="SampleTree"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SampleTree">[docs]</a><span class="k">class</span> <span class="nc">SampleTree</span><span class="p">(</span><span class="n">QAbstractItemModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a tree for representing a sample</span>

<span class="sd">    Each first level child represents a nominal variable, and its sons are the different values for that variable</span>
<span class="sd">    finally, the leafs contain the subject ids. For each node the number of subjects it contains is represented in the</span>
<span class="sd">    second column</span>

<span class="sd">    Args:</span>
<span class="sd">        columns (list) : List of nominal variable names to include in the tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SampleTree</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_apps_config</span><span class="p">()</span>
            <span class="n">a_vars</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">get_default_variables</span><span class="p">()</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_vars</span><span class="p">[</span><span class="s">&quot;nom1&quot;</span><span class="p">],</span> <span class="n">a_vars</span><span class="p">[</span><span class="s">&quot;nom2&quot;</span><span class="p">],</span> <span class="n">a_vars</span><span class="p">[</span><span class="s">&quot;lat&quot;</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_aspects</span> <span class="o">=</span> <span class="n">columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&quot;Attribute&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&quot;N&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data_frame</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_data_frame_by_name</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_tuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
            <span class="s">&quot;item_tuple&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;nid&quot;</span><span class="p">,</span> <span class="s">&quot;row&quot;</span><span class="p">,</span> <span class="s">&quot;label&quot;</span><span class="p">,</span> <span class="s">&quot;count&quot;</span><span class="p">,</span> <span class="s">&quot;parent&quot;</span><span class="p">,</span> <span class="s">&quot;children&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tree_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__next_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_tree_dicts</span><span class="p">()</span>

<div class="viewcode-block" id="SampleTree.set_sample"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SampleTree.set_sample">[docs]</a>    <span class="k">def</span> <span class="nf">set_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_sample</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the subsample to show in the tree</span>

<span class="sd">        Args:</span>
<span class="sd">            new_sample (set) : Set of subjects in the new subsample</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data_frame</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_data_frame_by_name</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_aspects</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="n">new_sample</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tree_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__next_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_tree_dicts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">__get_next_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">iid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__next_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__next_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">iid</span>

    <span class="k">def</span> <span class="nf">_populate_tree_dicts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># All</span>
        <span class="n">iid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_next_id</span><span class="p">()</span>
        <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data_frame</span><span class="o">.</span><span class="n">index</span>
        <span class="n">parent_id</span> <span class="o">=</span> <span class="n">iid</span>
        <span class="n">children_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
            <span class="n">iid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_next_id</span><span class="p">()</span>
            <span class="n">c_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_tuple</span><span class="p">(</span>
                <span class="n">nid</span><span class="o">=</span><span class="n">iid</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">iid</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_item</span>
            <span class="n">children_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_item</span><span class="p">)</span>
        <span class="n">all_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_tuple</span><span class="p">(</span><span class="n">nid</span><span class="o">=</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;All&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data_frame</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                   <span class="n">children</span><span class="o">=</span><span class="n">children_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tree_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_item</span>

        <span class="c"># Other aspectes</span>
        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_aspects</span><span class="p">):</span>
            <span class="n">aspect_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_next_id</span><span class="p">()</span>
            <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_populate_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">,</span> <span class="n">aspect_id</span><span class="p">)</span>
            <span class="n">new_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_tuple</span><span class="p">(</span><span class="n">nid</span><span class="o">=</span><span class="n">aspect_id</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data_frame</span><span class="p">),</span>
                                       <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="n">children</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tree_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">aspect_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_item</span>

        <span class="c"># check index integrity</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__next_id</span><span class="p">):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_populate_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">aspect_id</span><span class="p">):</span>
        <span class="c"># get labels</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_labels_dict_by_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="n">labels_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">lab_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_next_id</span><span class="p">()</span>
            <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data_frame</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data_frame</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="n">children_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
                <span class="n">c_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_next_id</span><span class="p">()</span>
                <span class="n">c_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_tuple</span><span class="p">(</span>
                    <span class="n">nid</span><span class="o">=</span><span class="n">c_id</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">lab_id</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
                <span class="n">children_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_item</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">c_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_item</span>
            <span class="n">lab_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_tuple</span><span class="p">(</span><span class="n">nid</span><span class="o">=</span><span class="n">lab_id</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">children_list</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="n">aspect_id</span><span class="p">,</span>
                                       <span class="n">children</span><span class="o">=</span><span class="n">children_list</span><span class="p">)</span>
            <span class="n">labels_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lab_item</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">lab_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">lab_item</span>
        <span class="k">return</span> <span class="n">labels_list</span>

    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">()</span>
        <span class="n">item_id</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">internalId</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">item_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">createIndex</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">nid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QModelIndex_parent</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="c"># print &quot;top_row_count&quot;</span>
            <span class="c"># print len(self.data_aspects)+1</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_aspects</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">nid</span> <span class="o">=</span> <span class="n">QModelIndex_parent</span><span class="o">.</span><span class="n">internalId</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">children</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="n">nid</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">internalId</span><span class="p">()</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">nid</span><span class="p">]</span>
            <span class="c"># print item</span>
            <span class="c"># print sid</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">label</span>
            <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">count</span>

        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">p_int_1</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QModelIndex_parent</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="c"># top level</span>
            <span class="k">if</span> <span class="n">p_int</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_aspects</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">p_int</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">()</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tree_list</span><span class="p">[</span><span class="n">p_int</span><span class="p">]</span>
            <span class="n">nid</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">nid</span>
            <span class="n">out_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createIndex</span><span class="p">(</span><span class="n">p_int</span><span class="p">,</span> <span class="n">p_int_1</span><span class="p">,</span> <span class="n">nid</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">out_index</span><span class="o">.</span><span class="n">isValid</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">out_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">QModelIndex_parent</span><span class="o">.</span><span class="n">internalId</span><span class="p">()</span>
            <span class="n">parent_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span>
            <span class="n">childrens</span> <span class="o">=</span> <span class="n">parent_item</span><span class="o">.</span><span class="n">children</span>
            <span class="k">if</span> <span class="n">childrens</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nid</span> <span class="o">=</span> <span class="n">childrens</span><span class="p">[</span><span class="n">p_int</span><span class="p">]</span><span class="o">.</span><span class="n">nid</span>
                <span class="n">out_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createIndex</span><span class="p">(</span><span class="n">p_int</span><span class="p">,</span> <span class="n">p_int_1</span><span class="p">,</span> <span class="n">nid</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">out_index</span><span class="o">.</span><span class="n">isValid</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">out_index</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span> <span class="ow">and</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p_int</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p_int</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">hasChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QModelIndex_parent</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="c"># top level has children</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">parent_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">QModelIndex_parent</span><span class="o">.</span><span class="n">internalId</span><span class="p">()]</span>
        <span class="c"># print &quot;has children&quot;</span>
        <span class="c"># print parent_item</span>
        <span class="k">if</span> <span class="n">parent_item</span><span class="o">.</span><span class="n">children</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="SampleTree.get_leafs"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SampleTree.get_leafs">[docs]</a>    <span class="k">def</span> <span class="nf">get_leafs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get subjectids under a certain node</span>

<span class="sd">        Args:</span>
<span class="sd">            QModelIndex (QModelIndex) : Index of a node in the tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iid</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">internalId</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id_index</span><span class="p">[</span><span class="n">iid</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_leafs</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__get_leafs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">children</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">leafs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">leafs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__get_leafs</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">leafs</span>

</div>
<div class="viewcode-block" id="SubjectsTable"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectsTable">[docs]</a><span class="k">class</span> <span class="nc">SubjectsTable</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table of subjects and values for specified variables</span>

<span class="sd">    The first column contains subject codes. There are additional columns for each requested variable.</span>
<span class="sd">    Values for nominal variables are shown as textual labels</span>

<span class="sd">    Args:</span>
<span class="sd">        initial_columns (list) : List of initial variables indices to include as columns in the table</span>
<span class="sd">        sample (list) : List of subject ids to show in the table</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_columns</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">QAbstractTableModel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">initial_columns</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">initial_columns</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__is_var_real</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__labels</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__col_indexes</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__highlight_subject</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="k">if</span> <span class="n">sample</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_subjects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_var_columns</span><span class="p">(</span><span class="n">initial_columns</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">int_role</span> <span class="ow">in</span> <span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">p_int</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">p_int</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">FontRole</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__highlight_subject</span><span class="p">:</span>
                <span class="n">font</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">()</span>
                <span class="n">font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">font</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__highlight_subject</span><span class="p">:</span>
                <span class="n">brush</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">()</span>
                <span class="n">brush</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="s">&quot;palegreen&quot;</span><span class="p">))</span>
                <span class="n">brush</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">SolidPattern</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">brush</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">int_role</span> <span class="ow">in</span> <span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">line</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">datum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__is_var_real</span><span class="p">[</span><span class="n">col</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__labels</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">datum</span><span class="p">)]</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;?&quot;</span>
                    <span class="k">return</span> <span class="n">label</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_SortOrder_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">Qt_SortOrder_order</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">p_int</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

<div class="viewcode-block" id="SubjectsTable.set_var_columns"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectsTable.set_var_columns">[docs]</a>    <span class="k">def</span> <span class="nf">set_var_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the columns in the table</span>

<span class="sd">        Args:</span>
<span class="sd">            columns (list) : List of variable indices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__col_indexes</span> <span class="o">=</span> <span class="n">columns</span>
        <span class="n">vars_df</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_data_frame_by_index</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">codes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">vars_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_values</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">vars_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;Code&quot;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="n">codes_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vars_df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">]</span>
        <span class="n">is_var_code_real</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">are_variables_real</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
        <span class="c"># we want to use the column number as index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__is_var_real</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">is_var_code_real</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">is_real</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__is_var_real</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_real</span><span class="p">:</span>
                <span class="c"># column 0 is reserved for the Code</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_labels_dict</span><span class="p">(</span>
                    <span class="n">columns</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SubjectsTable.set_sample"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectsTable.set_sample">[docs]</a>    <span class="k">def</span> <span class="nf">set_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_sample</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the subsample of subjects in the table</span>

<span class="sd">        Args:</span>
<span class="sd">            new_sample (list) : List of subject ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">new_sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_var_columns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__col_indexes</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SubjectsTable.get_current_columns"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectsTable.get_current_columns">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of current variable names shown as columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</div>
<div class="viewcode-block" id="SubjectsTable.get_current_column_indexes"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectsTable.get_current_column_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_column_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of current variable indices shown as columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__col_indexes</span>
</div>
<div class="viewcode-block" id="SubjectsTable.get_subject_index"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectsTable.get_subject_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_subject_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subj_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get row number for a certain subject id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">subj_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">row</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highlighted_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__highlight_subject</span>

    <span class="nd">@highlighted_subject.setter</span>
    <span class="k">def</span> <span class="nf">highlighted_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__highlight_subject</span> <span class="o">=</span> <span class="n">subj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="ContextVariablesModel"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.ContextVariablesModel">[docs]</a><span class="k">class</span> <span class="nc">ContextVariablesModel</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table with three columns: Variable name, variable type, and a checkbox called &quot;editable&quot;</span>

<span class="sd">    This table is used to select a list of variables, and decide which of those should be made</span>
<span class="sd">    writable, and which readonly</span>

<span class="sd">    Args:</span>
<span class="sd">        context_vars_list (list) : List of variables ids to include at the start</span>
<span class="sd">        parent (QObject) : Qt parent</span>
<span class="sd">        editable_dict (dict) : Dictionary where keys are variable ids and values are booleans indicating</span>
<span class="sd">            if the variable should be writable by the user. This object will be modified.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context_vars_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">editable_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">QAbstractTableModel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_type_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">context_vars_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">context_vars_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_var_name</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_type</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
                 <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">context_vars_list</span><span class="p">],</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">,</span> <span class="s">&quot;Type&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">context_vars_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">,</span> <span class="s">&quot;Type&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">editables_dict</span> <span class="o">=</span> <span class="n">editable_dict</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editables_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editables_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">idx</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
                                       <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">context_vars_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&quot;Variable&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&quot;Type&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&quot;Editable&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p_int</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">var_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editables_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var_idx</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">var_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_var_description</span><span class="p">(</span><span class="n">var_idx</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">line</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_SortOrder_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># We will be using type2 or type3 Sums of Squares, and therefore order</span>
        <span class="c"># is not important</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">Qt_SortOrder_order</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;variable&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;Type&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the type of a variable as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var_idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">is_variable_nominal</span><span class="p">(</span><span class="n">var_idx</span><span class="p">):</span>
                <span class="n">data_type</span> <span class="o">=</span> <span class="s">&quot;Nominal&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_type</span> <span class="o">=</span> <span class="s">&quot;Real&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_type_dict</span><span class="p">[</span><span class="n">var_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_type</span>
        <span class="k">return</span> <span class="n">data_type</span>

<div class="viewcode-block" id="ContextVariablesModel.add_variable"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.ContextVariablesModel.add_variable">[docs]</a>    <span class="k">def</span> <span class="nf">add_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a variable to the table</span>

<span class="sd">        The removeRows method can be used to remove a variable</span>
<span class="sd">        Args:</span>
<span class="sd">            var_idx (int) : Variable index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">var_idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="c"># ignore duplicates</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">beginInsertRows</span><span class="p">(</span>
            <span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_var_name</span><span class="p">(</span><span class="n">var_idx</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_type</span><span class="p">(</span><span class="n">var_idx</span><span class="p">))],</span>
                         <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;variable&quot;</span><span class="p">,</span> <span class="s">&quot;Type&quot;</span><span class="p">],</span>
                         <span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="n">var_idx</span><span class="p">,)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endInsertRows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editables_dict</span><span class="p">[</span><span class="n">var_idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</div>
    <span class="k">def</span> <span class="nf">removeRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># self.layoutAboutToBeChanged.emit()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginRemoveRows</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">(),</span> <span class="n">row</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="n">var_idx</span> <span class="o">=</span> <span class="n">indexes</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">editables_dict</span><span class="p">[</span><span class="n">var_idx</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">var_idx</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endRemoveRows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editables_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">row</span><span class="p">]]</span> <span class="o">=</span> <span class="n">QVariant</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
            <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">)):</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span>
            <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">flag</span> <span class="o">|=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span>
            <span class="k">return</span> <span class="n">flag</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>

<div class="viewcode-block" id="ContextVariablesModel.get_variables"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.ContextVariablesModel.get_variables">[docs]</a>    <span class="k">def</span> <span class="nf">get_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a list of variable indices currently in the table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="SubjectDetails"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectDetails">[docs]</a><span class="k">class</span> <span class="nc">SubjectDetails</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table showing variable values for a single subject</span>

<span class="sd">    The first column contains variable names, and the second column its values, together with</span>
<span class="sd">    the range of values for the reference population</span>

<span class="sd">    The user may drag table rows to change the order</span>

<span class="sd">    Args:</span>
<span class="sd">        initial_vars (list) : List of variables codes to include in the table from the start</span>
<span class="sd">        initial_subject : Code of the initial subject</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_vars</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_subject</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">QAbstractTableModel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">initial_vars</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">initial_vars</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__is_var_real</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__normal_ranges</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">initial_subject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_variables</span><span class="p">(</span><span class="n">initial_vars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Variable&quot;</span><span class="p">,</span> <span class="s">&quot;Value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">int_role</span> <span class="ow">in</span> <span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">p_int</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">p_int</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">:</span>
            <span class="n">var_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_var_description</span><span class="p">(</span><span class="n">var_idx</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">desc</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">line</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">datum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
            <span class="n">var_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__is_var_real</span><span class="p">[</span><span class="n">var_idx</span><span class="p">]</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__normal_ranges</span><span class="p">[</span><span class="n">var_idx</span><span class="p">]</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="s">(</span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">datum</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">):</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;* &quot;</span> <span class="o">+</span> <span class="n">message</span>
                <span class="k">return</span> <span class="n">message</span>
            <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

<div class="viewcode-block" id="SubjectDetails.set_variables"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectDetails.set_variables">[docs]</a>    <span class="k">def</span> <span class="nf">set_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable_ids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the list of variables</span>

<span class="sd">        Args:</span>
<span class="sd">            variable_ids : list of new variable ids to show in the table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vars_df</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_subject_variables</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span><span class="p">,</span> <span class="n">variable_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="n">vars_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__is_var_real</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">are_variables_real</span><span class="p">(</span><span class="n">variable_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__normal_ranges</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_variable_normal_range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">)))</span>
                                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">variable_ids</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__is_var_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SubjectDetails.change_subject"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectDetails.change_subject">[docs]</a>    <span class="k">def</span> <span class="nf">change_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_subject</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the current subject to whih the variable values correspond</span>

<span class="sd">        Args:</span>
<span class="sd">            new_subject : New subject code</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_subject</span> <span class="o">=</span> <span class="n">new_subject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_variables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">supportedDropActions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MoveAction</span>

    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="p">)):</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span>
            <span class="n">flag</span> <span class="o">|=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span>
            <span class="k">return</span> <span class="n">flag</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDropEnabled</span>

    <span class="k">def</span> <span class="nf">dropMimeData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QMimeData</span><span class="p">,</span> <span class="n">Qt_DropAction</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">p_int_1</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">p_int</span>
        <span class="k">if</span> <span class="n">Qt_DropAction</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MoveAction</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="c"># only accept drops between lines</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">data_stream</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QDataStream</span><span class="p">(</span>
            <span class="n">QMimeData</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s">&quot;application/x-qabstractitemmodeldatalist&quot;</span><span class="p">))</span>
        <span class="n">source_row</span> <span class="o">=</span> <span class="n">data_stream</span><span class="o">.</span><span class="n">readInt</span><span class="p">()</span>
        <span class="c"># print &quot;Moving from %d to %d&quot;%(source_row,row)</span>
        <span class="n">index_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">source_id</span> <span class="o">=</span> <span class="n">index_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">source_row</span><span class="p">)</span>
        <span class="n">index_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">source_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index_list</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="SubjectDetails.get_current_variables"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectDetails.get_current_variables">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of current variable codes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">index</span>
</div>
    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_SortOrder_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ascending</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">Qt_SortOrder_order</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AscendingOrder</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__df</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="NewVariableValues"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.NewVariableValues">[docs]</a><span class="k">class</span> <span class="nc">NewVariableValues</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table with on column for subject, and a writable second column for variable values</span>

<span class="sd">    Values are restricted to numbers</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NewVariableValues</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subjects_list</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_subjects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subjects_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjects_list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subjects_list</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subjects_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">flags</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span>
                <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">flags</span> <span class="o">|=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEditable</span>
                <span class="k">return</span> <span class="n">flags</span>
        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>

    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">int_role</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">subjects_list</span><span class="p">[</span><span class="n">row</span><span class="p">]]</span> <span class="o">=</span> <span class="n">QVariant</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Qt_Orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Subject&quot;</span>
            <span class="k">elif</span> <span class="n">p_int</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Value&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>

<div class="viewcode-block" id="NewVariableValues.save_into_db"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.NewVariableValues.save_into_db">[docs]</a>    <span class="k">def</span> <span class="nf">save_into_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save values from the model into the braviz database</span>

<span class="sd">        Args:</span>
<span class="sd">            var_idx (int) : Index of the variable to which the values should be saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value_tuples</span> <span class="o">=</span> <span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;nan&quot;</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjects_list</span><span class="p">)</span>
        <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">update_variable_values</span><span class="p">(</span><span class="n">var_idx</span><span class="p">,</span> <span class="n">value_tuples</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NewVariableValues.set_values_dict"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.NewVariableValues.set_values_dict">[docs]</a>    <span class="k">def</span> <span class="nf">set_values_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set values for variables</span>

<span class="sd">        Args:</span>
<span class="sd">            values_dict (dict) :  A dictionary with subject codes as keys, and variable values as values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelAboutToBeReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values_dict</span> <span class="o">=</span> <span class="n">values_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="SimpleBundlesList"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleBundlesList">[docs]</a><span class="k">class</span> <span class="nc">SimpleBundlesList</span><span class="p">(</span><span class="n">QAbstractListModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A list of database fiber bundles</span>

<span class="sd">    An optional special bundle, called &quot;&lt;From Segment&gt;&quot; may also be shown</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SimpleBundlesList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_list</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__showing_special</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restart_structures</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_restart_structures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear the list state</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;&lt;From Segment&gt;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__showing_special</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>

<div class="viewcode-block" id="SimpleBundlesList.add_bundle"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleBundlesList.add_bundle">[docs]</a>    <span class="k">def</span> <span class="nf">add_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_id</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a bundle to the list</span>

<span class="sd">        Args:</span>
<span class="sd">            bundle_id (int) : Bundle database index</span>
<span class="sd">            name (str) : Bundle name to show</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">bundle_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bundle_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SimpleBundlesList.get_bundle_name"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleBundlesList.get_bundle_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_bundle_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name used to show a bundle with the given id</span>

<span class="sd">        Args:</span>
<span class="sd">            bid (int) : Bundle database id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">bid</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Invalid bundle id&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="SimpleBundlesList.set_show_special"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleBundlesList.set_show_special">[docs]</a>    <span class="k">def</span> <span class="nf">set_show_special</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_special</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show or hide the special &quot;&lt;From segment&gt;&quot; bundle</span>

<span class="sd">        Args:</span>
<span class="sd">            show_special (bool) : If ``True`` the special bundle will appear on the list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__showing_special</span> <span class="o">=</span> <span class="n">show_special</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SimpleBundlesList.get_ids"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleBundlesList.get_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get ids in the list, if the special bundle is present it is ignored</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="SimpleBundlesList.set_ids"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleBundlesList.set_ids">[docs]</a>    <span class="k">def</span> <span class="nf">set_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_list</span><span class="p">,</span> <span class="n">names_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set bundle ids to show in the list</span>

<span class="sd">        Args:</span>
<span class="sd">            id_list (list) : List of database indices of bundles</span>
<span class="sd">            names_dict (dict) : Optional, if present it is used to map ids to names; otherwise the names in the</span>
<span class="sd">                database are used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restart_structures</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">names_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">names_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bundles_db</span><span class="o">.</span><span class="n">get_bundle_ids_and_names</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_bundle</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">names_dict</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="BundlesSelectionList"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.BundlesSelectionList">[docs]</a><span class="k">class</span> <span class="nc">BundlesSelectionList</span><span class="p">(</span><span class="n">QAbstractListModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A list of bundles with checkboxes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BundlesSelectionList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selected</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_model</span><span class="p">()</span>

<div class="viewcode-block" id="BundlesSelectionList.refresh_model"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.BundlesSelectionList.refresh_model">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reloads data from the database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tuples</span> <span class="o">=</span> <span class="n">bundles_db</span><span class="o">.</span><span class="n">get_bundle_ids_and_names</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">tuples</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="BundlesSelectionList.select_many_ids"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.BundlesSelectionList.select_many_ids">[docs]</a>    <span class="k">def</span> <span class="nf">select_many_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids_it</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds several bundles to the selection</span>

<span class="sd">        Args:</span>
<span class="sd">            ids_it (list) : List of database ids to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids_it</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="BundlesSelectionList.get_selected"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.BundlesSelectionList.get_selected">[docs]</a>    <span class="k">def</span> <span class="nf">get_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of selected bundle ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">):</span>
                <span class="n">bid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>

        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">):</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span>
                <span class="k">return</span> <span class="n">flag</span>
        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>

    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">:</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">QVariant</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
                    <span class="n">bid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_selected</span><span class="p">[</span><span class="n">bid</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

</div>
<div class="viewcode-block" id="ScenariosTableModel"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.ScenariosTableModel">[docs]</a><span class="k">class</span> <span class="nc">ScenariosTableModel</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table with available scenarios</span>

<span class="sd">    Optionally restricts the table to scenarios for a certain application</span>
<span class="sd">    It has three columns: date, name and description</span>

<span class="sd">    Args:</span>
<span class="sd">        app_name (str) : Name of application, if ``None`` scenarios for all applications are shown</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ScenariosTableModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span> <span class="o">=</span> <span class="n">app_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Date&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="s">&quot;Description&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;scn_date&quot;</span><span class="p">,</span> <span class="s">&quot;scn_name&quot;</span><span class="p">,</span> <span class="s">&quot;scn_desc&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reload_data</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reload_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">braviz_user_data</span><span class="o">.</span><span class="n">get_scenarios_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">p_int</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">p_int</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnCount</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_SortOrder_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">Qt_SortOrder_order</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">p_int</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

<div class="viewcode-block" id="ScenariosTableModel.get_index"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.ScenariosTableModel.get_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the database index for the scenario in a given row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="ScenariosTableModel.get_name"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.ScenariosTableModel.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of the scenario at a given row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s">&quot;scn_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>

</div></div>
<div class="viewcode-block" id="SimpleSetModel"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleSetModel">[docs]</a><span class="k">class</span> <span class="nc">SimpleSetModel</span><span class="p">(</span><span class="n">QAbstractListModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms a python :class:`set` into a Qt List Model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SimpleSetModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__internal_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__internal_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__internal_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__internal_list</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">None</span>

<div class="viewcode-block" id="SimpleSetModel.get_elements"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleSetModel.get_elements">[docs]</a>    <span class="k">def</span> <span class="nf">get_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a set of the current data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__internal_list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SimpleSetModel.set_elements"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleSetModel.set_elements">[docs]</a>    <span class="k">def</span> <span class="nf">set_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_set</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the current elements in the model</span>

<span class="sd">        Args:</span>
<span class="sd">            data_set (set) : Items to be stored in the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__internal_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data_set</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="SimpleCheckModel"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleCheckModel">[docs]</a><span class="k">class</span> <span class="nc">SimpleCheckModel</span><span class="p">(</span><span class="n">QAbstractListModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides a model for selecting items from a set of choices (represented with checkboxes in Qt Views)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">choices</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides a model for selecting items from a set of choices (represented with checkboxes in Qt Views)</span>

<span class="sd">        Args:</span>
<span class="sd">            choices (list) : List of elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SimpleCheckModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choices_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__selected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<div class="viewcode-block" id="SimpleCheckModel.get_selected"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleCheckModel.get_selected">[docs]</a>    <span class="k">def</span> <span class="nf">get_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a tuple of the checked items</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__selected</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices_list</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices_list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">item</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__selected</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices_list</span><span class="p">):</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span>
                <span class="k">return</span> <span class="n">flag</span>
        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>

    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">:</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices_list</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">QVariant</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices_list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__selected</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__selected</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

<div class="viewcode-block" id="SimpleCheckModel.set_selection"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SimpleCheckModel.set_selection">[docs]</a>    <span class="k">def</span> <span class="nf">set_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the currently selected items to those (and only those) in *selection*</span>

<span class="sd">        Args:</span>
<span class="sd">            selection (set) : New set of checked items</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__selected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="SamplesFilterModel"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SamplesFilterModel">[docs]</a><span class="k">class</span> <span class="nc">SamplesFilterModel</span><span class="p">(</span><span class="n">QAbstractListModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A list of filters that can be applied to a sample</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SamplesFilterModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__filters_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filters_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filters_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filters_list</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">None</span>

<div class="viewcode-block" id="SamplesFilterModel.add_filter"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SamplesFilterModel.add_filter">[docs]</a>    <span class="k">def</span> <span class="nf">add_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_name</span><span class="p">,</span> <span class="n">filter_func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a filter to the list</span>

<span class="sd">        Args:</span>
<span class="sd">            filter_name (str) : Name of the filter, this will be shown to the user</span>
<span class="sd">            filter_func (function) : This function should take a subject id and return a boolean.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filters_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginInsertRows</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">(),</span> <span class="n">new_row</span><span class="p">,</span> <span class="n">new_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__filters_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">filter_name</span><span class="p">,</span> <span class="n">filter_func</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endInsertRows</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SamplesFilterModel.apply_filters"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SamplesFilterModel.apply_filters">[docs]</a>    <span class="k">def</span> <span class="nf">apply_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_set</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply all filters to a given set</span>

<span class="sd">        Args:</span>
<span class="sd">            input_set (set) : Set of subject ids</span>

<span class="sd">        Returns:</span>
<span class="sd">            filtered set of subject ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_set</span> <span class="o">=</span> <span class="n">input_set</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filters_list</span><span class="p">:</span>
            <span class="n">output_set</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">output_set</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_set</span>
</div>
<div class="viewcode-block" id="SamplesFilterModel.remove_filter"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SamplesFilterModel.remove_filter">[docs]</a>    <span class="k">def</span> <span class="nf">remove_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a filter located at a given row</span>

<span class="sd">        Args:</span>
<span class="sd">            index (QModelIndex) : Index of the row containing the filter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginRemoveRows</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">(),</span> <span class="n">row</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__filters_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endRemoveRows</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="SamplesSelectionModel"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SamplesSelectionModel">[docs]</a><span class="k">class</span> <span class="nc">SamplesSelectionModel</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table showing available subsamples</span>

<span class="sd">    It has three columns: sample size, sample name, and sample description</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SamplesSelectionModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">braviz_user_data</span><span class="o">.</span><span class="n">get_samples_df</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;sample_size&quot;</span><span class="p">,</span> <span class="s">&quot;sample_name&quot;</span><span class="p">,</span> <span class="s">&quot;sample_desc&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Size&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="s">&quot;Description&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SamplesSelectionModel.reload"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SamplesSelectionModel.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reload subsamples from the database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">braviz_user_data</span><span class="o">.</span><span class="n">get_samples_df</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span> <span class="ow">or</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolTipRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">p_int</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_SortOrder_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">sort_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">p_int</span><span class="p">]</span>
        <span class="n">ascending</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">Qt_SortOrder_order</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span><span class="p">:</span>
            <span class="n">ascending</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">sort_col</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="n">ascending</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

<div class="viewcode-block" id="SamplesSelectionModel.get_sample"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SamplesSelectionModel.get_sample">[docs]</a>    <span class="k">def</span> <span class="nf">get_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the set of subjects in a subsample located at a certain row</span>

<span class="sd">        Args:</span>
<span class="sd">            QModelIndex (QModelIndex) : Index of a cell in the table (only the row is important)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">sample_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">braviz_user_data</span><span class="o">.</span><span class="n">get_sample_data</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sample_index</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="SamplesSelectionModel.get_sample_index"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SamplesSelectionModel.get_sample_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_sample_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the database index of a subsample located at a certain row</span>

<span class="sd">        Args:</span>
<span class="sd">            QModelIndex (QModelIndex) : Index of a cell in the table (only the row is important)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">sample_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">sample_index</span>
</div>
<div class="viewcode-block" id="SamplesSelectionModel.get_sample_name"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SamplesSelectionModel.get_sample_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_sample_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of a subsample located at a certain row</span>

<span class="sd">        Args:</span>
<span class="sd">            QModelIndex (QModelIndex) : Index of a cell in the table (only the row is important)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">sample_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frame</span><span class="p">[</span><span class="s">&quot;sample_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">sample_name</span>

</div></div>
<div class="viewcode-block" id="SubjectChecklist"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectChecklist">[docs]</a><span class="k">class</span> <span class="nc">SubjectChecklist</span><span class="p">(</span><span class="n">QAbstractListModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A list of subjects with checkboxes</span>

<span class="sd">    Args:</span>
<span class="sd">        initial_list (list) : List of subject ids</span>
<span class="sd">        show_checks (bool) : If ``False`` no checkboxes will be shown</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_list</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(),</span> <span class="n">show_checks</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">QAbstractListModel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">initial_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__checked</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__show_checks</span> <span class="o">=</span> <span class="n">show_checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__highlight_subject</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">checked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set of checked subjects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checked</span>

    <span class="nd">@checked.setter</span>
    <span class="k">def</span> <span class="nf">checked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_set</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__checked</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">new_set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highlighted_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__highlight_subject</span>

    <span class="nd">@highlighted_subject.setter</span>
    <span class="k">def</span> <span class="nf">highlighted_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__highlight_subject</span> <span class="o">=</span> <span class="n">subj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

<div class="viewcode-block" id="SubjectChecklist.set_list"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectChecklist.set_list">[docs]</a>    <span class="k">def</span> <span class="nf">set_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the list of subjects</span>

<span class="sd">        Args:</span>
<span class="sd">            lst (list) : List of subject ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">name</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__show_checks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">checked</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">FontRole</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__highlight_subject</span><span class="p">:</span>
                    <span class="n">font</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">()</span>
                    <span class="n">font</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">font</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__highlight_subject</span><span class="p">:</span>
                    <span class="n">brush</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">()</span>
                    <span class="n">brush</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="s">&quot;palegreen&quot;</span><span class="p">))</span>
                    <span class="n">brush</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">SolidPattern</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">brush</span>

        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span>
            <span class="k">return</span> <span class="n">flags</span>
        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>

</div>
<div class="viewcode-block" id="SubjectCheckTable"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectCheckTable">[docs]</a><span class="k">class</span> <span class="nc">SubjectCheckTable</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table of subjects with optional checkboxes</span>

<span class="sd">    Args:</span>
<span class="sd">        initial_list (list) : List of subject ids</span>
<span class="sd">        data_cols (list) : List of columns to shown, where each column is an iterable of the same length as the subject</span>
<span class="sd">            lists, such that the value for the subject in position *i* is also located at position *i*</span>
<span class="sd">        headers (list) : List of strings used as headers for the table on top of each data column</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_list</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(),</span> <span class="n">data_cols</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)):</span>
        <span class="n">QAbstractTableModel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_cols</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">initial_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__checked</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">data_cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span> <span class="o">=</span> <span class="n">headers</span>

<div class="viewcode-block" id="SubjectCheckTable.set_data_cols"><a class="viewcode-back" href="../../../library/qt_models.html#braviz.interaction.qt_models.SubjectCheckTable.set_data_cols">[docs]</a>    <span class="k">def</span> <span class="nf">set_data_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_cols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets new data columns</span>

<span class="sd">        Args:</span>
<span class="sd">            new_cols (list) : List of data columns, must have the same length as the headers. Each data column</span>
<span class="sd">                is itself an iterable of the same length and indices as the subjects list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_cols</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__headers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">new_cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">checked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set of checked subjects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checked</span>

    <span class="nd">@checked.setter</span>
    <span class="k">def</span> <span class="nf">checked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_set</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__checked</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex_parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">name</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">checked</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">row</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">TextAlignmentRole</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">flags</span> <span class="o">|=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span>
            <span class="k">return</span> <span class="n">flags</span>
        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>

    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_int</span><span class="p">,</span> <span class="n">Qt_Orientation</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Qt_Orientation</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__headers</span><span class="p">[</span><span class="n">p_int</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">TextAlignmentRole</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p_int</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignLeft</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">QVariant</span><span class="p">,</span> <span class="n">int_role</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">QModelIndex</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">int_role</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">QVariant</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checked</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checked</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">braviz</span>

    <span class="n">reader</span> <span class="o">=</span> <span class="n">braviz</span><span class="o">.</span><span class="n">readAndFilter</span><span class="o">.</span><span class="n">BravizAutoReader</span><span class="p">()</span>
    <span class="n">test_tree</span> <span class="o">=</span> <span class="n">StructureTreeModel</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
        </div>

        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          
                

                

                

          
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Diego Angulo.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>







        
  </body>
</html>