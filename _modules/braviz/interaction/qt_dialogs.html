<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>braviz.interaction.qt_dialogs &mdash; Braviz Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.3b',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/fold_classes.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
    <link rel="top" title="Braviz Documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../../../index.html">
            <img class="logo" src="../../../_static/Logo_Bravis_h.png" alt="Logo"/>
          </a></p>
          <!--
        <div class="headertitle"><a
          href="../../../index.html"> Documentation </a></div>
          -->
          <nav class="parents">
              <ol>
        <li><a href="../../../index.html"> Home </a> &raquo;</li>
          <li><a href="../../index.html"  accesskey="U"  >Module code</a> &raquo;</li>
                  </ol>
          </nav>
       </div>
    </div>


    <div class="content-wrapper">
      <div class="content">
        <div class="sidebar" id="agogo-sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/Logo_Bravis_h.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        </div>
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for braviz.interaction.qt_dialogs</h1><div class="highlight"><pre>
<span></span><span class="c1">##############################################################################</span>
<span class="c1">#    Braviz, Brain Data interactive visualization                            #</span>
<span class="c1">#    Copyright (C) 2014  Diego Angulo                                        #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    This program is free software: you can redistribute it and/or modify    #</span>
<span class="c1">#    it under the terms of the GNU Lesser General Public License as          #</span>
<span class="c1">#    published by  the Free Software Foundation, either version 3 of the     #</span>
<span class="c1">#    License, or (at your option) any later version.                         #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    This program is distributed in the hope that it will be useful,         #</span>
<span class="c1">#    but WITHOUT ANY WARRANTY; without even the implied warranty of          #</span>
<span class="c1">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           #</span>
<span class="c1">#    GNU Lesser General Public License for more details.                     #</span>
<span class="c1">#                                                                            #</span>
<span class="c1">#    You should have received a copy of the GNU Lesser General Public License#</span>
<span class="c1">#    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.   #</span>
<span class="c1">##############################################################################</span>


<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">as</span> <span class="nn">QtGui</span>
<span class="kn">import</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">as</span> <span class="nn">QtCore</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">braviz</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.outcome_select</span> <span class="kn">import</span> <span class="n">Ui_SelectOutcomeDialog</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.outcome_select_multi_plot</span> <span class="kn">import</span> <span class="n">Ui_SelectOutcomeMPDialog</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.regressors_select</span> <span class="kn">import</span> <span class="n">Ui_AddRegressorDialog</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.interactions_dialog</span> <span class="kn">import</span> <span class="n">Ui_InteractionsDiealog</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.context_variables_select</span> <span class="kn">import</span> <span class="n">Ui_ContextVariablesDialog</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.new_variable_dialog</span> <span class="kn">import</span> <span class="n">Ui_NewVariableDialog</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.load_bundles_dialog</span> <span class="kn">import</span> <span class="n">Ui_LoadBundles</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.save_fibers_bundle</span> <span class="kn">import</span> <span class="n">Ui_SaveBundleDialog</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.save_logic_fibers_bundle</span> <span class="kn">import</span> <span class="n">Ui_SaveLogicBundleDialog</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.save_scenario_dialog</span> <span class="kn">import</span> <span class="n">Ui_SaveScenarioDialog</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.load_scenario_dialog</span> <span class="kn">import</span> <span class="n">Ui_LoadScenarioDialog</span>
<span class="kn">from</span> <span class="nn">braviz.interaction.qt_guis.load_logic_bundle</span> <span class="kn">import</span> <span class="n">Ui_LoadLogicDialog</span>

<span class="kn">from</span> <span class="nn">braviz.interaction.logic_bundle_model</span> <span class="kn">import</span> <span class="n">LogicBundleNode</span><span class="p">,</span> <span class="n">LogicBundleQtTree</span>

<span class="kn">import</span> <span class="nn">braviz.interaction.qt_widgets</span>
<span class="kn">import</span> <span class="nn">braviz.interaction.qt_models</span> <span class="kn">as</span> <span class="nn">braviz_models</span>
<span class="kn">from</span> <span class="nn">braviz.readAndFilter.tabular_data</span> <span class="kn">import</span> <span class="n">get_data_frame_by_name</span><span class="p">,</span> <span class="n">get_var_idx</span><span class="p">,</span> <span class="n">get_min_max_values_by_name</span><span class="p">,</span> \
    <span class="n">is_variable_name_real</span><span class="p">,</span> <span class="n">get_var_description_by_name</span><span class="p">,</span> <span class="n">save_is_real_by_name</span><span class="p">,</span> \
    <span class="n">save_real_meta_by_name</span><span class="p">,</span> <span class="n">save_var_description_by_name</span><span class="p">,</span> <span class="n">get_min_max_opt_values_by_name</span><span class="p">,</span> <span class="n">register_new_variable</span><span class="p">,</span> \
    <span class="n">save_real_meta</span><span class="p">,</span> <span class="n">save_var_description</span>

<span class="kn">import</span> <span class="nn">braviz.readAndFilter.tabular_data</span> <span class="kn">as</span> <span class="nn">braviz_tab_data</span>

<span class="kn">from</span> <span class="nn">braviz.readAndFilter</span> <span class="kn">import</span> <span class="n">bundles_db</span>
<span class="kn">import</span> <span class="nn">braviz.readAndFilter.user_data</span> <span class="kn">as</span> <span class="nn">braviz_user_data</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">izip</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Diego&#39;</span>


<div class="viewcode-block" id="VariableSelectDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.VariableSelectDialog">[docs]</a><span class="k">class</span> <span class="nc">VariableSelectDialog</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Abstract**, Implement common features for Outcome and Regressor Dialogs</span>

<span class="sd">    This class is incomplete, in order to get a full dialog consider using one of the inherited</span>
<span class="sd">    classes.</span>

<span class="sd">    In particular there is no ui associated with this class, in subclasses you should add a UI</span>
<span class="sd">    and then call ``finish_ui_setup``</span>

<span class="sd">    Args:</span>
<span class="sd">        sample (list) : Optional, list of subject indices to include in plot, if None, the whole sample is displayed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;remember to call finish_ui_setup() after setting up ui&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VariableSelectDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rational</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">sample</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_subjects</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">sample</span><span class="p">))</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;got custom sample&quot;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_right_side</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># if nothing is selected</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_type_combo</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">is_real</span> <span class="o">=</span> <span class="n">is_variable_name_real</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">get_data_frame_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[[]]</span>
        <span class="c1"># update scatter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">var_description</span> <span class="o">=</span> <span class="n">get_var_description_by_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_description</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="n">var_description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_description</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># update gui</span>
        <span class="k">if</span> <span class="n">is_real</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_type_combo</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_details</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_type_combo</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_details</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="c1"># is_real=self.ui.var_type_combo.currentIndex()</span>
        <span class="c1"># print index</span>
        <span class="c1"># print &quot;====&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">details_frame</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_real_details</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">details_frame</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_nominal_details</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">guess_max_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">mini</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">maxi</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">medi</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">median</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mini</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;opt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">medi</span>

    <span class="k">def</span> <span class="nf">set_real_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">maxi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span>
        <span class="n">mini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span>
        <span class="n">medi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;opt&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">maxi</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">maxi</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">mini</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mini</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">medi</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">medi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">maximum_val</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">maxi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">minimum_val</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">mini</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">minimum_val</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">maximum_val</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">minimum_val</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">mini</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">maximum_val</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">mini</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">minimum_val</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">maxi</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">maximum_val</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">maxi</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">((</span><span class="n">medi</span> <span class="o">-</span> <span class="n">mini</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">maxi</span> <span class="o">-</span> <span class="n">mini</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_optimum_real_value</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_optimum_real_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">perc_value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">perc_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">perc_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">real_value</span> <span class="o">=</span> <span class="n">perc_value</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">])</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">real_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_real_value</span><span class="o">.</span><span class="n">setNum</span><span class="p">(</span><span class="n">real_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_real_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;creating real details&quot;</span><span class="p">)</span>

        <span class="c1"># try to read values from DB</span>
        <span class="n">db_values</span> <span class="o">=</span> <span class="n">get_min_max_opt_values_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">db_values</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guess_max_min</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;opt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_real_controls</span><span class="p">()</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_limits_in_plot</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset_real_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guess_max_min</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_real_controls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_limits_in_plot</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">update_nominal_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;creating nominal details&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">NominalVariablesMeta</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span><span class="o">.</span><span class="n">update_model</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">labels_names_table</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_limits_in_plot</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">finish_ui_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">current_flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowFlags</span><span class="p">()</span>
        <span class="n">current_flags</span> <span class="o">|=</span> <span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CustomizeWindowHint</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowMaximizeButtonHint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">current_flags</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plot_frame</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span> <span class="o">=</span> <span class="n">braviz</span><span class="o">.</span><span class="n">interaction</span><span class="o">.</span><span class="n">qt_widgets</span><span class="o">.</span><span class="n">MatplotWidget</span><span class="p">(</span>
            <span class="n">initial_message</span><span class="o">=</span><span class="s2">&quot;Double click on variables</span><span class="se">\n</span><span class="s2">to see plots&quot;</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="p">)</span>
        <span class="n">target</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_meta_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_type_combo</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_details</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">scatter_pick_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_plot_tooltip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_delete_menu</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">details_frame</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#Real details</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_limits_in_plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">minimum_val</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_limits_in_plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">maximum_val</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_limits_in_plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_optimum_real_value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">horizontalSlider</span><span class="o">.</span><span class="n">setValue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">horizontalSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">setValue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">reset_real_meta</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_real_details</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_limits_in_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_type_combo</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">add_max_min_opt_lines</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">mini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">minimum_val</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">maxi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">maximum_val</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">opti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">opti</span> <span class="o">=</span> <span class="n">mini</span> <span class="o">+</span> <span class="n">opti</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxi</span> <span class="o">-</span> <span class="n">mini</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mini</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;opt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opti</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">add_max_min_opt_lines</span><span class="p">(</span><span class="n">mini</span><span class="p">,</span> <span class="n">opti</span><span class="p">,</span> <span class="n">maxi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_meta_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">var_type</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># nominal should be 1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_type_combo</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">var_type</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># real should be 1</span>

        <span class="c1"># save variable type</span>
        <span class="n">save_is_real_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="n">var_type</span><span class="p">)</span>

        <span class="c1"># save description</span>
        <span class="n">desc_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_description</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="n">save_var_description_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">desc_text</span><span class="p">))</span>

        <span class="c1"># save other values</span>
        <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># real</span>
            <span class="n">save_real_meta_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rational</span><span class="p">[</span><span class="s2">&quot;opt&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">var_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span><span class="o">.</span><span class="n">save_into_db</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">show_plot_tooltip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subj</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Subject: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">subj</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QToolTip</span><span class="o">.</span><span class="n">showText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span>
            <span class="n">QtCore</span><span class="o">.</span><span class="n">QPoint</span><span class="p">(</span><span class="o">*</span><span class="n">position</span><span class="p">)),</span> <span class="n">message</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_delete_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;showing menu&quot;</span><span class="p">)</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="n">cur_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">idx2</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cur_idx</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">idx2</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">delete_var</span><span class="p">():</span>
            <span class="n">confirm</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                 <span class="s2">&quot;Confirm delete variable&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;Are you sure you want to delete </span><span class="se">\n</span><span class="si">%s</span><span class="s2"> ?</span><span class="se">\n</span><span class="s2">This is not reversible&quot;</span> <span class="o">%</span> <span class="n">var_name</span><span class="p">,</span>
                                                 <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">,</span>
                                                 <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">confirm</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;deleting&quot;</span><span class="p">)</span>
                <span class="n">var_idx</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_var_idx</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">var_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">recursive_delete_variable</span><span class="p">(</span><span class="n">var_idx</span><span class="p">)</span>
                <span class="n">mod</span><span class="o">.</span><span class="n">update_list</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;cancelled&quot;</span><span class="p">)</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Delete </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">menu</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">delete_var</span><span class="p">)</span>
        <span class="n">global_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">global_pos</span><span class="p">)</span></div>


<div class="viewcode-block" id="OutcomeSelectDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.OutcomeSelectDialog">[docs]</a><span class="k">class</span> <span class="nc">OutcomeSelectDialog</span><span class="p">(</span><span class="n">VariableSelectDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dialog for selecting a single or multiple variable</span>

<span class="sd">    The constructor takes a dictionary which will be used to save the selection in the dialog.</span>
<span class="sd">    When the user clicks the *save and select* button, the dialog will close, and the current selection</span>
<span class="sd">    will be available in the ``selected_outcome`` field of the dictionary.</span>

<span class="sd">    If you need multiple variables consider using :class:`GenericVariableSelectDialog`.</span>

<span class="sd">    If ``multiple = True`` is passed to the constructor the variable list will have check marks.</span>
<span class="sd">    The output dictionary will still contain only one variable, but the list is available in</span>
<span class="sd">    the ``vars_list_model`` field. You may get a set of selected variables by calling</span>
<span class="sd">    ``dialog.vars_list_model.checked_set``</span>

<span class="sd">    The constructor also takes a ``sample`` parameter which can be used to set the sample used in the</span>
<span class="sd">    right side plot.</span>

<span class="sd">    Args:</span>
<span class="sd">        params_dict (dict) : Output will be written in this object</span>
<span class="sd">        multiple (bool) : If True, allows to select multiple variables by placing checkmarks</span>
<span class="sd">        sample (list) : Optional, list of subject indices to include in plot, if None, the whole sample is displayed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params_dict</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OutcomeSelectDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_SelectOutcomeDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_ui_setup</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">params_dict</span> <span class="o">=</span> <span class="n">params_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_subj</span> <span class="o">=</span> <span class="n">highlight</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vars_list_model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">VarListModel</span><span class="p">(</span><span class="n">checkeable</span><span class="o">=</span><span class="n">multiple</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars_list_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">select_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_and_return</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">search_box</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_right_side</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">curr_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_list_model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">curr_idx</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">select_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OutcomeSelectDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">data_values</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
        <span class="n">jitter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_values</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">compute_scatter</span><span class="p">(</span><span class="n">data_values</span><span class="p">,</span> <span class="n">jitter</span><span class="p">,</span>
                                            <span class="n">x_lab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="n">y_lab</span><span class="o">=</span><span class="s2">&quot;jitter&quot;</span><span class="p">,</span> <span class="n">urls</span><span class="o">=</span><span class="n">data2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_values</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight_subj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">subj_index</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">highlight_subj</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">add_subject_points</span><span class="p">((</span><span class="n">data_values</span><span class="p">[</span><span class="n">subj_index</span><span class="p">]),</span> <span class="p">(</span><span class="n">jitter</span><span class="p">[</span><span class="n">subj_index</span><span class="p">],),</span>
                                                       <span class="n">urls</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">highlight_subj</span><span class="p">,))</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>


    <span class="k">def</span> <span class="nf">select_and_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_meta_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params_dict</span><span class="p">[</span><span class="s2">&quot;selected_outcome&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">filter_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%%%s%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">search_box</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars_list_model</span><span class="o">.</span><span class="n">update_list</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span></div>


<div class="viewcode-block" id="GenericVariableSelectDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.GenericVariableSelectDialog">[docs]</a><span class="k">class</span> <span class="nc">GenericVariableSelectDialog</span><span class="p">(</span><span class="n">OutcomeSelectDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dialog for selecting one or multiple variables with initial selection.</span>

<span class="sd">    This dialog is optimized for multiple selections, and it improves :class:`~OutcomeSelectDialog` in that</span>

<span class="sd">        - In the *multiple* mode, the output dictionary includes a ``checked`` field with the codes of the selected variables</span>
<span class="sd">        - In the *multiple* mode, initial selections can be set using the ``initial_selection_names`` and</span>
<span class="sd">          ``initial_selection_idx`` parameters in the constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        params (dict) : Output will be written in this object</span>
<span class="sd">        multiple (bool) : If True, allows to select multiple variables by placing checkmarks</span>
<span class="sd">        initial_selection_names (list) : List of variable names which should be selected when the dialog opens</span>
<span class="sd">        initial_selection_idx (list) : List of variable indeces which should be selected when the dialog opens</span>
<span class="sd">        sample (list) : Optional, list of subject indices to include in plot, if None, the whole sample is displayed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">initial_selection_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_selection_idx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">highlight</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">OutcomeSelectDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="n">multiple</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="n">highlight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiple</span> <span class="o">=</span> <span class="n">multiple</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Select Variables&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">select_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Accept Selection&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">select_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">initial_selection_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vars_list_model</span><span class="o">.</span><span class="n">select_items</span><span class="p">(</span><span class="n">initial_selection_idx</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">initial_selection_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vars_list_model</span><span class="o">.</span><span class="n">select_items_by_name</span><span class="p">(</span>
                    <span class="n">initial_selection_names</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_and_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiple</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">selected_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_list_model</span><span class="o">.</span><span class="n">checked_set</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params_dict</span><span class="p">[</span><span class="s2">&quot;checked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">get_var_idx</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">selected_names</span><span class="p">]</span>
        <span class="n">OutcomeSelectDialog</span><span class="o">.</span><span class="n">select_and_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="MultiPlotOutcomeSelectDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.MultiPlotOutcomeSelectDialog">[docs]</a><span class="k">class</span> <span class="nc">MultiPlotOutcomeSelectDialog</span><span class="p">(</span><span class="n">OutcomeSelectDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dialog for selecting one variable with multiple plot options</span>

<span class="sd">    The selected variable will be available in the ``selected_outcome`` field of the</span>
<span class="sd">    *params_dict* dictionary.</span>

<span class="sd">    The constructor takes the ``available_plots`` argument, which contains a list of plots to make available</span>
<span class="sd">    in the dialog. This list should contain tuples of the following types</span>

<span class="sd">        - ``(&quot;scatter&quot;, None)`` : The default plot, *x* is the variable, and *y* is jitter</span>
<span class="sd">        - ``(&quot;scatter&quot;, var)`` : An scatter plot in which *x* is variable *var* and *y*</span>
<span class="sd">          is the current variable.</span>
<span class="sd">        - ``(&quot;box&quot;,var)`` : A box plot using variable *var* for groups and the current variable for values</span>
<span class="sd">        - ``(&quot;interaction&quot;, vars)`` : A two factor box plot where the groups are the interaction between the variables</span>
<span class="sd">          in *vars* , which is a string with an ``*`` between the two names.</span>

<span class="sd">    Args:</span>
<span class="sd">        params_dict (dict) : Output will be written in this object</span>
<span class="sd">        sample (list) : Optional, list of subject indices to include in plot, if None, the whole sample is displayed</span>
<span class="sd">        available_plots (list) : List of plots which will be available for the user, syntax was explained above</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params_dict</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">available_plots</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">VariableSelectDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_SelectOutcomeMPDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">available_plots</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">available_plots</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plot_type</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available_plots</span> <span class="o">=</span> <span class="n">available_plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_data_frame</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_ui_setup</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">params_dict</span> <span class="o">=</span> <span class="n">params_dict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vars_list_model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">VarListModel</span><span class="p">(</span><span class="n">checkeable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars_list_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">select_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_and_return</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">search_box</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plot_type</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_plot</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="n">default_plot</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;scatter&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_plots</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">plot_type</span> <span class="o">=</span> <span class="n">default_plot</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_str</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">plot_type</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">plot_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_plots</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plot_str</span><span class="p">,</span> <span class="n">default_plot</span><span class="p">)</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">plot_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;scatter&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plot_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">compute_scatter</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">x_lab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="n">y_lab</span><span class="o">=</span><span class="s2">&quot;jitter&quot;</span><span class="p">,</span> <span class="n">urls</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">limits_vertical</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">plot_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_data_frame_by_name</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">]</span>
                <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">compute_scatter</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">x_lab</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y_lab</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">urls</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">limits_vertical</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">plot_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;box&quot;</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">plot_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_data_frame_by_name</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">]</span>
            <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">label_nums</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
            <span class="n">labels_dict</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_labels_dict_by_name</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">make_box_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">labels_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">limits_vertical</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">plot_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;interaction&quot;</span><span class="p">:</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="n">plot_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">limits_vertical</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">two_factors_plot</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_limits_in_plot</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">two_factors_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factors_list</span><span class="p">):</span>
        <span class="c1"># copied from anova application... not a good practice</span>
        <span class="n">nominal_factors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">real_factors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># classify factors</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">factors_list</span><span class="p">:</span>
            <span class="n">is_real</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">is_variable_name_real</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_real</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nominal_factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">real_factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_factors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

            <span class="n">top_labels_dict</span> <span class="o">=</span> <span class="n">braviz_tab_data</span><span class="o">.</span><span class="n">get_labels_dict_by_name</span><span class="p">(</span>
                <span class="n">nominal_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Dark2&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_labels_dict</span><span class="p">))</span>
            <span class="c1"># print top_labels_strings</span>
            <span class="n">colors_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">izip</span><span class="p">(</span><span class="n">top_labels_dict</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">(),</span> <span class="n">colors</span><span class="p">))</span>
            <span class="n">plot_color</span> <span class="o">=</span> <span class="n">colors_dict</span>
            <span class="c1"># Get Data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_data_frame_by_name</span><span class="p">(</span>
                <span class="p">[</span><span class="n">real_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nominal_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">]</span>
            <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_data_frame</span> <span class="o">=</span> <span class="n">data</span>

            <span class="n">datax</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">datay</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">top_labels_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colors_dict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">datay</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="n">nominal_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">get_values</span><span class="p">())</span>
                <span class="n">datax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">real_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">data</span><span class="p">[</span><span class="n">nominal_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">get_values</span><span class="p">())</span>
                <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="n">nominal_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_values</span><span class="p">())</span>
                <span class="c1"># print datax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">compute_scatter</span><span class="p">(</span>
                <span class="n">datax</span><span class="p">,</span> <span class="n">datay</span><span class="p">,</span> <span class="n">real_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">urls</span><span class="o">=</span><span class="n">urls</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_factors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Not yet implemented&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">initial_text</span><span class="p">(</span><span class="s2">&quot;Not yet implemented&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># get data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_data_frame_by_name</span><span class="p">(</span><span class="n">nominal_factors</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">]</span>
            <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="c1"># find number of levels for nominal</span>
            <span class="n">nlevels</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">nominal_factors</span><span class="p">:</span>
                <span class="n">nlevels</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
                <span class="c1"># print nlevels</span>
            <span class="n">nominal_factors</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">nlevels</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="c1"># print nominal_factors</span>

            <span class="n">levels_second_factor</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">nominal_factors</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">get_values</span><span class="p">())</span>
            <span class="n">levels_first_factor</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">nominal_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">get_values</span><span class="p">())</span>
            <span class="n">data_lists_top</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">levels_second_factor</span><span class="p">:</span>
                <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">levels_first_factor</span><span class="p">:</span>
                    <span class="n">data_col</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">][(</span><span class="n">data</span><span class="p">[</span><span class="n">nominal_factors</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span>
                                                   <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">nominal_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">j</span><span class="p">)]</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
                    <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_col</span><span class="p">)</span>
                <span class="n">data_lists_top</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">make_linked_box_plot</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="n">nominal_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nominal_factors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="SelectOneVariableWithFilter"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.SelectOneVariableWithFilter">[docs]</a><span class="k">class</span> <span class="nc">SelectOneVariableWithFilter</span><span class="p">(</span><span class="n">OutcomeSelectDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dialog for selecting one variable of an specific kind.</span>

<span class="sd">    This dialog behaves likes the :class:`OutcomeSelectDialog`, but you may choose to accept only</span>
<span class="sd">    nominal or only real variables using the parameters ``accept_real`` and ``accept_nominal`` of the constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        params (dict) : Output will be written in this object</span>
<span class="sd">        accept_nominal (bool) : If ``False`` the select button will be disabled for nominal variables</span>
<span class="sd">        accept_real (bool) : If ``False`` the select button will be disabled for real variables</span>
<span class="sd">        sample (list) : Optional, list of subject indices to include in plot, if None, the whole sample is displayed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">accept_nominal</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">accept_real</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">OutcomeSelectDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Select Variable&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept_real</span> <span class="o">=</span> <span class="n">accept_real</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept_nominal</span> <span class="o">=</span> <span class="n">accept_nominal</span>

    <span class="k">def</span> <span class="nf">check_selecion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">is_current_variable_real</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_type_combo</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is_current_variable_real</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept_real</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">is_current_variable_real</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept_nominal</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">select_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">select_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SelectOneVariableWithFilter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update_details</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_selecion</span><span class="p">()</span></div>


<div class="viewcode-block" id="RegressorSelectDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.RegressorSelectDialog">[docs]</a><span class="k">class</span> <span class="nc">RegressorSelectDialog</span><span class="p">(</span><span class="n">VariableSelectDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dialog for selecting a secondary variable in the analysis.</span>

<span class="sd">    The ``outcome_var`` parameter of the constructor may be used to specify a variable of reference.</span>
<span class="sd">    The default plot would have current variable in the *x* axis and the *outcome_var* variable in the</span>
<span class="sd">    *y* axis. If *outcome_var* is None, the *y* axis will be jitter.</span>

<span class="sd">    The ``regressors_model`` parameter should be an instance of</span>
<span class="sd">    :class:`~braviz.interaction.qt_models.AnovaRegressorsModel`. Variables will be added to and removed from</span>
<span class="sd">    the model using the dialog.</span>

<span class="sd">    This dialog also allows the user to sort the variables according to a ginni index over the</span>
<span class="sd">    *outcome_var*</span>

<span class="sd">    Args:</span>
<span class="sd">        outcome_var (unicode) : Variable to use as reference. It will be the *y* axis of plots, look above</span>
<span class="sd">            for more uses</span>
<span class="sd">        regressors_model (braviz.interaction.qt_models.AnovaRegressorsModel): All operations will update this model</span>
<span class="sd">        sample (list) : Optional, list of subject indices to include in plot, if None, the whole sample is displayed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome_var</span><span class="p">,</span> <span class="n">regressors_model</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RegressorSelectDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span> <span class="o">=</span> <span class="n">outcome_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_AddRegressorDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars_model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">VarAndGiniModel</span><span class="p">(</span><span class="n">outcome_var</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_ui_setup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">add_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_regressor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regressors_table_model</span> <span class="o">=</span> <span class="n">regressors_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_regressors_table</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regressors_table_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_regressors_table</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_context_menu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">done_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">search_box</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_right_side</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">curr_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">idx2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">curr_idx</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">idx2</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">add_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RegressorSelectDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_regressor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regressors_table_model</span><span class="o">.</span><span class="n">add_regressor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">global_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_regressors_table</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_regressors_table</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">remove_action</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">remove_action</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">remove_item</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">regressors_table_model</span><span class="o">.</span><span class="n">removeRows</span><span class="p">(</span><span class="n">selection</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">remove_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">remove_item</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">remove_action</span><span class="p">)</span>
        <span class="n">selected_item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">global_pos</span><span class="p">)</span>
        <span class="c1"># print selected_item</span>

    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">regressor_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span> <span class="ow">in</span> <span class="n">regressor_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">both_data</span> <span class="o">=</span> <span class="n">regressor_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outcome_data</span> <span class="o">=</span> <span class="n">get_data_frame_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span><span class="p">)</span>
                <span class="n">both_data</span> <span class="o">=</span> <span class="n">regressor_data</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outcome_data</span><span class="p">)</span>
            <span class="n">both_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">compute_scatter</span><span class="p">(</span><span class="n">both_data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">get_values</span><span class="p">(),</span>
                                                <span class="n">both_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span><span class="p">]</span><span class="o">.</span><span class="n">get_values</span><span class="p">(),</span>
                                                <span class="n">x_lab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="n">y_lab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outcome_var</span><span class="p">,</span>
                                                <span class="n">urls</span><span class="o">=</span><span class="n">both_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_values</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data2</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">compute_scatter</span><span class="p">(</span>
                <span class="n">data2</span><span class="o">.</span><span class="n">get_values</span><span class="p">(),</span> <span class="n">urls</span><span class="o">=</span><span class="n">data2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_values</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">finish_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Accepted</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%%%s%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">search_box</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars_model</span><span class="o">.</span><span class="n">update_list</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span></div>


<div class="viewcode-block" id="InteractionSelectDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.InteractionSelectDialog">[docs]</a><span class="k">class</span> <span class="nc">InteractionSelectDialog</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dialog for specifying interactions between variables</span>

<span class="sd">    The top panel contains a list of current variables, and the bottom panel contains a list of interaction terms</span>
<span class="sd">    The user may select two or more variables and click *Add single term* to add the product of the selected variables</span>
<span class="sd">    to the list of interactions. Clicking *Add all combinations* will add all possible combinations to the list.</span>

<span class="sd">    All operations will update the specified *regressors_model*, which should be an instance of</span>
<span class="sd">    :class:`~braviz.interaction.qt_models.AnovaRegressorsModel`</span>

<span class="sd">    Args:</span>
<span class="sd">        regressors_model (braviz.interaction.qt_models.AnovaRegressorsModel): All operations will update this model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regressors_model</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">InteractionSelectDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_model</span> <span class="o">=</span> <span class="n">regressors_model</span>
        <span class="n">regressors</span> <span class="o">=</span> <span class="n">regressors_model</span><span class="o">.</span><span class="n">get_regressors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">only_regs_model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">AnovaRegressorsModel</span><span class="p">(</span><span class="n">regressors</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_InteractionsDiealog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">reg_view</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">only_regs_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_model</span><span class="o">.</span><span class="n">show_regressors</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">full_view</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">add_single_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_single_term</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">add_all_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_all_combinations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_single_term</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">selected_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">reg_view</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
        <span class="n">selected_row_numbers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">row</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">selected_indexes</span><span class="p">)</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">selected_row_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_model</span><span class="o">.</span><span class="n">add_interactor</span><span class="p">(</span><span class="n">selected_row_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_all_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">only_regs_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_model</span><span class="o">.</span><span class="n">add_interactor</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>


<div class="viewcode-block" id="NewVariableDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.NewVariableDialog">[docs]</a><span class="k">class</span> <span class="nc">NewVariableDialog</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dialog for creating new variables</span>

<span class="sd">    The dialog contains fields for entering a variable name and metadata, as well as a table view</span>
<span class="sd">    where values can be entered.</span>

<span class="sd">    The dialog attempts to save the variable into the database, and if it fails shows an error message and lets the user</span>
<span class="sd">    change the variable name</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NewVariableDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_NewVariableDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_type_combo</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_meta_data_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">NominalVariablesMeta</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="c1"># self.clear_details_frame():</span>
        <span class="n">initial_nominal</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_type_combo</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">initial_nominal</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">initial_nominal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">details_frame</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">details_frame</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># self.create_meta_data_frame(initial_nominal)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values_model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">NewVariableValues</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">values_table</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_name_input</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activate_save_button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_new_variable</span><span class="p">)</span>

        <span class="c1">#real details</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_optimum_real_value</span><span class="p">)</span>

        <span class="c1">#Nominal details</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">labels_names_table</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span><span class="p">)</span>
        <span class="n">add_label_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Add Label&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">add_label_button</span><span class="p">)</span>
        <span class="n">add_label_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span><span class="o">.</span><span class="n">add_label</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">create_meta_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_nominal</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_nominal</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">details_frame</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_real_details</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">details_frame</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_nominal_details</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setup_real_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># try to read values from DB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">maximum_val</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">minimum_val</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_optimum_real_value</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setup_nominal_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># print &quot;creating details&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span><span class="o">.</span><span class="n">update_model</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">override_nominal_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels_dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span><span class="o">.</span><span class="n">set_labels_dict</span><span class="p">(</span><span class="n">labels_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_optimum_real_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">perc_value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">maxi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">maximum_val</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">mini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">minimum_val</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">perc_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">perc_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">real_value</span> <span class="o">=</span> <span class="n">perc_value</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxi</span> <span class="o">-</span> <span class="n">mini</span><span class="p">)</span> <span class="o">+</span> <span class="n">mini</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_real_value</span><span class="o">.</span><span class="n">setNum</span><span class="p">(</span><span class="n">real_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">activate_save_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_name_input</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_new_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># create new variable</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_name_input</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">is_real</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_type_combo</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">var_idx</span> <span class="o">=</span> <span class="n">register_new_variable</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">is_real</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var_idx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A variable with the same name already exists,</span><span class="se">\n</span><span class="s2">please choose a different name&quot;&quot;&quot;</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;Couldn&#39;t create variable&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">,)</span>
            <span class="k">return</span>

        <span class="c1"># add meta data</span>
        <span class="k">if</span> <span class="n">is_real</span><span class="p">:</span>
            <span class="n">mini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">minimum_val</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">maxi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">maximum_val</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">opti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">optimum_val</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">opti</span> <span class="o">=</span> <span class="n">mini</span> <span class="o">+</span> <span class="n">opti</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxi</span> <span class="o">-</span> <span class="n">mini</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="n">save_real_meta</span><span class="p">(</span><span class="n">var_idx</span><span class="p">,</span> <span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span><span class="p">,</span> <span class="n">opti</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nominal_model</span><span class="o">.</span><span class="n">save_into_db</span><span class="p">(</span><span class="n">var_idx</span><span class="p">)</span>
            <span class="c1"># description</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">var_description</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">())</span>
        <span class="n">save_var_description</span><span class="p">(</span><span class="n">var_idx</span><span class="p">,</span> <span class="n">desc</span><span class="p">)</span>
        <span class="c1"># values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values_model</span><span class="o">.</span><span class="n">save_into_db</span><span class="p">(</span><span class="n">var_idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>


<div class="viewcode-block" id="ContextVariablesSelectDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.ContextVariablesSelectDialog">[docs]</a><span class="k">class</span> <span class="nc">ContextVariablesSelectDialog</span><span class="p">(</span><span class="n">VariableSelectDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dialog for selecting multiple variables, and make some of them editable</span>

<span class="sd">    Args:</span>
<span class="sd">        variables_list (list) : List of variables indices to include in the current selection</span>
<span class="sd">        current_subject : This subject will be highlighted in plots</span>
<span class="sd">        editables_dict (dict) : This dictionary will contain which variables were selected to be editable</span>
<span class="sd">            keys are variable indices and values are booleans</span>
<span class="sd">        sample (list) : Optional, list of subject indices to include in plot, if None, the whole sample is displayed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variables_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">current_subject</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">editables_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ContextVariablesSelectDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">variables_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">variables_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__variable_lists_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">variables_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_subject</span> <span class="o">=</span> <span class="n">current_subject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_ContextVariablesDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars_model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">VarListModel</span><span class="p">(</span><span class="n">checkeable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_ui_setup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">add_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_variable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_variables_model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">ContextVariablesModel</span><span class="p">(</span><span class="n">context_vars_list</span><span class="o">=</span><span class="n">variables_list</span><span class="p">,</span>
                                                                           <span class="n">editable_dict</span><span class="o">=</span><span class="n">editables_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_variables</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_variables_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_variables</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_context_menu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">done_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_variables</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_right_side2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">create_varible_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">launch_new_variable_dialog</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">search_box</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_list</span> <span class="o">=</span> <span class="n">variables_list</span>

    <span class="k">def</span> <span class="nf">update_right_side</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curr_idx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">idx2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">curr_idx</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">idx2</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">add_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ContextVariablesSelectDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_right_side2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">var_name_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_variables_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_variables_model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span>
            <span class="n">var_name_idx</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ContextVariablesSelectDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update_right_side</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">var_idx</span> <span class="o">=</span> <span class="n">get_var_idx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_variables_model</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="n">var_idx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">global_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_variables</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_variables</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">remove_action</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">remove_action</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">remove_item</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_variables_model</span><span class="o">.</span><span class="n">removeRows</span><span class="p">(</span><span class="n">selection</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">remove_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">remove_item</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">remove_action</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">global_pos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">data_values</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
        <span class="n">xlimits</span> <span class="o">=</span> <span class="n">get_min_max_values_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">compute_scatter</span><span class="p">(</span><span class="n">data_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jitter</span><span class="p">,</span> <span class="n">x_lab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="n">xlims</span><span class="o">=</span><span class="n">xlimits</span><span class="p">,</span>
                                            <span class="n">urls</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_values</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_subject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">subj_index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_subject</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matplot_widget</span><span class="o">.</span><span class="n">add_subject_points</span><span class="p">((</span><span class="n">data_values</span><span class="p">[</span><span class="n">subj_index</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jitter</span><span class="p">[</span><span class="n">subj_index</span><span class="p">],),</span>
                                                       <span class="n">urls</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_subject</span><span class="p">,))</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">finish_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">new_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_variables_model</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variable_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_list</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_list</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__variable_lists_id</span>


    <span class="k">def</span> <span class="nf">launch_new_variable_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_variable_dialog</span> <span class="o">=</span> <span class="n">NewVariableDialog</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">new_variable_dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="n">Accepted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vars_model</span><span class="o">.</span><span class="n">update_list</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">filter_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%%%s%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">search_box</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars_model</span><span class="o">.</span><span class="n">update_list</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span></div>


<div class="viewcode-block" id="BundleSelectionDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.BundleSelectionDialog">[docs]</a><span class="k">class</span> <span class="nc">BundleSelectionDialog</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selects a set of bundles</span>

<span class="sd">    Args:</span>
<span class="sd">        selected (list) : List of selected bundle ids. This object will be updated with the new selection.</span>
<span class="sd">        names_dict (dict) : Dictionary mapping bundle ids to bundle names</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected</span><span class="p">,</span> <span class="n">names_dict</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BundleSelectionDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bundles_list_model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">BundlesSelectionList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bundles_list_model</span><span class="o">.</span><span class="n">select_many_ids</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_ui</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="n">selected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span> <span class="o">=</span> <span class="n">names_dict</span>

    <span class="k">def</span> <span class="nf">load_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_LoadBundles</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">all_bundles_list_view</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bundles_list_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ok_handle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ok_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_select</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bundles_list_model</span><span class="o">.</span><span class="n">get_selected</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_select</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bundles_list_model</span><span class="o">.</span><span class="n">names_dict</span><span class="p">)</span></div>


<div class="viewcode-block" id="SaveFibersBundleDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.SaveFibersBundleDialog">[docs]</a><span class="k">class</span> <span class="nc">SaveFibersBundleDialog</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a bundle defined from a list of models</span>

<span class="sd">    The dialog asks for a name and a description, it also shows the list of structures and the operation.</span>

<span class="sd">    Args:</span>
<span class="sd">        checkpoints_list (list) : List of model names which define the bundle</span>
<span class="sd">        operation_is_and (bool) : If ``True`` the bundle is composed of the fibers that pass through</span>
<span class="sd">            *all* structures, otherwise it is composed of the fibers that pass throug *any* of the listed structures</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoints_list</span><span class="p">,</span> <span class="n">operation_is_and</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SaveFibersBundleDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_SaveBundleDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">error_message</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_succesful</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="s2">&quot;And&quot;</span> <span class="k">if</span> <span class="n">operation_is_and</span> <span class="k">else</span> <span class="s2">&quot;Or&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">operation_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoints</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">checkpoints_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">structures_list</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checkpoints</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept_save</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_and</span> <span class="o">=</span> <span class="n">operation_is_and</span>

    <span class="k">def</span> <span class="nf">check_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">bundles_db</span><span class="o">.</span><span class="n">check_if_name_exists</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">error_message</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s2">&quot;A bundle with this name already exists&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">error_message</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">accept_save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;saving&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">op</span> <span class="o">=</span> <span class="s2">&quot;and&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_and</span> <span class="k">else</span> <span class="s2">&quot;or&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checkpoints</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bundles_db</span><span class="o">.</span><span class="n">save_checkpoints_bundle</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_and</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoints</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;problem saving into database&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_succesful</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Save succesful&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="SaveLogicFibersBundleDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.SaveLogicFibersBundleDialog">[docs]</a><span class="k">class</span> <span class="nc">SaveLogicFibersBundleDialog</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves a logic bundle</span>

<span class="sd">    This dialog shows a tree summarizing the dialog</span>
<span class="sd">    and it asks for a name and a description</span>

<span class="sd">    Args:</span>
<span class="sd">        tree_model (braviz.interaction.logic_bundle_model.LogicBundleNode) : Tree of the bundle</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree_model</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SaveLogicFibersBundleDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tree_model</span> <span class="o">=</span> <span class="n">tree_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_SaveLogicBundleDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">error_message</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_succesful</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">treeView</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">tree_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">treeView</span><span class="o">.</span><span class="n">expandAll</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept_save</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">bundles_db</span><span class="o">.</span><span class="n">check_if_name_exists</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">error_message</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s2">&quot;A bundle with this name already exists&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">error_message</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">accept_save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;saving&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">tree_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tree_model</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tree_dict</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bundles_db</span><span class="o">.</span><span class="n">save_logic_bundle</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tree_dict</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;problem saving into database&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_succesful</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Save succesful&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="SaveScenarioDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.SaveScenarioDialog">[docs]</a><span class="k">class</span> <span class="nc">SaveScenarioDialog</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dialog for saving scenarios, it doesn&#39;t save an screen-shot, this should be done afterwards by the application</span>

<span class="sd">    Args:</span>
<span class="sd">        app_name (unicode) : Name of application for which the scenario is created</span>
<span class="sd">        state (dict) : Dictionary of application state</span>
<span class="sd">        params (dict) : Optional, when the dialog closes, this object will contain</span>
<span class="sd">            the key ``scn_id`` and its value will be the index of the newly created scenario.</span>
<span class="sd">            Use this to save a corresponding screen-shot</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SaveScenarioDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span> <span class="o">=</span> <span class="n">app_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_gui</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_gui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_SaveScenarioDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">app_name</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_button</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Save&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_into_db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">save_button</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">ActionRole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">succesful_message</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_into_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">scenario_name</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">scenario_name</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scenario_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">scenario_name</span> <span class="o">=</span> <span class="s2">&quot;&lt;Unnamed&gt;&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">scn_description</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">())</span>
        <span class="n">scn_id</span> <span class="o">=</span> <span class="n">braviz_user_data</span><span class="o">.</span><span class="n">save_scenario</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span><span class="p">,</span> <span class="n">scenario_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;scn_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scn_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;scn_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scenario_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">succesful_message</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Save completed succesfully&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>


<div class="viewcode-block" id="LoadScenarioDialog"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.LoadScenarioDialog">[docs]</a><span class="k">class</span> <span class="nc">LoadScenarioDialog</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dialog that shows the user a list of available scenarios, with screen-shots, and allows him to select one</span>

<span class="sd">    Args:</span>
<span class="sd">        app_name (unicode) : Restrict the list of scenarios to those created with an specific application</span>
<span class="sd">        out_dict (dict) : When the dialog finishes this dictionary will contain the selected scenario data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">out_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LoadScenarioDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">out_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_dict</span> <span class="o">=</span> <span class="n">out_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">ScenariosTableModel</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_row</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_ui</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_LoadScenarioDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">scenarios_table</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">scenarios_table</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_scenario</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">scenarios_table</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_scenario</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">scenarios_table</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_context_menu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_row</span> <span class="o">=</span> <span class="n">row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># load picture</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">screen_shot_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&lt;No screenshot available&gt;&quot;</span> <span class="o">%</span> <span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">screen_shot_label</span><span class="o">.</span><span class="n">setScaledContents</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">data_root</span> <span class="o">=</span> <span class="n">braviz</span><span class="o">.</span><span class="n">readAndFilter</span><span class="o">.</span><span class="n">braviz_auto_dynamic_data_root</span><span class="p">()</span>

        <span class="n">image_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">data_root</span><span class="p">,</span> <span class="s2">&quot;braviz_data&quot;</span><span class="p">,</span> <span class="s2">&quot;scenarios&quot;</span><span class="p">,</span> <span class="s2">&quot;scenario_</span><span class="si">%d</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">image_file</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
            <span class="n">scaled_image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">scaledToWidth</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">screen_shot_label</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">scaled_image</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">scn_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_row</span><span class="p">))</span>
        <span class="n">parameters_dict</span> <span class="o">=</span> <span class="n">braviz_user_data</span><span class="o">.</span><span class="n">get_scenario_data_dict</span><span class="p">(</span><span class="n">scn_id</span><span class="p">)</span>
        <span class="n">parameters_dict</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">][</span><span class="s2">&quot;scn_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scn_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parameters_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">show_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">global_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">scenarios_table</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">scenarios_table</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">selection</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="n">selection_row</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">scn_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">selection_row</span><span class="p">)</span>
        <span class="n">scn_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="n">selection_row</span><span class="p">)</span>
        <span class="n">remove_action</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Remove </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">scn_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">remove_action</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">remove_item</span><span class="p">():</span>
            <span class="n">braviz_user_data</span><span class="o">.</span><span class="n">delete_scenario</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">scn_idx</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reload_data</span><span class="p">()</span>

        <span class="n">remove_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">remove_item</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">remove_action</span><span class="p">)</span>
        <span class="n">selected_item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">global_pos</span><span class="p">)</span></div>
        <span class="c1"># print selected_item</span>


<div class="viewcode-block" id="LoadLogicBundle"><a class="viewcode-back" href="../../../library/qt_dialogs.html#braviz.interaction.qt_dialogs.LoadLogicBundle">[docs]</a><span class="k">class</span> <span class="nc">LoadLogicBundle</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loading a logic bundle from the database</span>

<span class="sd">    The dialog shows a preview of the tree associated with the bundle</span>
<span class="sd">    This tree will be available in the *data* attribute after the selection is accepted</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LoadLogicBundle</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tree_root</span> <span class="o">=</span> <span class="n">LogicBundleNode</span><span class="p">(</span>
            <span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">LogicBundleNode</span><span class="o">.</span><span class="n">LOGIC</span><span class="p">,</span> <span class="s2">&quot;AND&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tree_model</span> <span class="o">=</span> <span class="n">LogicBundleQtTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__tree_root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bundles</span> <span class="o">=</span> <span class="n">bundles_db</span><span class="o">.</span><span class="n">get_bundles_list</span><span class="p">(</span><span class="n">bundle_type</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bundles_model</span> <span class="o">=</span> <span class="n">braviz_models</span><span class="o">.</span><span class="n">SimpleSetModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bundles_model</span><span class="o">.</span><span class="n">set_elements</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bundles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_LoadLogicDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">treeView</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__tree_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">listView</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bundles_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">listView</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_tree</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">listView</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_tree</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">before_accepting</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bundles_model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">bundles_db</span><span class="o">.</span><span class="n">get_logic_bundle_dict</span><span class="p">(</span><span class="n">bundle_name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tree_root</span> <span class="o">=</span> <span class="n">LogicBundleNode</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tree_model</span><span class="o">.</span><span class="n">set_root</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__tree_root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">treeView</span><span class="o">.</span><span class="n">expandAll</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">before_accepting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">listView</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_tree</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1">#vsd = GenericVariableSelectDialog(out, multiple=False,initial_selection_names=[&#39;ABCL_DSM_antisocial_T_padres&#39;])</span>
    <span class="c1"># vsd = MultiPlotOutcomeSelectDialog(out))</span>
    <span class="n">vsd</span> <span class="o">=</span> <span class="n">LoadLogicBundle</span><span class="p">()</span>

    <span class="n">vsd</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

</pre></div>

          </div>
        </div>
      </div>
        </div>

        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          
                

                

                

          
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Diego Angulo.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>







        
  </body>
</html>